<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>BLFS构建04-安全问题 | rack-leen's blog</title><meta name="description" content="BLFS构建04-安全问题"><meta name="keywords" content=""><meta name="author" content="rack-leen"><meta name="copyright" content="rack-leen"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="BLFS构建04-安全问题"><meta name="twitter:description" content="BLFS构建04-安全问题"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="BLFS构建04-安全问题"><meta property="og:url" content="http://yoursite.com/2019/06/12/BLFS/BLFS%E6%9E%84%E5%BB%BA04-%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"><meta property="og:site_name" content="rack-leen's blog"><meta property="og:description" content="BLFS构建04-安全问题"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'true'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="http://yoursite.com/2019/06/12/BLFS/BLFS%E6%9E%84%E5%BB%BA04-%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"><link rel="prev" title="Spring整合shiro" href="http://yoursite.com/2019/06/12/Java/Java%E6%A1%86%E6%9E%B6/Shiro/Spring%E6%95%B4%E5%90%88shiro/"><link rel="next" title="BLFS构建02-LFS配置之后的问题" href="http://yoursite.com/2019/06/11/BLFS/BLFS%E6%9E%84%E5%BB%BA02-LFS%E9%85%8D%E7%BD%AE%E4%B9%8B%E5%90%8E%E7%9A%84%E9%97%AE%E9%A2%98/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"PIBV7VGBEP","apiKey":"5b1fef2837ae17299ea73b8c5b0bfad5","indexName":"rack","hits":5000,"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://rack-leen.top/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: 'true',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">rack-leen's blog</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Home"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">181</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">50</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">65</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Home"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#blfs构建04-安全问题"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">BLFS构建04-安全问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#make-ca-1-2"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">make-ca-1.2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#consolekit2-1-2-1"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">consolekit2-1.2.1</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#cracklib"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">cracklib</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#gnupg"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">gnupg</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#gnutls"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">gnutls</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#gpgme"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">gpgme</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#haveged"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">haveged</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#iptables"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">iptables</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#libcap"><span class="toc_mobile_items-number">1.9.</span> <span class="toc_mobile_items-text">libcap</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#liboauth"><span class="toc_mobile_items-number">1.10.</span> <span class="toc_mobile_items-text">liboauth</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#libpwquality"><span class="toc_mobile_items-number">1.11.</span> <span class="toc_mobile_items-text">libpwquality</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#krb5"><span class="toc_mobile_items-number">1.12.</span> <span class="toc_mobile_items-text">krb5</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#nss"><span class="toc_mobile_items-number">1.13.</span> <span class="toc_mobile_items-text">nss</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#polkit"><span class="toc_mobile_items-number">1.14.</span> <span class="toc_mobile_items-text">polkit</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#shadow"><span class="toc_mobile_items-number">1.15.</span> <span class="toc_mobile_items-text">shadow</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#stunnel"><span class="toc_mobile_items-number">1.16.</span> <span class="toc_mobile_items-text">stunnel</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#sudo"><span class="toc_mobile_items-number">1.17.</span> <span class="toc_mobile_items-text">sudo</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#tripwire"><span class="toc_mobile_items-number">1.18.</span> <span class="toc_mobile_items-text">tripwire</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#volume-key"><span class="toc_mobile_items-number">1.19.</span> <span class="toc_mobile_items-text">volume_key</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#blfs构建04-安全问题"><span class="toc-number">1.</span> <span class="toc-text">BLFS构建04-安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#make-ca-1-2"><span class="toc-number">1.1.</span> <span class="toc-text">make-ca-1.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#consolekit2-1-2-1"><span class="toc-number">1.2.</span> <span class="toc-text">consolekit2-1.2.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cracklib"><span class="toc-number">1.3.</span> <span class="toc-text">cracklib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gnupg"><span class="toc-number">1.4.</span> <span class="toc-text">gnupg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gnutls"><span class="toc-number">1.5.</span> <span class="toc-text">gnutls</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gpgme"><span class="toc-number">1.6.</span> <span class="toc-text">gpgme</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#haveged"><span class="toc-number">1.7.</span> <span class="toc-text">haveged</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#iptables"><span class="toc-number">1.8.</span> <span class="toc-text">iptables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#libcap"><span class="toc-number">1.9.</span> <span class="toc-text">libcap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#liboauth"><span class="toc-number">1.10.</span> <span class="toc-text">liboauth</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#libpwquality"><span class="toc-number">1.11.</span> <span class="toc-text">libpwquality</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#krb5"><span class="toc-number">1.12.</span> <span class="toc-text">krb5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nss"><span class="toc-number">1.13.</span> <span class="toc-text">nss</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#polkit"><span class="toc-number">1.14.</span> <span class="toc-text">polkit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shadow"><span class="toc-number">1.15.</span> <span class="toc-text">shadow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stunnel"><span class="toc-number">1.16.</span> <span class="toc-text">stunnel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sudo"><span class="toc-number">1.17.</span> <span class="toc-text">sudo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tripwire"><span class="toc-number">1.18.</span> <span class="toc-text">tripwire</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#volume-key"><span class="toc-number">1.19.</span> <span class="toc-text">volume_key</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">BLFS构建04-安全问题</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-06-12<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-06-19</time><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字数总计: </span><span class="word-count">5.4k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>阅读时长: 33 分钟</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h3 id="blfs构建04-安全问题"><a class="header-anchor" href="#blfs构建04-安全问题">¶</a>BLFS构建04-安全问题</h3>
<h4 id="make-ca-1-2"><a class="header-anchor" href="#make-ca-1-2">¶</a>make-ca-1.2</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">下载安装p11的依赖包libtasn1</span></span><br><span class="line">wget https://ftp.gnu.org/gnu/libtasn1/libtasn1-4.13.tar.gz</span><br><span class="line">tar -zxvf libtasn1-4.13.tar.gz</span><br><span class="line">cd libtasn1-4.13</span><br><span class="line">./configure --prefix=/usr --disable-static</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">make -C doc/reference install-data-local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装make-ca的p11-kit依赖包</span></span><br><span class="line">wget https://github.com/p11-glue/p11-kit/releases/download/0.23.15/p11-kit-0.23.15.tar.gz</span><br><span class="line">tar -zxvf p11-kit-0.23.15.tar.gz</span><br><span class="line">cd p11-kit-0.23.15</span><br><span class="line">sed '20,$ d' -i trust/trust-extract-compat.in</span><br><span class="line">cat &gt;&gt; trust/trust-extract-compat.in &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Copy existing anchor modifications to /etc/ssl/<span class="built_in">local</span></span></span><br><span class="line">/usr/libexec/make-ca/copy-trust-modifications</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generate a new trust store</span></span><br><span class="line">/usr/sbin/make-ca -f -g</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr  --sysconfdir=/etc --with-trust-paths=/etc/pki/anchors</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /usr/libexec/p11-kit/trust-extract-compat /usr/bin/update-ca-certificates</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">最后下载安装make-ca</span></span><br><span class="line">wget https://github.com/djlucas/make-ca/releases/download/v1.2/make-ca-1.2.tar.xz</span><br><span class="line">tar xvf make-ca-1.2.tar.xz</span><br><span class="line">cd make-ca-1.2</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">下载 certdata.txt(证书文件)</span></span><br><span class="line">usr/sbin/make-ca -g</span><br><span class="line"><span class="meta">#</span><span class="bash">将新的证书放入系统中</span></span><br><span class="line">ln -sfv /etc/pki/tls/certs/ca-bundle.crt /etc/ssl/ca-bundle.crt</span><br><span class="line">install -vdm755 /etc/cron.weekly </span><br><span class="line"></span><br><span class="line">cat &gt; /etc/cron.weekly/update-pki.sh &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">/usr/sbin/make-ca -g</span><br><span class="line">EOF</span><br><span class="line">chmod 754 /etc/cron.weekly/update-pki.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">增加传统ca证书</span></span><br><span class="line">install -vdm755 /etc/ssl/local</span><br><span class="line"><span class="meta">#</span><span class="bash">下载ca证书（用宿主机下载）</span></span><br><span class="line">openssl x509 -in root.crt -text -fingerprint -setalias "CAcert Class 1 root"  -addtrust serverAuth -addtrust emailProtection -addtrust codeSigning  &gt; /etc/ssl/local/CAcert_Class_1_root.pem</span><br><span class="line">openssl x509 -in class3.crt -text -fingerprint -setalias "CAcert Class 3 root"  -addtrust serverAuth -addtrust emailProtection -addtrust codeSigning  &gt; /etc/ssl/local/CAcert_Class_3_root.pem</span><br><span class="line">install -vdm755 /etc/ssl/local</span><br><span class="line">openssl x509 -in /etc/ssl/certs/Makebelieve_CA_Root.pem \</span><br><span class="line">             -text \</span><br><span class="line">             -fingerprint</span><br><span class="line">             -setalias "Disabled Makebelieve CA Root" \</span><br><span class="line">             -addreject serverAuth \</span><br><span class="line">             -addreject emailProtection \</span><br><span class="line">             -addreject codeSigning \</span><br><span class="line">       &gt; /etc/ssl/local/Disabled_Makebelieve_CA_Root.pem</span><br><span class="line">/usr/sbin/make-ca -r -f</span><br></pre></td></tr></table></figure>
<h4 id="consolekit2-1-2-1"><a class="header-anchor" href="#consolekit2-1-2-1">¶</a>consolekit2-1.2.1</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">下载安装fontconfig的依赖包freetype2</span></span><br><span class="line">wget https://downloads.sourceforge.net/freetype/freetype-2.9.1.tar.bz2</span><br><span class="line">wget https://downloads.sourceforge.net/freetype/freetype-doc-2.9.1.tar.bz2</span><br><span class="line">tar -jxvf freetype-2.9.1.tar.bz2</span><br><span class="line">cd freetype-2.9.1</span><br><span class="line">tar -xvf ../freetype-doc-2.9.1.tar.bz2 --strip-components=2 -C docs</span><br><span class="line">sed -ri "s:.*(AUX_MODULES.*valid):\1:" modules.cfg</span><br><span class="line">sed -r "s:.*(#.*SUBPIXEL_RENDERING) .*:\1:" -i include/freetype/config/ftoption.h</span><br><span class="line">./configure --prefix=/usr --enable-freetype-config --disable-static</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">install -v -m755 -d /usr/share/doc/freetype-2.9.1</span><br><span class="line">cp -v -R docs/*     /usr/share/doc/freetype-2.9.1</span><br><span class="line">rm -v /usr/share/doc/freetype-2.9.1/freetype-config.1</span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装xorg-lib的依赖包fontconfig</span></span><br><span class="line">wget https://www.freedesktop.org/software/fontconfig/release/fontconfig-2.13.1.tar.bz2</span><br><span class="line">tar -jxvf fontconfig-2.13.1.tar.bz2</span><br><span class="line">cd fontconfig-2.13.1</span><br><span class="line">rm -f src/fcobjshash.h</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --disable-docs  --docdir=/usr/share/doc/fontconfig-2.13.1</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">install -v -dm755  /usr/share/&#123;man/man&#123;1,3,5&#125;,doc/fontconfig-2.13.1/fontconfig-devel&#125;</span><br><span class="line">install -v -m644 fc-*/*.1         /usr/share/man/man1</span><br><span class="line">install -v -m644 doc/*.3          /usr/share/man/man3</span><br><span class="line">install -v -m644 doc/fonts-conf.5 /usr/share/man/man5</span><br><span class="line">install -v -m644 doc/fontconfig-devel/* /usr/share/doc/fontconfig-2.13.1/fontconfig-devel</span><br><span class="line">install -v -m644 doc/*.&#123;pdf,sgml,txt,html&#125; /usr/share/doc/fontconfig-2.13.1</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#配置文件路径</span></span></span><br><span class="line">/etc/fonts/*, /etc/fonts/conf.d/* and /usr/share/fontconfig/conf.avail/*</span><br><span class="line"><span class="meta">#</span><span class="bash">配置util-macros的依赖xorg环境</span></span><br><span class="line">mkdir xc</span><br><span class="line">cd xc</span><br><span class="line">export XORG_PREFIX="/usr"</span><br><span class="line">export XORG_CONFIG="--prefix=$XORG_PREFIX --sysconfdir=/etc --localstatedir=/var --disable-static"</span><br><span class="line">cat &gt; /etc/profile.d/xorg.sh &lt;&lt; EOF</span><br><span class="line">XORG_PREFIX="$XORG_PREFIX"</span><br><span class="line">XORG_CONFIG="--prefix=\$XORG_PREFIX --sysconfdir=/etc --localstatedir=/var --disable-static"</span><br><span class="line">export XORG_PREFIX XORG_CONFIG</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod 644 /etc/profile.d/xorg.sh</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/profile.d/xorg.sh &lt;&lt; "EOF"</span><br><span class="line"></span><br><span class="line">pathappend $XORG_PREFIX/bin             PATH</span><br><span class="line">pathappend $XORG_PREFIX/lib/pkgconfig   PKG_CONFIG_PATH</span><br><span class="line">pathappend $XORG_PREFIX/share/pkgconfig PKG_CONFIG_PATH</span><br><span class="line"></span><br><span class="line">pathappend $XORG_PREFIX/lib             LIBRARY_PATH</span><br><span class="line">pathappend $XORG_PREFIX/include         C_INCLUDE_PATH</span><br><span class="line">pathappend $XORG_PREFIX/include         CPLUS_INCLUDE_PATH</span><br><span class="line"></span><br><span class="line">ACLOCAL="aclocal -I $XORG_PREFIX/share/aclocal"</span><br><span class="line"></span><br><span class="line">export PATH PKG_CONFIG_PATH ACLOCAL LIBRARY_PATH C_INCLUDE_PATH CPLUS_INCLUDE_PATH</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">echo "$XORG_PREFIX/lib" &gt;&gt; /etc/ld.so.conf</span><br><span class="line">sed "s@/usr/X11R6@$XORG_PREFIX@g" -i /etc/man_db.conf</span><br><span class="line">ln -svf $XORG_PREFIX/share/X11 /usr/share/X11</span><br><span class="line">ln -svf $XORG_PREFIX /usr/X11R6</span><br><span class="line"><span class="meta">#</span><span class="bash">下载xorgproto依赖包util-macros</span></span><br><span class="line">wget https://www.x.org/pub/individual/util/util-macros-1.19.2.tar.bz2</span><br><span class="line">tar -jxvf util-macros-1.19.2.tar.bz2</span><br><span class="line">cd util-macros-1.19.2</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装libxau的依赖xorgproto-2018.4</span></span><br><span class="line">https://xorg.freedesktop.org/archive/individual/proto/xorgproto-2018.4.tar.bz2</span><br><span class="line">tar -jxvf xorgproto-2018.4.tar.bz2</span><br><span class="line">cd xorgproto-2018.4</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">meson --prefix=/usr .. &amp;&amp; ninja</span><br><span class="line">ninja install</span><br><span class="line">install -vdm 755 $XORG_PREFIX/share/doc/xorgproto-2018.4</span><br><span class="line">install -vm 644 ../[^m]*.txt ../PM_spec $XORG_PREFIX/share/doc/xorgproto-2018.4</span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装libxcb的依赖libxau</span></span><br><span class="line">wget https://www.x.org/pub/individual/lib/libXau-1.0.9.tar.bz2</span><br><span class="line">tar -jxvf libXau-1.0.9.tar.bz2</span><br><span class="line">cd libXau-1.0.9</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装libxcb的依赖xcb-proto</span></span><br><span class="line">wget https://xcb.freedesktop.org/dist/xcb-proto-1.13.tar.bz2</span><br><span class="line">tar -jxvf xcb-proto-1.13.tar.bz2</span><br><span class="line">cd xcb-proto-1.13</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装xorg-lib的依赖包libxcb</span></span><br><span class="line">wget https://xcb.freedesktop.org/dist/libxcb-1.13.1.tar.bz2</span><br><span class="line">tar -jxvf libxcb-1.13.1.tar.bz2</span><br><span class="line">cd libxcb-1.13.1</span><br><span class="line">sed -i "s/pthread-stubs//" configure</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --disable-static --without-doxygen --docdir='$&#123;datadir&#125;'/doc/libxcb-1.13.1</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装consolekit的依赖xorg-lib</span></span><br><span class="line">cat &gt; lib-7.md5 &lt;&lt; "EOF"</span><br><span class="line">c5ba432dd1514d858053ffe9f4737dd8  xtrans-1.3.5.tar.bz2</span><br><span class="line">034fdd6cc5393974d88aec6f5bc96162  libX11-1.6.7.tar.bz2</span><br><span class="line">52df7c4c1f0badd9f82ab124fb32eb97  libXext-1.3.3.tar.bz2</span><br><span class="line">d79d9fe2aa55eb0f69b1a4351e1368f7  libFS-1.0.7.tar.bz2</span><br><span class="line">addfb1e897ca8079531669c7c7711726  libICE-1.0.9.tar.bz2</span><br><span class="line">87c7fad1c1813517979184c8ccd76628  libSM-1.2.3.tar.bz2</span><br><span class="line">eeea9d5af3e6c143d0ea1721d27a5e49  libXScrnSaver-1.2.3.tar.bz2</span><br><span class="line">8f5b5576fbabba29a05f3ca2226f74d3  libXt-1.1.5.tar.bz2</span><br><span class="line">41d92ab627dfa06568076043f3e089e4  libXmu-1.1.2.tar.bz2</span><br><span class="line">20f4627672edb2bd06a749f11aa97302  libXpm-3.5.12.tar.bz2</span><br><span class="line">e5e06eb14a608b58746bdd1c0bd7b8e3  libXaw-1.0.13.tar.bz2</span><br><span class="line">07e01e046a0215574f36a3aacb148be0  libXfixes-5.0.3.tar.bz2</span><br><span class="line">f7a218dcbf6f0848599c6c36fc65c51a  libXcomposite-0.4.4.tar.bz2</span><br><span class="line">802179a76bded0b658f4e9ec5e1830a4  libXrender-0.9.10.tar.bz2</span><br><span class="line">58fe3514e1e7135cf364101e714d1a14  libXcursor-1.1.15.tar.bz2</span><br><span class="line">0cf292de2a9fa2e9a939aefde68fd34f  libXdamage-1.1.4.tar.bz2</span><br><span class="line">0920924c3a9ebc1265517bdd2f9fde50  libfontenc-1.1.3.tar.bz2</span><br><span class="line">b7ca87dfafeb5205b28a1e91ac3efe85  libXfont2-2.0.3.tar.bz2</span><br><span class="line">331b3a2a3a1a78b5b44cfbd43f86fcfe  libXft-2.3.2.tar.bz2</span><br><span class="line">1f0f2719c020655a60aee334ddd26d67  libXi-1.7.9.tar.bz2</span><br><span class="line">0d5f826a197dae74da67af4a9ef35885  libXinerama-1.1.4.tar.bz2</span><br><span class="line">28e486f1d491b757173dd85ba34ee884  libXrandr-1.5.1.tar.bz2</span><br><span class="line">5d6d443d1abc8e1f6fc1c57fb27729bb  libXres-1.2.0.tar.bz2</span><br><span class="line">ef8c2c1d16a00bd95b9fdcef63b8a2ca  libXtst-1.2.3.tar.bz2</span><br><span class="line">210b6ef30dda2256d54763136faa37b9  libXv-1.0.11.tar.bz2</span><br><span class="line">4cbe1c1def7a5e1b0ed5fce8e512f4c6  libXvMC-1.0.10.tar.bz2</span><br><span class="line">d7dd9b9df336b7dd4028b6b56542ff2c  libXxf86dga-1.1.4.tar.bz2</span><br><span class="line">298b8fff82df17304dfdb5fe4066fe3a  libXxf86vm-1.1.4.tar.bz2</span><br><span class="line">d2f1f0ec68ac3932dd7f1d9aa0a7a11c  libdmx-1.1.4.tar.bz2</span><br><span class="line">8f436e151d5106a9cfaa71857a066d33  libpciaccess-0.14.tar.bz2</span><br><span class="line">4a4cfeaf24dab1b991903455d6d7d404  libxkbfile-1.0.9.tar.bz2</span><br><span class="line">42dda8016943dc12aff2c03a036e0937  libxshmfence-1.3.tar.bz2</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mkdir lib &amp;&amp;</span><br><span class="line">cd lib &amp;&amp;</span><br><span class="line">grep -v '^#' ../lib-7.md5 | awk '&#123;print $2&#125;' | wget -i- -c \</span><br><span class="line">    -B https://www.x.org/pub/individual/lib/ &amp;&amp;</span><br><span class="line">md5sum -c ../lib-7.md5</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#切换到bash</span></span></span><br><span class="line">bash -e</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#使用脚本批量安装(使用root)</span></span></span><br><span class="line">for package in $(grep -v '^#' ../lib-7.md5 | awk '&#123;print $2&#125;')</span><br><span class="line">do</span><br><span class="line">  packagedir=$&#123;package%.tar.bz2&#125;</span><br><span class="line">  tar -xf $package</span><br><span class="line">  pushd $packagedir</span><br><span class="line">  case $packagedir in</span><br><span class="line">    libICE* )</span><br><span class="line">      ./configure $XORG_CONFIG ICE_LIBS=-lpthread</span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">    libXfont2-[0-9]* )</span><br><span class="line">      ./configure $XORG_CONFIG --disable-devel-docs</span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">    libXt-[0-9]* )</span><br><span class="line">      ./configure $XORG_CONFIG \</span><br><span class="line">                  --with-appdefaultdir=/etc/X11/app-defaults</span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">    * )</span><br><span class="line">      ./configure $XORG_CONFIG</span><br><span class="line">    ;;</span><br><span class="line">  esac</span><br><span class="line">  make</span><br><span class="line"><span class="meta">  #</span><span class="bash">make check 2&gt;&amp;1 | tee ../<span class="variable">$packagedir</span>-make_check.log</span></span><br><span class="line">  make install</span><br><span class="line">  popd</span><br><span class="line">  rm -rf $packagedir</span><br><span class="line">  /sbin/ldconfig</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">下载安装consolekit的依赖dbus-glib-0.110</span></span><br><span class="line">wget https://dbus.freedesktop.org/releases/dbus-glib/dbus-glib-0.110.tar.gz</span><br><span class="line">tar -zxvf dbus-glib-0.110.tar.gz</span><br><span class="line">cd dbus-glib-0.110</span><br><span class="line">groupadd -g 18 messagebus</span><br><span class="line">useradd -c "D-Bus Message Daemon User" -d /var/run/dbus -u 18 -g messagebus -s /bin/false messagebus</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var  --disable-doxygen-docs --disable-xml-docs  --disable-static --docdir=/usr/share/doc/dbus-1.12.12 --with-console-auth-dir=/run/console --with-system-pid-file=/run/dbus/pid --with-system-socket=/run/dbus/system_bus_socket</span><br></pre></td></tr></table></figure>
<h4 id="cracklib"><a class="header-anchor" href="#cracklib">¶</a>cracklib</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/c/cracklib-2.9.6.tar.gz </span><br><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/c/cracklib-words-2.9.6.gz</span><br><span class="line">tar -zxvf cracklib-2.9.6.tar.gz</span><br><span class="line">cd cracklib-2.9.6</span><br><span class="line">sed -i '/skipping/d' util/packer.c &amp;&amp;</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr    \</span><br><span class="line">            --disable-static \</span><br><span class="line">            --with-default-dict=/lib/cracklib/pw_dict &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install                      &amp;&amp;</span><br><span class="line">mv -v /usr/lib/libcrack.so.* /lib &amp;&amp;</span><br><span class="line">ln -sfv ../../lib/$(readlink /usr/lib/libcrack.so) /usr/lib/libcrack.so</span><br><span class="line">install -v -m644 -D    ../cracklib-words-2.9.6.gz \</span><br><span class="line">                         /usr/share/dict/cracklib-words.gz     &amp;&amp;</span><br><span class="line"></span><br><span class="line">gunzip -v                /usr/share/dict/cracklib-words.gz     &amp;&amp;</span><br><span class="line">ln -v -sf cracklib-words /usr/share/dict/words                 &amp;&amp;</span><br><span class="line">echo $(hostname) &gt;&gt;      /usr/share/dict/cracklib-extra-words  &amp;&amp;</span><br><span class="line">install -v -m755 -d      /lib/cracklib                         &amp;&amp;</span><br><span class="line"></span><br><span class="line">create-cracklib-dict     /usr/share/dict/cracklib-words \</span><br><span class="line">                         /usr/share/dict/cracklib-extra-words</span><br></pre></td></tr></table></figure>
<h4 id="gnupg"><a class="header-anchor" href="#gnupg">¶</a>gnupg</h4>
<ul>
<li>gnupg</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/g/gnupg-2.2.13.tar.bz2</span><br><span class="line">tar -jxvf gnupg-2.2.13.tar.bz2</span><br><span class="line">cd gnupg-2.2.13</span><br><span class="line">sed -e '/noinst_SCRIPTS = gpg-zip/c sbin_SCRIPTS += gpg-zip' \</span><br><span class="line">    -i tools/Makefile.in</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr            \</span><br><span class="line">            --enable-symcryptrun     \</span><br><span class="line">            --docdir=/usr/share/doc/gnupg-2.2.13</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">makeinfo --html --no-split -o doc/gnupg_nochunks.html doc/gnupg.texi &amp;&amp;</span><br><span class="line">makeinfo --plaintext       -o doc/gnupg.txt           doc/gnupg.texi</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">install -v -m755 -d /usr/share/doc/gnupg-2.2.13/html            &amp;&amp;</span><br><span class="line">install -v -m644    doc/gnupg_nochunks.html \</span><br><span class="line">                    /usr/share/doc/gnupg-2.2.13/html/gnupg.html &amp;&amp;</span><br><span class="line">install -v -m644    doc/*.texi doc/gnupg.txt \</span><br><span class="line">                    /usr/share/doc/gnupg-2.2.13</span><br></pre></td></tr></table></figure>
<ul>
<li>gnupg依赖libassuan,libgcrypt,libgpg-error,libksba和npth</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">lubassuan</span></span><br><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/g/gnupg-2.2.13.tar.bz2</span><br><span class="line">tar -jxvf libassuan-2.5.3.tar.bz2</span><br><span class="line">cd libassuan-2.5.3</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">libgpg-error</span></span><br><span class="line">wget  https://www.gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-1.35.tar.bz2</span><br><span class="line">tar -jxvf libgpg-error-1.35.tar.bz2</span><br><span class="line">cd libgpg-error-1.35</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">install -v -m644 -D README /usr/share/doc/libgpg-error-1.35/README</span><br><span class="line"><span class="meta">#</span><span class="bash">libgcrypt</span></span><br><span class="line">wget  https://www.gnupg.org/ftp/gcrypt/libgcrypt/libgcrypt-1.8.4.tar.bz2</span><br><span class="line">tar -jxvf libgcrypt-1.8.4.tar.bz2</span><br><span class="line">cd libgcrypt-1.8.4</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line">makeinfo --html --no-split -o doc/gcrypt_nochunks.html doc/gcrypt.texi &amp;&amp;</span><br><span class="line">makeinfo --plaintext       -o doc/gcrypt.txt           doc/gcrypt.texi</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">install -v -dm755   /usr/share/doc/libgcrypt-1.8.4 &amp;&amp;</span><br><span class="line">install -v -m644    README doc/&#123;README.apichanges,fips*,libgcrypt*&#125; \</span><br><span class="line">                    /usr/share/doc/libgcrypt-1.8.4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">libksba</span></span><br><span class="line">wget https://www.gnupg.org/ftp/gcrypt/libksba/libksba-1.3.5.tar.bz2</span><br><span class="line">tar -jxvf libksba-1.3.5.tar.bz2</span><br><span class="line">cd libksba-1.3.5</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make </span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">npth</span></span><br><span class="line">wget https://www.gnupg.org/ftp/gcrypt/npth/npth-1.6.tar.bz2</span><br><span class="line">tar -jxvf npth-1.6.tar.bz2</span><br><span class="line">cd npth-1.6</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="gnutls"><a class="header-anchor" href="#gnutls">¶</a>gnutls</h4>
<ul>
<li>gnutls</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/g/gnutls-3.6.6.tar.xz</span><br><span class="line">tar xvf gnutls-3.6.6.tar.xz</span><br><span class="line">cd gnutls-3.6.6</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr \</span><br><span class="line">            --disable-guile \</span><br><span class="line">            --with-default-trust-store-pkcs11="pkcs11:" \</span><br><span class="line">            --with-included-unistring</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">make -C doc/reference install-data-local</span><br></pre></td></tr></table></figure>
<ul>
<li>gnutls依赖nettle</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/g/nettle-3.4.1.tar.gz</span><br><span class="line">tar -zxvf nettle-3.4.1.tar.gz</span><br><span class="line">cd nettle-3.4.1</span><br><span class="line">./configure --prefix=/usr --disable-static</span><br><span class="line">make</span><br><span class="line">make install &amp;&amp;</span><br><span class="line">chmod   -v   755 /usr/lib/lib&#123;hogweed,nettle&#125;.so &amp;&amp;</span><br><span class="line">install -v -m755 -d /usr/share/doc/nettle-3.4.1 &amp;&amp;</span><br><span class="line">install -v -m644 nettle.html /usr/share/doc/nettle-3.4.1</span><br></pre></td></tr></table></figure>
<h4 id="gpgme"><a class="header-anchor" href="#gpgme">¶</a>gpgme</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/g/gpgme-1.12.0.tar.bz2</span><br><span class="line">tar -jxvf gpgme-1.12.0.tar.bz2</span><br><span class="line">cd gpgme-1.12.0</span><br><span class="line">./configure --prefix=/usr --disable-gpg-test</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="haveged"><a class="header-anchor" href="#haveged">¶</a>haveged</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/h/haveged-1.9.2.tar.gz</span><br><span class="line">tar -zxvf haveged-1.9.2.tar.gz </span><br><span class="line">cd haveged-1.9.2</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">mkdir -pv    /usr/share/doc/haveged-1.9.2 &amp;&amp;</span><br><span class="line">cp -v README /usr/share/doc/haveged-1.9.2</span><br><span class="line"><span class="meta">#</span><span class="bash">开机启动</span></span><br><span class="line">cd /sources/blfs-bootscripts-20180105/</span><br><span class="line">make install-haveged</span><br></pre></td></tr></table></figure>
<h4 id="iptables"><a class="header-anchor" href="#iptables">¶</a>iptables</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/i/iptables-1.8.2.tar.bz2</span><br><span class="line">tar -jxvf iptables-1.8.2.tar.bz2</span><br><span class="line">cd iptables-1.8.2</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr      \</span><br><span class="line">            --sbindir=/sbin    \</span><br><span class="line">            --disable-nftables \</span><br><span class="line">            --enable-libipq    \</span><br><span class="line">            --with-xtlibdir=/lib/xtables &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install &amp;&amp;</span><br><span class="line">ln -sfv ../../sbin/xtables-legacy-multi /usr/bin/iptables-xml &amp;&amp;</span><br><span class="line"></span><br><span class="line">for file in ip4tc ip6tc ipq iptc xtables</span><br><span class="line">do</span><br><span class="line">  mv -v /usr/lib/lib$&#123;file&#125;.so.* /lib &amp;&amp;</span><br><span class="line">  ln -sfv ../../lib/$(readlink /usr/lib/lib$&#123;file&#125;.so) /usr/lib/lib$&#123;file&#125;.so</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">开机启动</span></span><br><span class="line">cd /sources/blfs-bootscripts-20180105/</span><br><span class="line">make install-iptables</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置网络防火墙</span></span><br><span class="line">/etc/rc.d/init.d/iptables start</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/rc.d/rc.iptables &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin rc.iptables</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Insert connection-tracking modules</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (not needed <span class="keyword">if</span> built into the kernel)</span></span><br><span class="line">modprobe nf_conntrack</span><br><span class="line">modprobe xt_LOG</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enable broadcast <span class="built_in">echo</span> Protection</span></span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disable Source Routed Packets</span></span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_source_route</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/default/accept_source_route</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enable TCP SYN Cookie Protection</span></span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disable ICMP Redirect Acceptance</span></span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/default/accept_redirects</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Do not send Redirect Messages</span></span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/all/send_redirects</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/default/send_redirects</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Drop Spoofed Packets coming <span class="keyword">in</span> on an interface, <span class="built_in">where</span> responses</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> would result <span class="keyword">in</span> the reply going out a different interface.</span></span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/conf/default/rp_filter</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log packets with impossible addresses.</span></span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/conf/all/log_martians</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/conf/default/log_martians</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> be verbose on dynamic ip-addresses  (not needed <span class="keyword">in</span> <span class="keyword">case</span> of static IP)</span></span><br><span class="line">echo 2 &gt; /proc/sys/net/ipv4/ip_dynaddr</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">disable</span> Explicit Congestion Notification</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> too many routers are still ignorant</span></span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/tcp_ecn</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set a known state</span></span><br><span class="line">iptables -P INPUT   DROP</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line">iptables -P OUTPUT  DROP</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> These lines are here <span class="keyword">in</span> <span class="keyword">case</span> rules are already <span class="keyword">in</span> place and the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> script is ever rerun on the fly. We want to remove all rules and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pre-existing user defined chains before we implement new rules.</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line"></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Allow <span class="built_in">local</span>-only connections</span></span><br><span class="line">iptables -A INPUT  -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Free output on any interface to any ip <span class="keyword">for</span> any service</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (equal to -P ACCEPT)</span></span><br><span class="line">iptables -A OUTPUT -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Permit answers on already established connections</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and permit new connections related to established ones</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (e.g. port mode ftp)</span></span><br><span class="line">iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log everything <span class="keyword">else</span>. What<span class="string">'s Windows'</span> latest exploitable vulnerability?</span></span><br><span class="line">iptables -A INPUT -j LOG --log-prefix "FIREWALL:INPUT "</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End <span class="variable">$rc_base</span>/rc.iptables</span></span><br><span class="line">EOF</span><br><span class="line">chmod 700 /etc/rc.d/rc.iptables</span><br></pre></td></tr></table></figure>
<h4 id="libcap"><a class="header-anchor" href="#libcap">¶</a>libcap</h4>
<ul>
<li>libcap</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/l/libcap-2.26.tar.xz</span><br><span class="line">tar -xvf libcap-2.26.tar.xz</span><br><span class="line">cd libcap-2.26</span><br><span class="line">make -C pam_cap</span><br><span class="line">install -v -m755 pam_cap/pam_cap.so /lib/security &amp;&amp;</span><br><span class="line">install -v -m644 pam_cap/capability.conf /etc/security</span><br></pre></td></tr></table></figure>
<ul>
<li>libcap依赖linux-pam</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/l/Linux-PAM-1.3.0.tar.bz2</span><br><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/l/Linux-PAM-1.2.0-docs.tar.bz2</span><br><span class="line">tar -jxvf Linux-PAM-1.3.0.tar.bz2</span><br><span class="line">cd Linux-PAM-1.3.0</span><br><span class="line">tar -xf ../Linux-PAM-1.2.0-docs.tar.bz2 --strip-components=1</span><br><span class="line">./configure --prefix=/usr                    \</span><br><span class="line">            --sysconfdir=/etc                \</span><br><span class="line">            --libdir=/usr/lib                \</span><br><span class="line">            --disable-regenerate-docu        \</span><br><span class="line">            --enable-securedir=/lib/security \</span><br><span class="line">            --docdir=/usr/share/doc/Linux-PAM-1.3.0 &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">install -v -m755 -d /etc/pam.d &amp;&amp;</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/pam.d/other &lt;&lt; "EOF"</span><br><span class="line">auth     required       pam_deny.so</span><br><span class="line">account  required       pam_deny.so</span><br><span class="line">password required       pam_deny.so</span><br><span class="line">session  required       pam_deny.so</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">make install &amp;&amp;</span><br><span class="line">chmod -v 4755 /sbin/unix_chkpwd &amp;&amp;</span><br><span class="line"></span><br><span class="line">for file in pam pam_misc pamc</span><br><span class="line">do</span><br><span class="line">  mv -v /usr/lib/lib$&#123;file&#125;.so.* /lib &amp;&amp;</span><br><span class="line">  ln -sfv ../../lib/$(readlink /usr/lib/lib$&#123;file&#125;.so) /usr/lib/lib$&#123;file&#125;.so</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置linux-pam</span></span><br><span class="line"></span><br><span class="line">install -vdm755 /etc/pam.d</span><br><span class="line">cat &gt; /etc/pam.d/system-account &lt;&lt; "EOF" &amp;&amp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/system-account</span></span><br><span class="line"></span><br><span class="line">account   required    pam_unix.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/system-account</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/pam.d/system-auth &lt;&lt; "EOF" &amp;&amp;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/system-auth</span></span><br><span class="line"></span><br><span class="line">auth      required    pam_unix.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/system-auth</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/pam.d/system-session &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/system-session</span></span><br><span class="line"></span><br><span class="line">session   required    pam_unix.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/system-session</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/system-password</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check new passwords <span class="keyword">for</span> strength (man pam_cracklib)</span></span><br><span class="line">password  required    pam_cracklib.so    authtok_type=UNIX retry=1 difok=5 \</span><br><span class="line">                                         minlen=9 dcredit=1 ucredit=1 \</span><br><span class="line">                                         lcredit=1 ocredit=1 minclass=0 \</span><br><span class="line">                                         maxrepeat=0 maxsequence=0 \</span><br><span class="line">                                         maxclassrepeat=0 \</span><br><span class="line">                                         dictpath=/lib/cracklib/pw_dict</span><br><span class="line"><span class="meta">#</span><span class="bash"> use sha512 <span class="built_in">hash</span> <span class="keyword">for</span> encryption, use shadow, and use the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> authentication token (chosen password) <span class="built_in">set</span> by pam_cracklib</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> above (or any previous modules)</span></span><br><span class="line">password  required    pam_unix.so        sha512 shadow use_authtok</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/system-password</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/other</span></span><br><span class="line"></span><br><span class="line">auth        required        pam_warn.so</span><br><span class="line">auth        required        pam_deny.so</span><br><span class="line">account     required        pam_warn.so</span><br><span class="line">account     required        pam_deny.so</span><br><span class="line">password    required        pam_warn.so</span><br><span class="line">password    required        pam_deny.so</span><br><span class="line">session     required        pam_warn.so</span><br><span class="line">session     required        pam_deny.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/other</span></span><br></pre></td></tr></table></figure>
<h4 id="liboauth"><a class="header-anchor" href="#liboauth">¶</a>liboauth</h4>
<ul>
<li>liboauth</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/l/liboauth-1.0.3.tar.gz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/liboauth-1.0.3-openssl-1.1.0-3.patch</span><br><span class="line">tar -zxvf liboauth-1.0.3.tar.gz</span><br><span class="line">cd liboauth-1.0.3</span><br><span class="line">patch -Np1 -i ../liboauth-1.0.3-openssl-1.1.0-3.patch</span><br><span class="line">./configure --prefix=/usr --disable-static &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">install -v -dm755 /usr/share/doc/liboauth-1.0.3 &amp;&amp;</span><br><span class="line">cp -rv doc/html/* /usr/share/doc/liboauth-1.0.3</span><br></pre></td></tr></table></figure>
<ul>
<li>curl</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/c/curl-7.64.0.tar.xz</span><br><span class="line">tar xvf curl-7.64.0.tar.xz</span><br><span class="line">cd curl-7.64.0</span><br><span class="line">./configure --prefix=/usr                           \</span><br><span class="line">            --disable-static                        \</span><br><span class="line">            --enable-threaded-resolver              \</span><br><span class="line">            --with-ca-path=/etc/ssl/certs &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install &amp;&amp;</span><br><span class="line"></span><br><span class="line">rm -rf docs/examples/.deps &amp;&amp;</span><br><span class="line"></span><br><span class="line">find docs \( -name Makefile\* -o -name \*.1 -o -name \*.3 \) -exec rm &#123;&#125; \; &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -d -m755 /usr/share/doc/curl-7.64.0 &amp;&amp;</span><br><span class="line">cp -v -R docs/*     /usr/share/doc/curl-7.64.0</span><br></pre></td></tr></table></figure>
<h4 id="libpwquality"><a class="header-anchor" href="#libpwquality">¶</a>libpwquality</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/l/libpwquality-1.4.0.tar.bz2</span><br><span class="line">tar -jxvf libpwquality-1.4.0.tar.bz2</span><br><span class="line">cd libpwquality-1.4.0</span><br><span class="line">./configure --prefix=/usr --disable-static \</span><br><span class="line">            --with-securedir=/lib/security \</span><br><span class="line">            --with-python-binary=python3   &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta">#</span><span class="bash">配置libpwquality</span></span><br><span class="line">mv /etc/pam.d/system-password&#123;,.orig&#125; &amp;&amp;</span><br><span class="line">cat &gt; /etc/pam.d/system-password &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/system-password</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check new passwords <span class="keyword">for</span> strength (man pam_pwquality)</span></span><br><span class="line">password  required    pam_pwquality.so   authtok_type=UNIX retry=1 difok=1 \</span><br><span class="line">                                         minlen=8 dcredit=0 ucredit=0 \</span><br><span class="line">                                         lcredit=0 ocredit=0 minclass=1 \</span><br><span class="line">                                         maxrepeat=0 maxsequence=0 \</span><br><span class="line">                                         maxclassrepeat=0 geoscheck=0 \</span><br><span class="line">                                         dictcheck=1 usercheck=1 \</span><br><span class="line">                                         enforcing=1 badwords="" \</span><br><span class="line">                                         dictpath=/lib/cracklib/pw_dict</span><br><span class="line"><span class="meta">#</span><span class="bash"> use sha512 <span class="built_in">hash</span> <span class="keyword">for</span> encryption, use shadow, and use the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> authentication token (chosen password) <span class="built_in">set</span> by pam_pwquality</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> above (or any previous modules)</span></span><br><span class="line">password  required    pam_unix.so        sha512 shadow use_authtok</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/system-password</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h4 id="krb5"><a class="header-anchor" href="#krb5">¶</a>krb5</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/k/krb5-1.17.tar.gz</span><br><span class="line">tar -zxvf krb5-1.17.tar.gz</span><br><span class="line">cd krb5-1.17</span><br><span class="line"></span><br><span class="line">cd src &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed -i -e 's@\^u&#125;@^u cols 300&#125;@' tests/dejagnu/config/default.exp     &amp;&amp;</span><br><span class="line">sed -i -e '/eq 0/&#123;N;s/12 //&#125;'    plugins/kdb/db2/libdb2/test/run.test &amp;&amp;</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr            \</span><br><span class="line">            --sysconfdir=/etc        \</span><br><span class="line">            --localstatedir=/var/lib \</span><br><span class="line">            --with-system-et         \</span><br><span class="line">            --with-system-ss         \</span><br><span class="line">            --with-system-verto=no   \</span><br><span class="line">            --enable-dns-for-realm &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make install &amp;&amp;</span><br><span class="line"></span><br><span class="line">for f in gssapi_krb5 gssrpc k5crypto kadm5clnt kadm5srv \</span><br><span class="line">         kdb5 kdb_ldap krad krb5 krb5support verto ; do</span><br><span class="line"></span><br><span class="line">    find /usr/lib -type f -name "lib$f*.so*" -exec chmod -v 755 &#123;&#125; \;</span><br><span class="line">done          &amp;&amp;</span><br><span class="line"></span><br><span class="line">mv -v /usr/lib/libkrb5.so.3*        /lib &amp;&amp;</span><br><span class="line">mv -v /usr/lib/libk5crypto.so.3*    /lib &amp;&amp;</span><br><span class="line">mv -v /usr/lib/libkrb5support.so.0* /lib &amp;&amp;</span><br><span class="line"></span><br><span class="line">ln -v -sf ../../lib/libkrb5.so.3.3        /usr/lib/libkrb5.so        &amp;&amp;</span><br><span class="line">ln -v -sf ../../lib/libk5crypto.so.3.1    /usr/lib/libk5crypto.so    &amp;&amp;</span><br><span class="line">ln -v -sf ../../lib/libkrb5support.so.0.1 /usr/lib/libkrb5support.so &amp;&amp;</span><br><span class="line"></span><br><span class="line">mv -v /usr/bin/ksu /bin &amp;&amp;</span><br><span class="line">chmod -v 755 /bin/ksu   &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -dm755 /usr/share/doc/krb5-1.17 &amp;&amp;</span><br><span class="line">cp -vfr ../doc/*  /usr/share/doc/krb5-1.17</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置</span></span><br><span class="line">cat &gt; /etc/krb5.conf &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/krb5.conf</span></span><br><span class="line"></span><br><span class="line">[libdefaults]</span><br><span class="line">    default_realm = &lt;EXAMPLE.ORG&gt;</span><br><span class="line">    encrypt = true</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line">    &lt;EXAMPLE.ORG&gt; = &#123;</span><br><span class="line">        kdc = &lt;belgarath.example.org&gt;</span><br><span class="line">        admin_server = &lt;belgarath.example.org&gt;</span><br><span class="line">        dict_file = /usr/share/dict/words</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">[domain_realm]</span><br><span class="line">    .&lt;example.org&gt; = &lt;EXAMPLE.ORG&gt;</span><br><span class="line"></span><br><span class="line">[logging]</span><br><span class="line">    kdc = SYSLOG:INFO:AUTH</span><br><span class="line">    admin_server = SYSLOG:INFO:AUTH</span><br><span class="line">    default = SYSLOG:DEBUG:DAEMON</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/krb5.conf</span></span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash">密码不能被忘记</span></span><br><span class="line">kdb5_util create -r &lt;EXAMPLE.ORG&gt; -s</span><br><span class="line">kadmin.local</span><br><span class="line">kadmin.local: add_policy dict-only</span><br><span class="line">kadmin.local: addprinc -policy dict-only &lt;loginname&gt;</span><br><span class="line">kadmin.local: addprinc -randkey host/&lt;belgarath.example.org&gt;</span><br><span class="line">kadmin.local: ktadd host/&lt;belgarath.example.org&gt;</span><br><span class="line">/usr/sbin/krb5kdc</span><br><span class="line">kinit &lt;loginname&gt;</span><br><span class="line">klist</span><br><span class="line">ktutil</span><br><span class="line">ktutil: rkt /etc/krb5.keytab</span><br><span class="line">ktutil: l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置启动脚本</span></span><br><span class="line">cd /sources/blfs-bootscripts-20180105/</span><br><span class="line">make install-krb5</span><br></pre></td></tr></table></figure>
<h4 id="nss"><a class="header-anchor" href="#nss">¶</a>nss</h4>
<ul>
<li>nss</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">wget https://archive.mozilla.org/pub/security/nss/releases/NSS_3_42_1_RTM/src/nss-3.42.1.tar.gz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/nss-3.42.1-standalone-1.patch</span><br><span class="line">tar -zxvf nss-3.42.1.tar.gz</span><br><span class="line">cd nss-3.42.1</span><br><span class="line"></span><br><span class="line">patch -Np1 -i ../nss-3.42.1-standalone-1.patch &amp;&amp;</span><br><span class="line"></span><br><span class="line">cd nss &amp;&amp;</span><br><span class="line"></span><br><span class="line">make -j1 BUILD_OPT=1                  \</span><br><span class="line">  NSPR_INCLUDE_DIR=/usr/include/nspr  \</span><br><span class="line">  USE_SYSTEM_ZLIB=1                   \</span><br><span class="line">  ZLIB_LIBS=-lz                       \</span><br><span class="line">  NSS_ENABLE_WERROR=0                 \</span><br><span class="line"><span class="meta">  $</span><span class="bash">([ $(uname -m) = x86_64 ] &amp;&amp; <span class="built_in">echo</span> USE_64=1) \</span></span><br><span class="line"><span class="meta">  $</span><span class="bash">([ -f /usr/include/sqlite3.h ] &amp;&amp; <span class="built_in">echo</span> NSS_USE_SYSTEM_SQLITE=1)</span></span><br><span class="line"></span><br><span class="line">cd ../dist                                                          &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m755 Linux*/lib/*.so              /usr/lib              &amp;&amp;</span><br><span class="line">install -v -m644 Linux*/lib/&#123;*.chk,libcrmf.a&#125; /usr/lib              &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m755 -d                           /usr/include/nss      &amp;&amp;</span><br><span class="line">cp -v -RL &#123;public,private&#125;/nss/*              /usr/include/nss      &amp;&amp;</span><br><span class="line">chmod -v 644                                  /usr/include/nss/*    &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m755 Linux*/bin/&#123;certutil,nss-config,pk12util&#125; /usr/bin &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m644 Linux*/lib/pkgconfig/nss.pc  /usr/lib/pkgconfig</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置nss</span></span><br></pre></td></tr></table></figure>
<ul>
<li>nss依赖nspr</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget https://archive.mozilla.org/pub/nspr/releases/v4.20/src/nspr-4.20.tar.gz</span><br><span class="line">tar -zxvf nspr-4.20.tar.gz</span><br><span class="line">cd nspr-4.20</span><br><span class="line"></span><br><span class="line">cd nspr                                                     &amp;&amp;</span><br><span class="line">sed -ri 's#^(RELEASE_BINS =).*#\1#' pr/src/misc/Makefile.in &amp;&amp;</span><br><span class="line">sed -i 's#$(LIBRARY) ##'            config/rules.mk         &amp;&amp;</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr \</span><br><span class="line">            --with-mozilla \</span><br><span class="line">            --with-pthreads \</span><br><span class="line">            $([ $(uname -m) = x86_64 ] &amp;&amp; echo --enable-64bit) &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="polkit"><a class="header-anchor" href="#polkit">¶</a>polkit</h4>
<ul>
<li>polkit</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/p/polkit-0.115.tar.gz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/polkit-0.115-security_patch-3.patch</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>polkit依赖js52</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">zip</span></span><br><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/m/mozjs-60.1.0.tar.bz2</span><br><span class="line">tar -jxvf mozjs-60.1.0.tar.bz2</span><br><span class="line">cd mozjs-60.1.0</span><br></pre></td></tr></table></figure>
<ul>
<li>js52依赖zip</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.sourceforge.net/infozip/zip30.tar.gz</span><br><span class="line">tar -zxvf zip30.tar.gz</span><br><span class="line">cd zip30</span><br><span class="line">make -f unix/Makefile generic_gcc</span><br><span class="line">make prefix=/usr MANDIR=/usr/share/man/man1 -f unix/Makefile install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">icu</span></span><br><span class="line">wget http://download.icu-project.org/files/icu4c/63.1/icu4c-63_1-src.tgz</span><br><span class="line">tar -zxvf icu4c-63_1-src.tgz</span><br><span class="line">cd icu</span><br><span class="line"></span><br><span class="line">cd source                                    &amp;&amp;</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr                    &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="shadow"><a class="header-anchor" href="#shadow">¶</a>shadow</h4>
<ul>
<li>如果你安装了cracklib和linux-pam,需要重新安装</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/s/shadow-4.6.tar.xz</span><br><span class="line">tar -xvf shadow-4.6.tar.xz </span><br><span class="line">cd shadow-4.6</span><br><span class="line"></span><br><span class="line">sed -i 's/groups$(EXEEXT) //' src/Makefile.in &amp;&amp;</span><br><span class="line"></span><br><span class="line">find man -name Makefile.in -exec sed -i 's/groups\.1 / /'   &#123;&#125; \; &amp;&amp;</span><br><span class="line">find man -name Makefile.in -exec sed -i 's/getspnam\.3 / /' &#123;&#125; \; &amp;&amp;</span><br><span class="line">find man -name Makefile.in -exec sed -i 's/passwd\.5 / /'   &#123;&#125; \; &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed -i -e 's@#ENCRYPT_METHOD DES@ENCRYPT_METHOD SHA512@' \</span><br><span class="line">       -e 's@/var/spool/mail@/var/mail@' etc/login.defs &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed -i 's/1000/999/' etc/useradd                           &amp;&amp;</span><br><span class="line"></span><br><span class="line">./configure --sysconfdir=/etc --with-group-name-max-length=32 &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install &amp;&amp;</span><br><span class="line">mv -v /usr/bin/passwd /bin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置</span></span><br><span class="line">sed -i 's/yes/no/' /etc/default/useradd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置/etc/login.defs</span></span><br><span class="line">install -v -m644 /etc/login.defs /etc/login.defs.orig &amp;&amp;</span><br><span class="line">for FUNCTION in FAIL_DELAY               \</span><br><span class="line">                FAILLOG_ENAB             \</span><br><span class="line">                LASTLOG_ENAB             \</span><br><span class="line">                MAIL_CHECK_ENAB          \</span><br><span class="line">                OBSCURE_CHECKS_ENAB      \</span><br><span class="line">                PORTTIME_CHECKS_ENAB     \</span><br><span class="line">                QUOTAS_ENAB              \</span><br><span class="line">                CONSOLE MOTD_FILE        \</span><br><span class="line">                FTMP_FILE NOLOGINS_FILE  \</span><br><span class="line">                ENV_HZ PASS_MIN_LEN      \</span><br><span class="line">                SU_WHEEL_ONLY            \</span><br><span class="line">                CRACKLIB_DICTPATH        \</span><br><span class="line">                PASS_CHANGE_TRIES        \</span><br><span class="line">                PASS_ALWAYS_WARN         \</span><br><span class="line">                CHFN_AUTH ENCRYPT_METHOD \</span><br><span class="line">                ENVIRON_FILE</span><br><span class="line">do</span><br><span class="line">    sed -i "s/^$&#123;FUNCTION&#125;/# &amp;/" /etc/login.defs</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置/etc/pam.d/ </span></span><br><span class="line">cat &gt; /etc/pam.d/login &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/login</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set failure delay before next prompt to 3 seconds</span></span><br><span class="line">auth      optional    pam_faildelay.so  delay=3000000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check to make sure that the user is allowed to login</span></span><br><span class="line">auth      requisite   pam_nologin.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check to make sure that root is allowed to login</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disabled by default. You will need to create /etc/securetty</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file <span class="keyword">for</span> this module to <span class="keyword">function</span>. See man 5 securetty.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">auth      required    pam_securetty.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Additional group memberships - disabled by default</span></span><br><span class="line"><span class="meta">#</span><span class="bash">auth      optional    pam_group.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system auth settings</span></span><br><span class="line">auth      include     system-auth</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> check access <span class="keyword">for</span> the user</span></span><br><span class="line">account   required    pam_access.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system account settings</span></span><br><span class="line">account   include     system-account</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set default environment variables <span class="keyword">for</span> the user</span></span><br><span class="line">session   required    pam_env.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set resource limits <span class="keyword">for</span> the user</span></span><br><span class="line">session   required    pam_limits.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Display date of last login - Disabled by default</span></span><br><span class="line"><span class="meta">#</span><span class="bash">session   optional    pam_lastlog.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Display the message of the day - Disabled by default</span></span><br><span class="line"><span class="meta">#</span><span class="bash">session   optional    pam_motd.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check user<span class="string">'s mail - Disabled by default</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">session   optional    pam_mail.so      standard quiet</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system session and password settings</span></span><br><span class="line">session   include     system-session</span><br><span class="line">password  include     system-password</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/login</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置passwd文件</span></span><br><span class="line">cat &gt; /etc/pam.d/passwd &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/passwd</span></span><br><span class="line"></span><br><span class="line">password  include     system-password</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/passwd</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置su文件</span></span><br><span class="line">cat &gt; /etc/pam.d/su &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/su</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> always allow root</span></span><br><span class="line">auth      sufficient  pam_rootok.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Allow users <span class="keyword">in</span> the wheel group to execute su without a password</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disabled by default</span></span><br><span class="line"><span class="meta">#</span><span class="bash">auth      sufficient  pam_wheel.so trust use_uid</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system auth settings</span></span><br><span class="line">auth      include     system-auth</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">limit</span> su to users <span class="keyword">in</span> the wheel group</span></span><br><span class="line">auth      required    pam_wheel.so use_uid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system account settings</span></span><br><span class="line">account   include     system-account</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set default environment variables <span class="keyword">for</span> the service user</span></span><br><span class="line">session   required    pam_env.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system session settings</span></span><br><span class="line">session   include     system-session</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/su</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置change文件</span></span><br><span class="line">cat &gt; /etc/pam.d/chage &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/chage</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> always allow root</span></span><br><span class="line">auth      sufficient  pam_rootok.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system auth, account, and session settings</span></span><br><span class="line">auth      include     system-auth</span><br><span class="line">account   include     system-account</span><br><span class="line">session   include     system-session</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Always permit <span class="keyword">for</span> authentication updates</span></span><br><span class="line">password  required    pam_permit.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/chage</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">其他程序</span></span><br><span class="line">for PROGRAM in chfn chgpasswd chpasswd chsh groupadd groupdel \</span><br><span class="line">               groupmems groupmod newusers useradd userdel usermod</span><br><span class="line">do</span><br><span class="line">    install -v -m644 /etc/pam.d/chage /etc/pam.d/$&#123;PROGRAM&#125;</span><br><span class="line">    sed -i "s/chage/$PROGRAM/" /etc/pam.d/$&#123;PROGRAM&#125;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置登录访问</span></span><br><span class="line">[ -f /etc/login.access ] &amp;&amp; mv -v /etc/login.access&#123;,.NOUSE&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">配置资源限制</span></span><br><span class="line">[ -f /etc/limits ] &amp;&amp; mv -v /etc/limits&#123;,.NOUSE&#125;</span><br></pre></td></tr></table></figure>
<h4 id="stunnel"><a class="header-anchor" href="#stunnel">¶</a>stunnel</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/s/stunnel-5.50.tar.gz</span><br><span class="line">tar -zxvf stunnel-5.50.tar.gz </span><br><span class="line">cd stunnel-5.50</span><br><span class="line"></span><br><span class="line">groupadd -g 51 stunnel &amp;&amp;</span><br><span class="line">useradd -c "stunnel Daemon" -d /var/lib/stunnel \</span><br><span class="line">        -g stunnel -s /bin/false -u 51 stunnel</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr        \</span><br><span class="line">            --sysconfdir=/etc    \</span><br><span class="line">            --localstatedir=/var \</span><br><span class="line">            --disable-systemd    &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make docdir=/usr/share/doc/stunnel-5.50 install</span><br><span class="line">install -v -m750 -o stunnel -g stunnel -d /var/lib/stunnel/run &amp;&amp;</span><br><span class="line">chown stunnel:stunnel /var/lib/stunnel</span><br><span class="line"></span><br><span class="line">cat &gt;/etc/stunnel/stunnel.conf &lt;&lt; "EOF"</span><br><span class="line">; File: /etc/stunnel/stunnel.conf</span><br><span class="line"></span><br><span class="line">; Note: The pid and output locations are relative to the chroot location.</span><br><span class="line"></span><br><span class="line">pid    = /run/stunnel.pid</span><br><span class="line">chroot = /var/lib/stunnel</span><br><span class="line">client = no</span><br><span class="line">setuid = stunnel</span><br><span class="line">setgid = stunnel</span><br><span class="line">cert   = /etc/stunnel/stunnel.pem</span><br><span class="line"></span><br><span class="line">;debug = 7</span><br><span class="line">;output = stunnel.log</span><br><span class="line"></span><br><span class="line">;[https]</span><br><span class="line">;accept  = 443</span><br><span class="line">;connect = 80</span><br><span class="line">;; "TIMEOUTclose = 0" is a workaround for a design flaw in Microsoft SSL</span><br><span class="line">;; Microsoft implementations do not use SSL close-notify alert and thus</span><br><span class="line">;; they are vulnerable to truncation attacks</span><br><span class="line">;TIMEOUTclose = 0</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置开机启动</span></span><br><span class="line">cd /sources/blfs-bootscripts-20180105/</span><br><span class="line">make install-stunnel</span><br></pre></td></tr></table></figure>
<h4 id="sudo"><a class="header-anchor" href="#sudo">¶</a>sudo</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/s/sudo-1.8.27.tar.gz </span><br><span class="line">tar -zxvf sudo-1.8.27.tar.gz</span><br><span class="line">cd sudo-1.8.27</span><br><span class="line">./configure --prefix=/usr              \</span><br><span class="line">            --libexecdir=/usr/lib      \</span><br><span class="line">            --with-secure-path         \</span><br><span class="line">            --with-all-insults         \</span><br><span class="line">            --with-env-editor          \</span><br><span class="line">            --docdir=/usr/share/doc/sudo-1.8.27 \</span><br><span class="line">            --with-passprompt="[sudo] password for %p: " &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make install &amp;&amp;</span><br><span class="line">ln -sfv libsudo_util.so.0.0.0 /usr/lib/sudo/libsudo_util.so.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置sudo</span></span><br><span class="line">cat &gt; /etc/sudoers.d/sudo &lt;&lt; "EOF"</span><br><span class="line">Defaults secure_path="/usr/bin:/bin:/usr/sbin:/sbin"</span><br><span class="line"><span class="meta">%</span><span class="bash">wheel ALL=(ALL) ALL</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/pam.d/sudo &lt;&lt; "EOF"</span><br><span class="line"><span class="meta">#</span><span class="bash"> Begin /etc/pam.d/sudo</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include the default auth settings</span></span><br><span class="line">auth      include     system-auth</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include the default account settings</span></span><br><span class="line">account   include     system-account</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set default environment variables <span class="keyword">for</span> the service user</span></span><br><span class="line">session   required    pam_env.so</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> include system session defaults</span></span><br><span class="line">session   include     system-session</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> End /etc/pam.d/sudo</span></span><br><span class="line">EOF</span><br><span class="line">chmod 644 /etc/pam.d/sudo</span><br></pre></td></tr></table></figure>
<h4 id="tripwire"><a class="header-anchor" href="#tripwire">¶</a>tripwire</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/t/tripwire-open-source-2.4.3.7.tar.gz</span><br><span class="line">tar -zxvf tripwire-open-source-2.4.3.7.tar.gz</span><br><span class="line">cd tripwire-open-source-2.4.3.7</span><br><span class="line"></span><br><span class="line">sed -e '/^CLOBBER/s/false/true/'         \</span><br><span class="line">    -e 's|TWDB="$&#123;prefix&#125;|TWDB="/var|'   \</span><br><span class="line">    -e '/TWMAN/ s|$&#123;prefix&#125;|/usr/share|' \</span><br><span class="line">    -e '/TWDOCS/s|$&#123;prefix&#125;/doc/tripwire|/usr/share/doc/tripwire-2.4.3.7|' \</span><br><span class="line">    -i installer/install.cfg                               &amp;&amp;</span><br><span class="line"></span><br><span class="line">find . -name Makefile.am | xargs                           \</span><br><span class="line">    sed -i 's/^[[:alpha:]_]*_HEADERS.*=/noinst_HEADERS =/' &amp;&amp;</span><br><span class="line"></span><br><span class="line">sed '/dist/d' -i man/man?/Makefile.am                      &amp;&amp;</span><br><span class="line">autoreconf -fi                                             &amp;&amp;</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc/tripwire       &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">twadmin --create-polfile --site-keyfile /etc/tripwire/site.key \</span><br><span class="line">    /etc/tripwire/twpol.txt &amp;&amp;</span><br><span class="line">tripwire --init</span><br></pre></td></tr></table></figure>
<h4 id="volume-key"><a class="header-anchor" href="#volume-key">¶</a>volume_key</h4>
<ul>
<li>volume_key</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/v/volume_key-0.3.12.tar.gz</span><br><span class="line">tar -zxvf volume_key-0.3.12.tar.gz</span><br><span class="line">cd volume_key-volume_key-0.3.12/</span><br><span class="line">autoreconf -fiv              &amp;&amp;</span><br><span class="line">./configure --prefix=/usr    \</span><br><span class="line">            --without-python &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>volume_key依赖cryptsetup</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo wget http://ftp.lfs-matrix.net/pub/blfs/8.4/c/cryptsetup-2.0.6.tar.xz</span><br><span class="line">tar -xvf cryptsetup-2.0.6.tar.xz</span><br><span class="line">cd cryptsetup-2.0.6</span><br><span class="line">./configure --prefix=/usr \</span><br><span class="line">            --with-crypto_backend=openssl &amp;&amp;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>cryptsetup的依赖json-c</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/j/json-c-0.13.1.tar.gz</span><br><span class="line"> tar -zxvf json-c-0.13.1.tar.gz</span><br><span class="line">cd json-c-0.13.1</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr --disable-static &amp;&amp;</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">rack-leen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/06/12/BLFS/BLFS%E6%9E%84%E5%BB%BA04-%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/">http://yoursite.com/2019/06/12/BLFS/BLFS%E6%9E%84%E5%BB%BA04-%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">rack-leen's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.png"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/06/12/Java/Java%E6%A1%86%E6%9E%B6/Shiro/Spring%E6%95%B4%E5%90%88shiro/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Spring整合shiro</span></div></a></div><div class="next-post pull_right"><a href="/2019/06/11/BLFS/BLFS%E6%9E%84%E5%BB%BA02-LFS%E9%85%8D%E7%BD%AE%E4%B9%8B%E5%90%8E%E7%9A%84%E9%97%AE%E9%A2%98/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>BLFS构建02-LFS配置之后的问题</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'MfUQEbakEraMCGDu6l1C7pHQ-gzGzoHsz',
  appKey:'pGQbdqjwcLQijkbDoU09liQ9',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></div><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By rack-leen</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-sun-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script async src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="/js/third-party/canvas-nest.js"></script><script src="/js/baidupush.js"> </script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/third-party/ClickShowText.js"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":140,"height":260},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>