<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>BLFS构建05-文件系统和磁盘管理 | rack-leen's blog</title><meta name="description" content="BLFS构建05-文件系统和磁盘管理"><meta name="keywords" content=""><meta name="author" content="rack-leen"><meta name="copyright" content="rack-leen"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="BLFS构建05-文件系统和磁盘管理"><meta name="twitter:description" content="BLFS构建05-文件系统和磁盘管理"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta property="og:type" content="article"><meta property="og:title" content="BLFS构建05-文件系统和磁盘管理"><meta property="og:url" content="http://yoursite.com/2019/06/16/BLFS/BLFS%E6%9E%84%E5%BB%BA05-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"><meta property="og:site_name" content="rack-leen's blog"><meta property="og:description" content="BLFS构建05-文件系统和磁盘管理"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'true'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="http://yoursite.com/2019/06/16/BLFS/BLFS%E6%9E%84%E5%BB%BA05-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"><link rel="prev" title="BLFS构建06-常用库和工具" href="http://yoursite.com/2019/06/19/BLFS/BLFS%E6%9E%84%E5%BB%BA06-%E5%B8%B8%E7%94%A8%E5%BA%93%E5%92%8C%E5%B7%A5%E5%85%B7/"><link rel="next" title="Java技术栈" href="http://yoursite.com/2019/06/12/%E6%8A%80%E6%9C%AF%E6%A0%88/Java%E6%8A%80%E6%9C%AF%E6%A0%88/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"PIBV7VGBEP","apiKey":"5b1fef2837ae17299ea73b8c5b0bfad5","indexName":"rack","hits":5000,"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://rack-leen.top/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: 'true',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">rack-leen's blog</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Home"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">181</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">50</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">65</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Home"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#blfs构建05-文件系统和磁盘管理"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">BLFS构建05-文件系统和磁盘管理</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#构建一个initramfs"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">构建一个initramfs</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#btrfs-progs"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">btrfs-progs</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#dosfstools"><span class="toc_mobile_items-number">1.3.</span> <span class="toc_mobile_items-text">dosfstools</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#fuse"><span class="toc_mobile_items-number">1.4.</span> <span class="toc_mobile_items-text">fuse</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#fuse2-9-7"><span class="toc_mobile_items-number">1.5.</span> <span class="toc_mobile_items-text">fuse2.9.7</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#jfsutils"><span class="toc_mobile_items-number">1.6.</span> <span class="toc_mobile_items-text">jfsutils</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#软件磁盘阵列mdadm"><span class="toc_mobile_items-number">1.7.</span> <span class="toc_mobile_items-text">软件磁盘阵列mdadm</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#parted"><span class="toc_mobile_items-number">1.8.</span> <span class="toc_mobile_items-text">parted</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#ntfs-3g-微软ntfs"><span class="toc_mobile_items-number">1.9.</span> <span class="toc_mobile_items-text">ntfs-3g(微软ntfs)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#gptfdisk"><span class="toc_mobile_items-number">1.10.</span> <span class="toc_mobile_items-text">gptfdisk</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#reiserfsprogs"><span class="toc_mobile_items-number">1.11.</span> <span class="toc_mobile_items-text">reiserfsprogs</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#smartmontools"><span class="toc_mobile_items-number">1.12.</span> <span class="toc_mobile_items-text">smartmontools</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#sshfs"><span class="toc_mobile_items-number">1.13.</span> <span class="toc_mobile_items-text">sshfs</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#xfsprogs"><span class="toc_mobile_items-number">1.14.</span> <span class="toc_mobile_items-text">xfsprogs</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#blfs构建05-文件系统和磁盘管理"><span class="toc-number">1.</span> <span class="toc-text">BLFS构建05-文件系统和磁盘管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#构建一个initramfs"><span class="toc-number">1.1.</span> <span class="toc-text">构建一个initramfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#btrfs-progs"><span class="toc-number">1.2.</span> <span class="toc-text">btrfs-progs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dosfstools"><span class="toc-number">1.3.</span> <span class="toc-text">dosfstools</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fuse"><span class="toc-number">1.4.</span> <span class="toc-text">fuse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fuse2-9-7"><span class="toc-number">1.5.</span> <span class="toc-text">fuse2.9.7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jfsutils"><span class="toc-number">1.6.</span> <span class="toc-text">jfsutils</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#软件磁盘阵列mdadm"><span class="toc-number">1.7.</span> <span class="toc-text">软件磁盘阵列mdadm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parted"><span class="toc-number">1.8.</span> <span class="toc-text">parted</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ntfs-3g-微软ntfs"><span class="toc-number">1.9.</span> <span class="toc-text">ntfs-3g(微软ntfs)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gptfdisk"><span class="toc-number">1.10.</span> <span class="toc-text">gptfdisk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reiserfsprogs"><span class="toc-number">1.11.</span> <span class="toc-text">reiserfsprogs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#smartmontools"><span class="toc-number">1.12.</span> <span class="toc-text">smartmontools</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sshfs"><span class="toc-number">1.13.</span> <span class="toc-text">sshfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xfsprogs"><span class="toc-number">1.14.</span> <span class="toc-text">xfsprogs</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">BLFS构建05-文件系统和磁盘管理</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-06-16<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-06-16</time><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon" aria-hidden="true"></i><span>字数总计: </span><span class="word-count">4.8k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon" aria-hidden="true"></i><span>阅读时长: 29 分钟</span><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h3 id="blfs构建05-文件系统和磁盘管理"><a class="header-anchor" href="#blfs构建05-文件系统和磁盘管理">¶</a>BLFS构建05-文件系统和磁盘管理</h3>
<h4 id="构建一个initramfs"><a class="header-anchor" href="#构建一个initramfs">¶</a>构建一个initramfs</h4>
<ul>
<li>创建安装脚本/sbin/mkinitramfs</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /sbin/mkinitramfs &lt;&lt; <span class="string">"EOF"</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># This file based in part on the mkinitramfs script for the LFS LiveCD</span></span><br><span class="line"><span class="comment"># written by Alexander E. Patrakov and Jeremy Huntwork.</span></span><br><span class="line"></span><br><span class="line">copy()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">local</span> file</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$2</span>"</span> == <span class="string">"lib"</span> ]; <span class="keyword">then</span></span><br><span class="line">    file=$(PATH=/lib:/usr/lib <span class="built_in">type</span> -p <span class="variable">$1</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    file=$(<span class="built_in">type</span> -p <span class="variable">$1</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ -n <span class="variable">$file</span> ] ; <span class="keyword">then</span></span><br><span class="line">    cp <span class="variable">$file</span> <span class="variable">$WDIR</span>/<span class="variable">$2</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Missing required file: <span class="variable">$1</span> for directory <span class="variable">$2</span>"</span></span><br><span class="line">    rm -rf <span class="variable">$WDIR</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$1</span> ] ; <span class="keyword">then</span></span><br><span class="line">  INITRAMFS_FILE=initrd.img-no-kmods</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  KERNEL_VERSION=<span class="variable">$1</span></span><br><span class="line">  INITRAMFS_FILE=initrd.img-<span class="variable">$KERNEL_VERSION</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$KERNEL_VERSION</span>"</span> ] &amp;&amp; [ ! -d <span class="string">"/lib/modules/<span class="variable">$1</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"No modules directory named <span class="variable">$1</span>"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span> <span class="string">"Creating <span class="variable">$INITRAMFS_FILE</span>... "</span></span><br><span class="line"></span><br><span class="line">binfiles=<span class="string">"sh cat cp dd killall ls mkdir mknod mount "</span></span><br><span class="line">binfiles=<span class="string">"<span class="variable">$binfiles</span> umount sed sleep ln rm uname"</span></span><br><span class="line">binfiles=<span class="string">"<span class="variable">$binfiles</span> readlink basename"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Systemd installs udevadm in /bin. Other udev implementations have it in /sbin</span></span><br><span class="line"><span class="keyword">if</span> [ -x /bin/udevadm ] ; <span class="keyword">then</span> binfiles=<span class="string">"<span class="variable">$binfiles</span> udevadm"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">sbinfiles=<span class="string">"modprobe blkid switch_root"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Optional files and locations</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> mdadm mdmon udevd udevadm; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ -x /sbin/<span class="variable">$f</span> ] ; <span class="keyword">then</span> sbinfiles=<span class="string">"<span class="variable">$sbinfiles</span> <span class="variable">$f</span>"</span>; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">unsorted=$(mktemp /tmp/unsorted.XXXXXXXXXX)</span><br><span class="line"></span><br><span class="line">DATADIR=/usr/share/mkinitramfs</span><br><span class="line">INITIN=init.in</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a temporary working directory</span></span><br><span class="line">WDIR=$(mktemp -d /tmp/initrd-work.XXXXXXXXXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create base directory structure</span></span><br><span class="line">mkdir -p <span class="variable">$WDIR</span>/&#123;bin,dev,lib/firmware,run,sbin,sys,proc,usr&#125;</span><br><span class="line">mkdir -p <span class="variable">$WDIR</span>/etc/&#123;modprobe.d,udev/rules.d&#125;</span><br><span class="line">touch <span class="variable">$WDIR</span>/etc/modprobe.d/modprobe.conf</span><br><span class="line">ln -s lib <span class="variable">$WDIR</span>/lib64</span><br><span class="line">ln -s ../bin <span class="variable">$WDIR</span>/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create necessary device nodes</span></span><br><span class="line">mknod -m 640 <span class="variable">$WDIR</span>/dev/console c 5 1</span><br><span class="line">mknod -m 664 <span class="variable">$WDIR</span>/dev/null    c 1 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the udev configuration files</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/udev/udev.conf ]; <span class="keyword">then</span></span><br><span class="line">  cp /etc/udev/udev.conf <span class="variable">$WDIR</span>/etc/udev/udev.conf</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> $(find /etc/udev/rules.d/ -<span class="built_in">type</span> f) ; <span class="keyword">do</span></span><br><span class="line">  cp <span class="variable">$file</span> <span class="variable">$WDIR</span>/etc/udev/rules.d</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install any firmware present</span></span><br><span class="line">cp -a /lib/firmware <span class="variable">$WDIR</span>/lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the RAID configuration file if present</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/mdadm.conf ] ; <span class="keyword">then</span></span><br><span class="line">  cp /etc/mdadm.conf <span class="variable">$WDIR</span>/etc</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the init file</span></span><br><span class="line">install -m0755 <span class="variable">$DATADIR</span>/<span class="variable">$INITIN</span> <span class="variable">$WDIR</span>/init</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [  -n <span class="string">"<span class="variable">$KERNEL_VERSION</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ -x /bin/kmod ] ; <span class="keyword">then</span></span><br><span class="line">    binfiles=<span class="string">"<span class="variable">$binfiles</span> kmod"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    binfiles=<span class="string">"<span class="variable">$binfiles</span> lsmod"</span></span><br><span class="line">    sbinfiles=<span class="string">"<span class="variable">$sbinfiles</span> insmod"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install basic binaries</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable">$binfiles</span> ; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ -e /bin/<span class="variable">$f</span> ]; <span class="keyword">then</span> d=<span class="string">"/bin"</span>; <span class="keyword">else</span> d=<span class="string">"/usr/bin"</span>; <span class="keyword">fi</span></span><br><span class="line">  ldd <span class="variable">$d</span>/<span class="variable">$f</span> | sed <span class="string">"s/\t//"</span> | cut -d <span class="string">" "</span> -f1 &gt;&gt; <span class="variable">$unsorted</span></span><br><span class="line">  copy <span class="variable">$d</span>/<span class="variable">$f</span> bin</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add lvm if present</span></span><br><span class="line"><span class="keyword">if</span> [ -x /sbin/lvm ] ; <span class="keyword">then</span> sbinfiles=<span class="string">"<span class="variable">$sbinfiles</span> lvm dmsetup"</span>; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> <span class="variable">$sbinfiles</span> ; <span class="keyword">do</span></span><br><span class="line">  ldd /sbin/<span class="variable">$f</span> | sed <span class="string">"s/\t//"</span> | cut -d <span class="string">" "</span> -f1 &gt;&gt; <span class="variable">$unsorted</span></span><br><span class="line">  copy <span class="variable">$f</span> sbin</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add udevd libraries if not in /sbin</span></span><br><span class="line"><span class="keyword">if</span> [ -x /lib/udev/udevd ] ; <span class="keyword">then</span></span><br><span class="line">  ldd /lib/udev/udevd | sed <span class="string">"s/\t//"</span> | cut -d <span class="string">" "</span> -f1 &gt;&gt; <span class="variable">$unsorted</span></span><br><span class="line"><span class="keyword">elif</span> [ -x /lib/systemd/systemd-udevd ] ; <span class="keyword">then</span></span><br><span class="line">  ldd /lib/systemd/systemd-udevd | sed <span class="string">"s/\t//"</span> | cut -d <span class="string">" "</span> -f1 &gt;&gt; <span class="variable">$unsorted</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add module symlinks if appropriate</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$KERNEL_VERSION</span>"</span> ] &amp;&amp; [ -x /bin/kmod ] ; <span class="keyword">then</span></span><br><span class="line">  ln -s kmod <span class="variable">$WDIR</span>/bin/lsmod</span><br><span class="line">  ln -s kmod <span class="variable">$WDIR</span>/bin/insmod</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add lvm symlinks if appropriate</span></span><br><span class="line"><span class="comment"># Also copy the lvm.conf file</span></span><br><span class="line"><span class="keyword">if</span>  [ -x /sbin/lvm ] ; <span class="keyword">then</span></span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/lvchange</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/lvrename</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/lvextend</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/lvcreate</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/lvdisplay</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/lvscan</span><br><span class="line"></span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/pvchange</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/pvck</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/pvcreate</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/pvdisplay</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/pvscan</span><br><span class="line"></span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/vgchange</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/vgcreate</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/vgscan</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/vgrename</span><br><span class="line">  ln -s lvm <span class="variable">$WDIR</span>/sbin/vgck</span><br><span class="line">  <span class="comment"># Conf file(s)</span></span><br><span class="line">  cp -a /etc/lvm <span class="variable">$WDIR</span>/etc</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install libraries</span></span><br><span class="line">sort <span class="variable">$unsorted</span> | uniq | <span class="keyword">while</span> <span class="built_in">read</span> library ; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$library</span>"</span> == <span class="string">"linux-vdso.so.1"</span> ] ||</span><br><span class="line">     [ <span class="string">"<span class="variable">$library</span>"</span> == <span class="string">"linux-gate.so.1"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">continue</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  copy <span class="variable">$library</span> lib</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -d /lib/udev ]; <span class="keyword">then</span></span><br><span class="line">  cp -a /lib/udev <span class="variable">$WDIR</span>/lib</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -d /lib/systemd ]; <span class="keyword">then</span></span><br><span class="line">  cp -a /lib/systemd <span class="variable">$WDIR</span>/lib</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the kernel modules if requested</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$KERNEL_VERSION</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  find                                                                        \</span><br><span class="line">     /lib/modules/<span class="variable">$KERNEL_VERSION</span>/kernel/&#123;crypto,fs,lib&#125;                      \</span><br><span class="line">     /lib/modules/<span class="variable">$KERNEL_VERSION</span>/kernel/drivers/&#123;block,ata,md,firewire&#125;      \</span><br><span class="line">     /lib/modules/<span class="variable">$KERNEL_VERSION</span>/kernel/drivers/&#123;scsi,message,pcmcia,virtio&#125; \</span><br><span class="line">     /lib/modules/<span class="variable">$KERNEL_VERSION</span>/kernel/drivers/usb/&#123;host,storage&#125;           \</span><br><span class="line">     -<span class="built_in">type</span> f 2&gt; /dev/null | cpio --make-directories -p --quiet <span class="variable">$WDIR</span></span><br><span class="line"></span><br><span class="line">  cp /lib/modules/<span class="variable">$KERNEL_VERSION</span>/modules.&#123;<span class="built_in">builtin</span>,order&#125;                     \</span><br><span class="line">            <span class="variable">$WDIR</span>/lib/modules/<span class="variable">$KERNEL_VERSION</span></span><br><span class="line"></span><br><span class="line">  depmod -b <span class="variable">$WDIR</span> <span class="variable">$KERNEL_VERSION</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">( <span class="built_in">cd</span> <span class="variable">$WDIR</span> ; find . | cpio -o -H newc --quiet | gzip -9 ) &gt; <span class="variable">$INITRAMFS_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove the temporary directory and file</span></span><br><span class="line">rm -rf <span class="variable">$WDIR</span> <span class="variable">$unsorted</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">"done.\n"</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>设置权限</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 0755 /sbin/mkinitramfs</span><br></pre></td></tr></table></figure>
<ul>
<li>创建需要的目录和文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/share/mkinitramfs</span><br><span class="line">cat &gt; /usr/share/mkinitramfs/init.in &lt;&lt; <span class="string">"EOF"</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line">problem()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Encountered a problem!\n\nDropping you to a shell.\n\n"</span></span><br><span class="line">   sh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">no_device()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"The device %s, which is supposed to contain the\n"</span> <span class="variable">$1</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"root file system, does not exist.\n"</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Please fix this problem and exit this shell.\n\n"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">no_mount()</span><br><span class="line">&#123;</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Could not mount device %s\n"</span> <span class="variable">$1</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Sleeping forever. Please reboot and fix the kernel command line.\n\n"</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Maybe the device is formatted with an unsupported file system?\n\n"</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Or maybe filesystem type autodetection went wrong, in which case\n"</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"you should add the rootfstype=... parameter to the kernel command line.\n\n"</span></span><br><span class="line">   <span class="built_in">printf</span> <span class="string">"Available partitions:\n"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do_mount_root()</span><br><span class="line">&#123;</span><br><span class="line">   mkdir /.root</span><br><span class="line">   [ -n <span class="string">"<span class="variable">$rootflags</span>"</span> ] &amp;&amp; rootflags=<span class="string">"<span class="variable">$rootflags</span>,"</span></span><br><span class="line">   rootflags=<span class="string">"<span class="variable">$rootflags</span><span class="variable">$ro</span>"</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> <span class="string">"<span class="variable">$root</span>"</span> <span class="keyword">in</span></span><br><span class="line">      /dev/* ) device=<span class="variable">$root</span> ;;</span><br><span class="line">      UUID=* ) <span class="built_in">eval</span> <span class="variable">$root</span>; device=<span class="string">"/dev/disk/by-uuid/<span class="variable">$UUID</span>"</span>  ;;</span><br><span class="line">      LABEL=*) <span class="built_in">eval</span> <span class="variable">$root</span>; device=<span class="string">"/dev/disk/by-label/<span class="variable">$LABEL</span>"</span> ;;</span><br><span class="line">      <span class="string">""</span>     ) <span class="built_in">echo</span> <span class="string">"No root device specified."</span> ; problem    ;;</span><br><span class="line">   <span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> [ ! -b <span class="string">"<span class="variable">$device</span>"</span> ] ; <span class="keyword">do</span></span><br><span class="line">       no_device <span class="variable">$device</span></span><br><span class="line">       problem</span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ! mount -n -t <span class="string">"<span class="variable">$rootfstype</span>"</span> -o <span class="string">"<span class="variable">$rootflags</span>"</span> <span class="string">"<span class="variable">$device</span>"</span> /.root ; <span class="keyword">then</span></span><br><span class="line">       no_mount <span class="variable">$device</span></span><br><span class="line">       cat /proc/partitions</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span> sleep 10000 ; <span class="keyword">done</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="built_in">echo</span> <span class="string">"Successfully mounted device <span class="variable">$root</span>"</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">init=/sbin/init</span><br><span class="line">root=</span><br><span class="line">rootdelay=</span><br><span class="line">rootfstype=auto</span><br><span class="line">ro=<span class="string">"ro"</span></span><br><span class="line">rootflags=</span><br><span class="line">device=</span><br><span class="line"></span><br><span class="line">mount -n -t devtmpfs devtmpfs /dev</span><br><span class="line">mount -n -t proc     proc     /proc</span><br><span class="line">mount -n -t sysfs    sysfs    /sys</span><br><span class="line">mount -n -t tmpfs    tmpfs    /run</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -r cmdline &lt; /proc/cmdline</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$cmdline</span> ; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$param</span> <span class="keyword">in</span></span><br><span class="line">    init=*      ) init=<span class="variable">$&#123;param#init=&#125;</span>             ;;</span><br><span class="line">    root=*      ) root=<span class="variable">$&#123;param#root=&#125;</span>             ;;</span><br><span class="line">    rootdelay=* ) rootdelay=<span class="variable">$&#123;param#rootdelay=&#125;</span>   ;;</span><br><span class="line">    rootfstype=*) rootfstype=<span class="variable">$&#123;param#rootfstype=&#125;</span> ;;</span><br><span class="line">    rootflags=* ) rootflags=<span class="variable">$&#123;param#rootflags=&#125;</span>   ;;</span><br><span class="line">    ro          ) ro=<span class="string">"ro"</span>                         ;;</span><br><span class="line">    rw          ) ro=<span class="string">"rw"</span>                         ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># udevd location depends on version</span></span><br><span class="line"><span class="keyword">if</span> [ -x /sbin/udevd ]; <span class="keyword">then</span></span><br><span class="line">  UDEVD=/sbin/udevd</span><br><span class="line"><span class="keyword">elif</span> [ -x /lib/udev/udevd ]; <span class="keyword">then</span></span><br><span class="line">  UDEVD=/lib/udev/udevd</span><br><span class="line"><span class="keyword">elif</span> [ -x /lib/systemd/systemd-udevd ]; <span class="keyword">then</span></span><br><span class="line">  UDEVD=/lib/systemd/systemd-udevd</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Cannot find udevd nor systemd-udevd"</span></span><br><span class="line">  problem</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;UDEVD&#125;</span> --daemon --resolve-names=never</span><br><span class="line">udevadm trigger</span><br><span class="line">udevadm settle</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/mdadm.conf ] ; <span class="keyword">then</span> mdadm -As                       ; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -x /sbin/vgchange  ] ; <span class="keyword">then</span> /sbin/vgchange -a y &gt; /dev/null ; <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$rootdelay</span>"</span>    ] ; <span class="keyword">then</span> sleep <span class="string">"<span class="variable">$rootdelay</span>"</span>              ; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">do_mount_root</span><br><span class="line"></span><br><span class="line">killall -w <span class="variable">$&#123;UDEVD##*/&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> switch_root /.root <span class="string">"<span class="variable">$init</span>"</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ul>
<li>需要依赖cpio</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget https://ftp.gnu.org/gnu/cpio/cpio-2.12.tar.bz2</span><br><span class="line">tar -jxvf cpio-2.12.tar.bz2</span><br><span class="line"><span class="built_in">cd</span> cpio-2.12</span><br><span class="line">./configure --prefix=/usr  --bindir=/bin --<span class="built_in">enable</span>-mt  --with-rmt=/usr/libexec/rmt</span><br><span class="line">make</span><br><span class="line">makeinfo --html            -o doc/html      doc/cpio.texi</span><br><span class="line">makeinfo --html --no-split -o doc/cpio.html doc/cpio.texi</span><br><span class="line">makeinfo --plaintext       -o doc/cpio.txt  doc/cpio.texi</span><br><span class="line">make install</span><br><span class="line">install -v -m755 -d /usr/share/doc/cpio-2.12/html</span><br><span class="line">install -v -m644    doc/html/* /usr/share/doc/cpio-2.12/html</span><br><span class="line">install -v -m644    doc/cpio.&#123;html,txt&#125; /usr/share/doc/cpio-2.12</span><br></pre></td></tr></table></figure>
<ul>
<li>也需要依赖lvm(可以不用)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/l/LVM2.2.03.02.tgz</span><br><span class="line">tar -zxvf LVM2.2.03.02.tgz </span><br><span class="line"><span class="built_in">cd</span> LVM2.2.03.02</span><br><span class="line"></span><br><span class="line">SAVEPATH=<span class="variable">$PATH</span>                  &amp;&amp;</span><br><span class="line">PATH=<span class="variable">$PATH</span>:/sbin:/usr/sbin      &amp;&amp;</span><br><span class="line">./configure --prefix=/usr       \</span><br><span class="line">            --<span class="built_in">exec</span>-prefix=      \</span><br><span class="line">            --<span class="built_in">enable</span>-cmdlib     \</span><br><span class="line">            --<span class="built_in">enable</span>-pkgconfig  \</span><br><span class="line">            --<span class="built_in">enable</span>-udev_sync</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">PATH=<span class="variable">$SAVEPATH</span>                  &amp;&amp;</span><br><span class="line"><span class="built_in">unset</span> SAVEPATH</span><br><span class="line"></span><br><span class="line">make -C tools install_dmsetup_dynamic &amp;&amp;</span><br><span class="line">make -C udev  install                 &amp;&amp;</span><br><span class="line">make -C libdm install</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>lvm依赖libaio</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.de.debian.org/debian/pool/main/liba/libaio/libaio_0.3.111.orig.tar.gz</span><br><span class="line">tar -zxvf libaio_0.3.111.orig.tar.gz </span><br><span class="line"><span class="built_in">cd</span> libaio-0.3.111/</span><br><span class="line">sed -i <span class="string">'/install.*libaio.a/s/^/#/'</span> src/Makefile</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>创建initramfs文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkinitramfs</span><br><span class="line"><span class="comment"># 编辑grub.cfg文件</span></span><br><span class="line"><span class="comment"># Generic initramfs and root fs identified by UUID</span></span><br><span class="line">menuentry <span class="string">"LFS Dev (LFS-7.0-Feb14) initrd, Linux 3.0.4"</span></span><br><span class="line">&#123;</span><br><span class="line">  linux  /vmlinuz-3.0.4-lfs-20120214 root=UUID=54b934a9-302d-415e-ac11-4988408eb0a8 ro</span><br><span class="line">  initrd /initrd.img-no-kmods</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#使用blkid命令查看磁盘UUID</span></span><br></pre></td></tr></table></figure>
<h4 id="btrfs-progs"><a class="header-anchor" href="#btrfs-progs">¶</a>btrfs-progs</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.kernel.org/pub/linux/kernel/people/kdave/btrfs-progs/btrfs-progs-v4.20.1.tar.xz</span><br><span class="line">tar -xvf btrfs-progs-v4.20.1.tar.xz</span><br><span class="line"><span class="built_in">cd</span> btrfs-progs-v4.20.1</span><br><span class="line">./configure --prefix=/usr --bindir=/bin  --libdir=/lib --<span class="built_in">disable</span>-zstd</span><br><span class="line">make</span><br><span class="line">make fssum</span><br><span class="line">sed -i <span class="string">'/found/s/^/: #/'</span> tests/convert-tests.sh</span><br><span class="line">mv tests/mkfs-tests/013-reserved-1M-for-single/test.sh&#123;,.broken&#125;          &amp;&amp;</span><br><span class="line">mv tests/convert-tests/010-reiserfs-basic/test.sh&#123;,.broken&#125;               &amp;&amp;</span><br><span class="line">mv tests/convert-tests/011-reiserfs-delete-all-rollback/test.sh&#123;,.broken&#125; &amp;&amp;</span><br><span class="line">mv tests/convert-tests/012-reiserfs-large-hole-extent/test.sh&#123;,.broken&#125;   &amp;&amp;</span><br><span class="line">mv tests/convert-tests/013-reiserfs-common-inode-flags/test.sh&#123;,.broken&#125;  &amp;&amp;</span><br><span class="line">mv tests/convert-tests/014-reiserfs-tail-handling/test.sh&#123;,.broken&#125;       &amp;&amp;</span><br><span class="line">mv tests/misc-tests/004-shrink-fs/test.sh&#123;,.broken&#125;                       &amp;&amp;</span><br><span class="line">mv tests/misc-tests/013-subvolume-sync-crash/test.sh&#123;,.broken&#125;            &amp;&amp;</span><br><span class="line">mv tests/misc-tests/025-zstd-compression/test.sh&#123;,.broken&#125;                &amp;&amp;</span><br><span class="line">mv tests/fuzz-tests/003-multi-check-unmounted/test.sh&#123;,.broken&#125;           &amp;&amp;</span><br><span class="line">mv tests/fuzz-tests/009-simple-zero-log/test.sh&#123;,.broken&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line"><span class="built_in">pushd</span> tests</span><br><span class="line">   ./fsck-tests.sh</span><br><span class="line">   ./mkfs-tests.sh</span><br><span class="line">   ./cli-tests.sh</span><br><span class="line">   ./convert-tests.sh</span><br><span class="line">   ./misc-tests.sh</span><br><span class="line">   ./fuzz-tests.sh</span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">ln -sfv ../../lib/$(readlink /lib/libbtrfs.so) /usr/lib/libbtrfs.so &amp;&amp;</span><br><span class="line">ln -sfv ../../lib/$(readlink /lib/libbtrfsutil.so) /usr/lib/libbtrfsutil.so &amp;&amp;</span><br><span class="line">rm -fv /lib/libbtrfs.&#123;a,so&#125; /lib/libbtrfsutil.&#123;a,so&#125; &amp;&amp;</span><br><span class="line">mv -v /bin/&#123;mkfs,fsck&#125;.btrfs /sbin</span><br></pre></td></tr></table></figure>
<ul>
<li>安装依赖LZO</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.oberhumer.com/opensource/lzo/download/lzo-2.10.tar.gz</span><br><span class="line">tar -zxvf lzo-2.10.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lzo-2.10</span><br><span class="line">./configure --prefix=/usr --<span class="built_in">enable</span>-shared --<span class="built_in">disable</span>-static --<span class="built_in">disable</span>-static</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>安装依赖xmlto</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://releases.pagure.org/xmlto/xmlto-0.0.28.tar.bz2</span><br></pre></td></tr></table></figure>
<ul>
<li>安装docbook-xml的依赖libxml2,sgml-common和unzip</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">wget http://xmlsoft.org/sources/libxml2-2.9.9.tar.gz</span><br><span class="line">wget http://www.w3.org/XML/Test/xmlts20130923.tar.gz </span><br><span class="line">tar -zxvf libxml2-2.9.9.tar.gz </span><br><span class="line"><span class="built_in">cd</span> libxml2-2.9.9</span><br><span class="line">./configure --prefix=/usr --<span class="built_in">disable</span>-static --with-history --with-python=/usr/bin/python3</span><br><span class="line">make</span><br><span class="line">tar xf ../xmlts20130923.tar.gz</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/s/sgml-common-0.6.3.tgz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/sgml-common-0.6.3-manpage-1.patch</span><br><span class="line">tar -zxvf sgml-common-0.6.3.tgz</span><br><span class="line"><span class="built_in">cd</span> sgml-common-0.6.3</span><br><span class="line">patch -Np1 -i ../sgml-common-0.6.3-manpage-1.patch</span><br><span class="line">autoreconf -f -i</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc</span><br><span class="line">make</span><br><span class="line">make docdir=/usr/share/doc install</span><br><span class="line">install-catalog --add /etc/sgml/sgml-ent.cat /usr/share/sgml/sgml-iso-entities-8879.1986/catalog</span><br><span class="line">install-catalog --add /etc/sgml/sgml-docbook.cat /etc/sgml/sgml-ent.cat</span><br><span class="line"></span><br><span class="line">wget wget http://ftp.lfs-matrix.net/pub/blfs/8.4/u/unzip60.tar.gz</span><br><span class="line">tar -zxvf unzip60.tar.gz</span><br><span class="line"><span class="built_in">cd</span> unzip60</span><br><span class="line">make -f unix/Makefile generic</span><br><span class="line">make prefix=/usr MANDIR=/usr/share/man/man1  -f unix/Makefile install</span><br></pre></td></tr></table></figure>
<ul>
<li>安装xmlto的依赖docbook-xml,docbook-xsl和libxslt</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docbook-xml</span></span><br><span class="line">mkdir docbook-xml ;  mv docbook-xml-4.5.zip docbook-xml</span><br><span class="line"><span class="built_in">cd</span> docbook-xml</span><br><span class="line">install -v -d -m755 /usr/share/xml/docbook/xml-dtd-4.5</span><br><span class="line">install -v -d -m755 /etc/xml</span><br><span class="line">chown -R root:root .</span><br><span class="line">cp -v -af docbook.cat *.dtd ent/ *.mod /usr/share/xml/docbook/xml-dtd-4.5</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置docbook</span></span><br><span class="line"><span class="keyword">if</span> [ ! -e /etc/xml/docbook ]; <span class="keyword">then</span></span><br><span class="line">    xmlcatalog --noout --create /etc/xml/docbook</span><br><span class="line"><span class="keyword">fi</span> &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//DTD DocBook XML V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//DTD DocBook XML CALS Table Model V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/calstblx.dtd"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//DTD XML Exchange Table Model 19990315//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/soextblx.dtd"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ELEMENTS DocBook XML Information Pool V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/dbpoolx.mod"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ELEMENTS DocBook XML Document Hierarchy V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/dbhierx.mod"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ELEMENTS DocBook XML HTML Tables V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/htmltblx.mod"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ENTITIES DocBook XML Notations V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/dbnotnx.mod"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ENTITIES DocBook XML Character Entities V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/dbcentx.mod"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ENTITIES DocBook XML Additional General Entities V4.5//EN"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5/dbgenent.mod"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteSystem"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/4.5"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5"</span> \</span><br><span class="line">    /etc/xml/docbook &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteURI"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/4.5"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5"</span> \</span><br><span class="line">    /etc/xml/docbook</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置/etc/xml/catalog</span></span><br><span class="line"><span class="keyword">if</span> [ ! -e /etc/xml/catalog ]; <span class="keyword">then</span></span><br><span class="line">    xmlcatalog --noout --create /etc/xml/catalog</span><br><span class="line"><span class="keyword">fi</span> &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"delegatePublic"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//ENTITIES DocBook XML"</span> \</span><br><span class="line">    <span class="string">"file:///etc/xml/docbook"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"delegatePublic"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//DTD DocBook XML"</span> \</span><br><span class="line">    <span class="string">"file:///etc/xml/docbook"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"delegateSystem"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/"</span> \</span><br><span class="line">    <span class="string">"file:///etc/xml/docbook"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line">xmlcatalog --noout --add <span class="string">"delegateURI"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/"</span> \</span><br><span class="line">    <span class="string">"file:///etc/xml/docbook"</span> \</span><br><span class="line">    /etc/xml/catalog</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置docbook-xml-dtd</span></span><br><span class="line">    <span class="keyword">for</span> DTDVERSION <span class="keyword">in</span> 4.1.2 4.2 4.3 4.4</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  xmlcatalog --noout --add <span class="string">"public"</span> \</span><br><span class="line">    <span class="string">"-//OASIS//DTD DocBook XML V<span class="variable">$DTDVERSION</span>//EN"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/<span class="variable">$DTDVERSION</span>/docbookx.dtd"</span> \</span><br><span class="line">    /etc/xml/docbook</span><br><span class="line">  xmlcatalog --noout --add <span class="string">"rewriteSystem"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/<span class="variable">$DTDVERSION</span>"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5"</span> \</span><br><span class="line">    /etc/xml/docbook</span><br><span class="line">  xmlcatalog --noout --add <span class="string">"rewriteURI"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/<span class="variable">$DTDVERSION</span>"</span> \</span><br><span class="line">    <span class="string">"file:///usr/share/xml/docbook/xml-dtd-4.5"</span> \</span><br><span class="line">    /etc/xml/docbook</span><br><span class="line">  xmlcatalog --noout --add <span class="string">"delegateSystem"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/<span class="variable">$DTDVERSION</span>/"</span> \</span><br><span class="line">    <span class="string">"file:///etc/xml/docbook"</span> \</span><br><span class="line">    /etc/xml/catalog</span><br><span class="line">  xmlcatalog --noout --add <span class="string">"delegateURI"</span> \</span><br><span class="line">    <span class="string">"http://www.oasis-open.org/docbook/xml/<span class="variable">$DTDVERSION</span>/"</span> \</span><br><span class="line">    <span class="string">"file:///etc/xml/docbook"</span> \</span><br><span class="line">    /etc/xml/catalog</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装docbook-xsl</span></span><br><span class="line">wget https://github.com/docbook/xslt10-stylesheets/releases/download/release/1.79.2/docbook-xsl-nons-1.79.2.tar.bz2</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/docbook-xsl-nons-1.79.2-stack_fix-1.patch</span><br><span class="line">tar -jxvf docbook-xsl-nons-1.79.2.tar.bz2</span><br><span class="line"><span class="built_in">cd</span> docbook-xsl-nons-1.79.2</span><br><span class="line">patch -Np1 -i ../docbook-xsl-nons-1.79.2-stack_fix-1.patch</span><br><span class="line">tar -xf ../docbook-xsl-doc-1.79.2.tar.bz2 --strip-components=1</span><br><span class="line">install -v -m755 -d /usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2</span><br><span class="line">cp -v -R VERSION assembly common eclipse epub epub3 extensions fo highlighting html htmlhelp images javahelp lib manpages params profiling roundtrip slides template tests tools webhelp website xhtml xhtml-1_1 xhtml5  /usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2</span><br><span class="line">ln -s VERSION /usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2/VERSION.xsl</span><br><span class="line">install -v -m644 -D README /usr/share/doc/docbook-xsl-nons-1.79.2/README.txt</span><br><span class="line">install -v -m644    RELEASE-NOTES* NEWS* /usr/share/doc/docbook-xsl-nons-1.79.2</span><br><span class="line">cp -v -R doc/* /usr/share/doc/docbook-xsl-nons-1.79.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置docbook-xsl</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d /etc/xml ]; <span class="keyword">then</span> install -v -m755 -d /etc/xml; <span class="keyword">fi</span> &amp;&amp;</span><br><span class="line"><span class="keyword">if</span> [ ! -f /etc/xml/catalog ]; <span class="keyword">then</span></span><br><span class="line">    xmlcatalog --noout --create /etc/xml/catalog</span><br><span class="line"><span class="keyword">fi</span> &amp;&amp;</span><br><span class="line"></span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteSystem"</span> \</span><br><span class="line">           <span class="string">"https://cdn.docbook.org/release/xsl-nons/1.79.2"</span> \</span><br><span class="line">           <span class="string">"/usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line"></span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteURI"</span> \</span><br><span class="line">           <span class="string">"https://cdn.docbook.org/release/xsl-nons/1.79.2"</span> \</span><br><span class="line">           <span class="string">"/usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line"></span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteSystem"</span> \</span><br><span class="line">           <span class="string">"https://cdn.docbook.org/release/xsl-nons/current"</span> \</span><br><span class="line">           <span class="string">"/usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line"></span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteURI"</span> \</span><br><span class="line">           <span class="string">"https://cdn.docbook.org/release/xsl-nons/current"</span> \</span><br><span class="line">           <span class="string">"/usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line"></span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteSystem"</span> \</span><br><span class="line">           <span class="string">"http://docbook.sourceforge.net/release/xsl/current"</span> \</span><br><span class="line">           <span class="string">"/usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2"</span> \</span><br><span class="line">    /etc/xml/catalog &amp;&amp;</span><br><span class="line"></span><br><span class="line">xmlcatalog --noout --add <span class="string">"rewriteURI"</span> \</span><br><span class="line">           <span class="string">"http://docbook.sourceforge.net/release/xsl/current"</span> \</span><br><span class="line">           <span class="string">"/usr/share/xml/docbook/xsl-stylesheets-nons-1.79.2"</span> \</span><br><span class="line">    /etc/xml/catalog</span><br><span class="line"><span class="comment">#安装libxslt</span></span><br><span class="line">tar -zxvf libxslt-1.1.33.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libxslt-1.1.33</span><br><span class="line">sed -i s/3000/5000/ libxslt/transform.c doc/xsltproc.&#123;1,xml&#125;</span><br><span class="line">./configure --prefix=/usr --<span class="built_in">disable</span>-static</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>安装btfs-ptogs依赖xmlto</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://releases.pagure.org/xmlto/xmlto-0.0.28.tar.bz2</span><br><span class="line">tar -jxvf xmlto-0.0.28.tar.bz2 </span><br><span class="line"><span class="built_in">cd</span> xmlto-0.0.28</span><br><span class="line">LINKS=<span class="string">"/usr/bin/links"</span> ./configure --prefix=/usr </span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>安装btfs-progs依赖asciidoc</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.sourceforge.net/asciidoc/asciidoc-8.6.9.tar.gz</span><br><span class="line">tar -zxvf asciidoc-8.6.9.tar.gz</span><br><span class="line"><span class="built_in">cd</span> asciidoc-8.6.9</span><br><span class="line">./configure --prefix=/usr --sysconfdir=/etc --docdir=/usr/share/doc/asciidoc-8.6.9</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">make docs</span><br></pre></td></tr></table></figure>
<ul>
<li>安装asciidoc依赖python2.7</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/2.7.15/Python-2.7.15.tar.xz</span><br><span class="line">wget https://docs.python.org/ftp/python/doc/2.7.15/python-2.7.15-docs-html.tar.bz2</span><br><span class="line">tar xvf Python-2.7.15.tar.xz</span><br><span class="line"><span class="built_in">cd</span> Python-2.7.15</span><br><span class="line">./configure --prefix=/usr  --<span class="built_in">enable</span>-shared --with-system-expat --with-system-ffi --with-ensurepip=yes --<span class="built_in">enable</span>-unicode=ucs4</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">chmod -v 755 /usr/lib/libpython2.7.so.1.0</span><br><span class="line">install -v -dm755 /usr/share/doc/python-2.7.15</span><br><span class="line">tar --strip-components=1 --no-same-owner --directory /usr/share/doc/python-2.7.15  -xvf ../python-2.7.15-docs-html.tar.bz2</span><br><span class="line">find /usr/share/doc/python-2.7.15 -<span class="built_in">type</span> d -<span class="built_in">exec</span> chmod 0755 &#123;&#125; \;</span><br><span class="line">find /usr/share/doc/python-2.7.15 -<span class="built_in">type</span> f -<span class="built_in">exec</span> chmod 0644 &#123;&#125; \;</span><br><span class="line"><span class="comment">#配置python2</span></span><br><span class="line"><span class="built_in">export</span> PYTHONDOCS=/usr/share/doc/python-2.7.15</span><br></pre></td></tr></table></figure>
<h4 id="dosfstools"><a class="header-anchor" href="#dosfstools">¶</a>dosfstools</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/dosfstools/dosfstools/releases/download/v4.1/dosfstools-4.1.tar.xz</span><br><span class="line">tar xvf dosfstools-4.1.tar.xz</span><br><span class="line"><span class="built_in">cd</span> dosfstools-4.1</span><br><span class="line">./configure --prefix=/  --<span class="built_in">enable</span>-compat-symlinks --mandir=/usr/share/man --docdir=/usr/share/doc/dosfstools-4.1</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="fuse"><a class="header-anchor" href="#fuse">¶</a>fuse</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/libfuse/libfuse/releases/download/fuse-3.4.1/fuse-3.4.1.tar.xz</span><br><span class="line">tar xvf fuse-3.4.1.tar.xz</span><br><span class="line"><span class="built_in">cd</span> fuse-3.4.1</span><br><span class="line">sed -i <span class="string">'/^udev/,$ s/^/#/'</span> util/meson.build</span><br><span class="line">mkdir build &amp;&amp;</span><br><span class="line"><span class="built_in">cd</span>    build</span><br><span class="line">meson --prefix=/usr ..</span><br><span class="line">ninja</span><br><span class="line">ninja install                                             &amp;&amp;</span><br><span class="line"></span><br><span class="line">mv -vf   /usr/lib/libfuse3.so.3*     /lib                 &amp;&amp;</span><br><span class="line">ln -sfvn ../../lib/libfuse3.so.3.4.1 /usr/lib/libfuse3.so &amp;&amp;</span><br><span class="line"></span><br><span class="line">mv -vf /usr/bin/fusermount3  /bin         &amp;&amp;</span><br><span class="line">mv -vf /usr/sbin/mount.fuse3 /sbin        &amp;&amp;</span><br><span class="line">chmod u+s /bin/fusermount3                &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m755 -d /usr/share/doc/fuse-3.4.1      &amp;&amp;</span><br><span class="line">install -v -m644    ../doc/&#123;README.NFS,kernel.txt&#125; \</span><br><span class="line">                    /usr/share/doc/fuse-3.4.1      &amp;&amp;</span><br><span class="line">cp -Rv ../doc/html  /usr/share/doc/fuse-3.4.1</span><br><span class="line"><span class="comment">#配置文件</span></span><br><span class="line">cat &gt; /etc/fuse.conf &lt;&lt; <span class="string">"EOF"</span></span><br><span class="line"><span class="comment"># Set the maximum number of FUSE mounts allowed to non-root users.</span></span><br><span class="line"><span class="comment"># The default is 1000.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#mount_max = 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow non-root users to specify the 'allow_other' or 'allow_root'</span></span><br><span class="line"><span class="comment"># mount options.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#user_allow_other</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h4 id="fuse2-9-7"><a class="header-anchor" href="#fuse2-9-7">¶</a>fuse2.9.7</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/libfuse/libfuse/releases/download/fuse-2.9.7/fuse-2.9.7.tar.gz</span><br><span class="line">tar -zxvf fuse-2.9.7.tar.gz</span><br><span class="line"><span class="built_in">cd</span> fuse-2.9.7</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr    \</span><br><span class="line">            --<span class="built_in">disable</span>-static \</span><br><span class="line">            --<span class="built_in">exec</span>-prefix=/</span><br><span class="line"></span><br><span class="line">make </span><br><span class="line">make DESTDIR=<span class="variable">$PWD</span>/Dest install</span><br><span class="line"></span><br><span class="line">install -vm755 Dest/lib/libfuse.so.2.9.7 /lib                  &amp;&amp;</span><br><span class="line">install -vm755 Dest/lib/libulockmgr.so.1.0.1 /lib                 &amp;&amp;</span><br><span class="line">ln -sfv ../../lib/libfuse.so.2.9.7 /usr/lib/libfuse.so         &amp;&amp;</span><br><span class="line">ln -sfv ../../lib/libulockmgr.so.1.0.1 /usr/lib/libulockmgr.so &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -vm644  Dest/lib/pkgconfig/fuse.pc /usr/lib/pkgconfig  &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -vm4755 Dest/bin/fusermount       /bin                 &amp;&amp;</span><br><span class="line">install -vm755  Dest/bin/ulockmgr_server  /bin                 &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -vm755  Dest/sbin/mount.fuse      /sbin                &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -vdm755 /usr/include/fuse                              &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -vm644  Dest/usr/include/*.h      /usr/include         &amp;&amp;</span><br><span class="line">install -vm644  Dest/usr/include/fuse/*.h /usr/include/fuse/   &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -vm644  Dest/usr/share/man/man1/* /usr/share/man/man1  &amp;&amp;</span><br><span class="line">/sbin/ldconfig -v</span><br></pre></td></tr></table></figure>
<h4 id="jfsutils"><a class="header-anchor" href="#jfsutils">¶</a>jfsutils</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/j/jfsutils-1.1.15.tar.gz</span><br><span class="line">tar -zxvf jfsutils-1.1.15.tar.gz</span><br><span class="line"><span class="built_in">cd</span> jfsutils-1.1.15</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"/unistd.h/a#include &lt;sys/types.h&gt;"</span>    fscklog/extract.c &amp;&amp;</span><br><span class="line">sed -i <span class="string">"/ioctl.h/a#include &lt;sys/sysmacros.h&gt;"</span> libfs/devices.c</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="软件磁盘阵列mdadm"><a class="header-anchor" href="#软件磁盘阵列mdadm">¶</a>软件磁盘阵列mdadm</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.kernel.org/pub/linux/utils/raid/mdadm/mdadm-4.0.tar.xz</span><br><span class="line">tar -xvf mdadm-4.0.tar.xz</span><br><span class="line"><span class="built_in">cd</span> mdadm-4.0</span><br><span class="line">sed <span class="string">'s@-Werror@@'</span> -i Makefile</span><br><span class="line">make</span><br><span class="line">sed -i <span class="string">'s# if.* == "1"#&amp; -a -e $targetdir/log#'</span> <span class="built_in">test</span></span><br><span class="line">make <span class="built_in">test</span></span><br><span class="line">./<span class="built_in">test</span> --keep-going --logdir=<span class="built_in">test</span>-logs --save-logs</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="parted"><a class="header-anchor" href="#parted">¶</a>parted</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">wget https://ftp.gnu.org/gnu/parted/parted-3.2.tar.xz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/parted-3.2-devmapper-1.patch</span><br><span class="line">tar xvf parted-3.2.tar.xz</span><br><span class="line"><span class="built_in">cd</span> parted-3.2</span><br><span class="line">patch -Np1 -i ../parted-3.2-devmapper-1.patch</span><br><span class="line">sed -i <span class="string">'/utsname.h/a#include &lt;sys/sysmacros.h&gt;'</span> libparted/arch/linux.c</span><br><span class="line">./configure --prefix=/usr --<span class="built_in">disable</span>-static</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make -C doc html                                       &amp;&amp;</span><br><span class="line">makeinfo --html      -o doc/html       doc/parted.texi &amp;&amp;</span><br><span class="line">makeinfo --plaintext -o doc/parted.txt doc/parted.texi</span><br><span class="line">sed -i <span class="string">'/t0251-gpt-unicode.sh/d'</span> tests/Makefile</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">install -v -m755 -d /usr/share/doc/parted-3.2/html &amp;&amp;</span><br><span class="line">install -v -m644    doc/html/* \</span><br><span class="line">                    /usr/share/doc/parted-3.2/html &amp;&amp;</span><br><span class="line">install -v -m644    doc/&#123;FAT,API,parted.&#123;txt,html&#125;&#125; \</span><br><span class="line">                    /usr/share/doc/parted-3.2</span><br><span class="line">install -v -m644 doc/FAT doc/API doc/parted.&#123;pdf,ps,dvi&#125; \</span><br><span class="line">                    /usr/share/doc/parted-3.2</span><br></pre></td></tr></table></figure>
<h4 id="ntfs-3g-微软ntfs"><a class="header-anchor" href="#ntfs-3g-微软ntfs">¶</a>ntfs-3g(微软ntfs)</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wget https://tuxera.com/opensource/ntfs-3g_ntfsprogs-2017.3.23.tgz</span><br><span class="line">tar -zxvf ntfs-3g_ntfsprogs-2017.3.23.tgz</span><br><span class="line"><span class="built_in">cd</span> ntfs-3g_ntfsprogs-2017.3.23</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr        \</span><br><span class="line">            --<span class="built_in">disable</span>-static     \</span><br><span class="line">            --with-fuse=internal</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install &amp;&amp;</span><br><span class="line">ln -sv ../bin/ntfs-3g /sbin/mount.ntfs &amp;&amp;</span><br><span class="line">ln -sv ntfs-3g.8 /usr/share/man/man8/mount.ntfs.8</span><br><span class="line">chmod -v 4755 /bin/ntfs-3g</span><br></pre></td></tr></table></figure>
<h4 id="gptfdisk"><a class="header-anchor" href="#gptfdisk">¶</a>gptfdisk</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.sourceforge.net/gptfdisk/gptfdisk-1.0.4.tar.gz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/gptfdisk-1.0.4-convenience-1.patch</span><br><span class="line">tar -zxvf gptfdisk-1.0.4.tar.gz</span><br><span class="line"><span class="built_in">cd</span> gptfdisk-1.0.4</span><br><span class="line">patch -Np1 -i ../gptfdisk-1.0.4-convenience-1.patch</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>gptfdisk依赖popt</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://anduin.linuxfromscratch.org/BLFS/popt/popt-1.16.tar.gz</span><br><span class="line"> tar -zxvf popt-1.16.tar.gz</span><br><span class="line"> <span class="built_in">cd</span> popt-1.16</span><br><span class="line">./configure --prefix=/usr --<span class="built_in">disable</span>-static</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">install -v -m755 -d /usr/share/doc/popt-1.16 &amp;&amp;</span><br><span class="line">install -v -m644 doxygen/html/* /usr/share/doc/popt-1.16</span><br></pre></td></tr></table></figure>
<h4 id="reiserfsprogs"><a class="header-anchor" href="#reiserfsprogs">¶</a>reiserfsprogs</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.kernel.org/pub/linux/kernel/people/jeffm/reiserfsprogs/v3.6.27/reiserfsprogs-3.6.27.tar.xz</span><br><span class="line">tar xvf reiserfsprogs-3.6.27.tar.xz</span><br><span class="line"><span class="built_in">cd</span> reiserfsprogs-3.6.27</span><br><span class="line">sed -i <span class="string">'/parse_time.h/i #define _GNU_SOURCE'</span> lib/parse_time.c</span><br><span class="line"></span><br><span class="line">autoreconf -fiv             &amp;&amp;</span><br><span class="line">./configure --prefix=/usr   \</span><br><span class="line">            --sbindir=/sbin</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="smartmontools"><a class="header-anchor" href="#smartmontools">¶</a>smartmontools</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.sourceforge.net/smartmontools/smartmontools-7.0.tar.gz</span><br><span class="line">tar -zxvf smartmontools-7.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> smartmontools-7.0</span><br><span class="line">./configure --prefix=/usr           \</span><br><span class="line">            --sysconfdir=/etc       \</span><br><span class="line">            --with-initscriptdir=no \</span><br><span class="line">            --docdir=/usr/share/doc/smartmontools-7.0</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="comment">#开机启动</span></span><br><span class="line"><span class="built_in">cd</span> /sources/blfs-bootscripts-20180105</span><br><span class="line">make install-smartd</span><br></pre></td></tr></table></figure>
<h4 id="sshfs"><a class="header-anchor" href="#sshfs">¶</a>sshfs</h4>
<ul>
<li>需要依赖(fuse(前面已经安装),glib,openssh)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pcre </span></span><br><span class="line">wget https://ftp.pcre.org/pub/pcre/pcre-8.42.tar.bz2</span><br><span class="line">tar -jxvf pcre-8.42.tar.bz2</span><br><span class="line"><span class="built_in">cd</span> pcre-8.42</span><br><span class="line">./configure --prefix=/usr                     \</span><br><span class="line">            --docdir=/usr/share/doc/pcre-8.42 \</span><br><span class="line">            --<span class="built_in">enable</span>-unicode-properties       \</span><br><span class="line">            --<span class="built_in">enable</span>-pcre16                   \</span><br><span class="line">            --<span class="built_in">enable</span>-pcre32                   \</span><br><span class="line">            --<span class="built_in">enable</span>-pcregrep-libz            \</span><br><span class="line">            --<span class="built_in">enable</span>-pcregrep-libbz2          \</span><br><span class="line">            --<span class="built_in">enable</span>-pcretest-libreadline     \</span><br><span class="line">            --<span class="built_in">disable</span>-static </span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">mv -v /usr/lib/libpcre.so.* /lib &amp;&amp;</span><br><span class="line">ln -sfv ../../lib/$(readlink /usr/lib/libpcre.so) /usr/lib/libpcre.so</span><br><span class="line"><span class="comment">#glib</span></span><br><span class="line">wget http://ftp.gnome.org/pub/gnome/sources/glib/2.58/glib-2.58.3.tar.xz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/glib-2.58.3-skip_warnings-1.patch</span><br><span class="line">tar xvf glib-2.58.3.tar.xz</span><br><span class="line"><span class="built_in">cd</span> glib-2.58.3</span><br><span class="line">patch -Np1 -i ../glib-2.58.3-skip_warnings-1.patch</span><br><span class="line">mkdir build-glib &amp;&amp;</span><br><span class="line"><span class="built_in">cd</span>    build-glib</span><br><span class="line">meson --prefix=/usr   \</span><br><span class="line">      -Dman=<span class="literal">true</span>      \</span><br><span class="line">      -Dselinux=<span class="literal">false</span> \</span><br><span class="line">      ..              &amp;&amp;</span><br><span class="line">ninja</span><br><span class="line"><span class="comment">#如果缺失这些库，可以从宿主机复制</span></span><br><span class="line">cp /lib/libglib-2.0.so.0 /mnt/lib/</span><br><span class="line">cp /lib64/libgio-2.0.so.0 /mnt/lib/</span><br><span class="line">cp /lib64/libgobject-2.0.so.0 /mnt/lib/</span><br><span class="line">cp /lib64/libgmodule-2.0.so.0 /mnt/lib/</span><br><span class="line">ninja install &amp;&amp;</span><br><span class="line">mkdir -p /usr/share/doc/glib-2.58.3 &amp;&amp;</span><br><span class="line">cp -r ../docs/reference/&#123;NEWS,gio,glib,gobject&#125; /usr/share/doc/glib-2.58.3</span><br><span class="line"></span><br><span class="line"><span class="comment">#openssh</span></span><br><span class="line">wget http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-7.9p1.tar.gz</span><br><span class="line">wget http://www.linuxfromscratch.org/patches/blfs/8.4/openssh-7.9p1-security_fix-1.patch</span><br><span class="line">tar -zxvf openssh-7.9p1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssh-7.9p1</span><br><span class="line">install  -v -m700 -d /var/lib/sshd &amp;&amp;</span><br><span class="line">chown    -v root:sys /var/lib/sshd</span><br><span class="line"></span><br><span class="line">groupadd -g 50 sshd        &amp;&amp;</span><br><span class="line">useradd  -c <span class="string">'sshd PrivSep'</span> \</span><br><span class="line">         -d /var/lib/sshd  \</span><br><span class="line">         -g sshd           \</span><br><span class="line">         -s /bin/<span class="literal">false</span>     \</span><br><span class="line">         -u 50 sshd</span><br><span class="line"></span><br><span class="line">patch -Np1 -i ../openssh-7.9p1-security_fix-1.patch</span><br><span class="line">./configure --prefix=/usr                     \</span><br><span class="line">            --sysconfdir=/etc/ssh             \</span><br><span class="line">            --with-md5-passwords              \</span><br><span class="line">            --with-privsep-path=/var/lib/sshd</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">install -v -m755    contrib/ssh-copy-id /usr/bin     &amp;&amp;</span><br><span class="line"></span><br><span class="line">install -v -m644    contrib/ssh-copy-id.1 \</span><br><span class="line">                    /usr/share/man/man1              &amp;&amp;</span><br><span class="line">install -v -m755 -d /usr/share/doc/openssh-7.9p1     &amp;&amp;</span><br><span class="line">install -v -m644    INSTALL LICENCE OVERVIEW README* \</span><br><span class="line">                    /usr/share/doc/openssh-7.9p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置openssh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"PermitRootLogin no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#生成秘钥</span></span><br><span class="line">ssh-keygen &amp;&amp;</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub REMOTE_USERNAME@REMOTE_HOSTNAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果有安装有linux-pam，则执行下面这些语句</span></span><br><span class="line">sed <span class="string">'s@d/login@d/sshd@g'</span> /etc/pam.d/login &gt; /etc/pam.d/sshd &amp;&amp;</span><br><span class="line">chmod 644 /etc/pam.d/sshd &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"UsePAM yes"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment">#开机启动</span></span><br><span class="line"><span class="built_in">cd</span> /sources/blfs-bootscripts-20180105/</span><br><span class="line">make install-sshd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"PasswordAuthentication no"</span> &gt;&gt; /etc/ssh/sshd_config &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"ChallengeResponseAuthentication no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/libfuse/sshfs/releases/download/sshfs-3.5.1/sshfs-3.5.1.tar.xz</span><br><span class="line">tar xvf sshfs-3.5.1.tar.xz</span><br><span class="line"><span class="built_in">cd</span> sshfs-3.5.1</span><br><span class="line">mkdir build &amp;&amp;</span><br><span class="line"><span class="built_in">cd</span>    build</span><br><span class="line">meson --prefix=/usr ..</span><br><span class="line">ninja</span><br><span class="line">ninja install</span><br></pre></td></tr></table></figure>
<h4 id="xfsprogs"><a class="header-anchor" href="#xfsprogs">¶</a>xfsprogs</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget http://ftp.lfs-matrix.net/pub/blfs/8.4/x/xfsprogs-4.19.0.tar.xz</span><br><span class="line">tar xvf xfsprogs-4.19.0.tar.xz</span><br><span class="line"><span class="built_in">cd</span> xfsprogs-4.19.0</span><br><span class="line">make DEBUG=-DNDEBUG     \</span><br><span class="line">     INSTALL_USER=root  \</span><br><span class="line">     INSTALL_GROUP=root \</span><br><span class="line">     LOCAL_CONFIGURE_OPTIONS=<span class="string">"--enable-readline"</span></span><br><span class="line"></span><br><span class="line">make PKG_DOC_DIR=/usr/share/doc/xfsprogs-4.19.0 install     &amp;&amp;</span><br><span class="line">make PKG_DOC_DIR=/usr/share/doc/xfsprogs-4.19.0 install-dev &amp;&amp;</span><br><span class="line"></span><br><span class="line">rm -rfv /usr/lib/libhandle.a                                &amp;&amp;</span><br><span class="line">rm -rfv /lib/libhandle.&#123;a,la,so&#125;                            &amp;&amp;</span><br><span class="line">ln -sfv ../../lib/libhandle.so.1 /usr/lib/libhandle.so      &amp;&amp;</span><br><span class="line">sed -i <span class="string">"s@libdir='/lib@libdir='/usr/lib@"</span> /usr/lib/libhandle.la</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">rack-leen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/06/16/BLFS/BLFS%E6%9E%84%E5%BB%BA05-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/">http://yoursite.com/2019/06/16/BLFS/BLFS%E6%9E%84%E5%BB%BA05-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">rack-leen's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.png"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/06/19/BLFS/BLFS%E6%9E%84%E5%BB%BA06-%E5%B8%B8%E7%94%A8%E5%BA%93%E5%92%8C%E5%B7%A5%E5%85%B7/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>BLFS构建06-常用库和工具</span></div></a></div><div class="next-post pull_right"><a href="/2019/06/12/%E6%8A%80%E6%9C%AF%E6%A0%88/Java%E6%8A%80%E6%9C%AF%E6%A0%88/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Java技术栈</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'MfUQEbakEraMCGDu6l1C7pHQ-gzGzoHsz',
  appKey:'pGQbdqjwcLQijkbDoU09liQ9',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></div><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By rack-leen</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode fa fa-sun-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script async src="/js/search/algolia.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="/js/third-party/canvas-nest.js"></script><script src="/js/baidupush.js"> </script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/third-party/ClickShowText.js"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":140,"height":260},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>