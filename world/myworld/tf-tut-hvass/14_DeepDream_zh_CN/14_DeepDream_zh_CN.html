
<!DOCTYPE HTML>
<html lang="zh" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>DeepDream · TensorFlow 教程（Hvass）</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="wizardforcel">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-comment/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.html" />
    
    
    <link rel="prev" href="../13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="輸入並搜尋" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.gitbook.com/book/wizardforcel/tf-tut-hvass" target="_blank" class="custom-link">TensorFlow 教程（Hvass）</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    TensorFlow 教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../01_Simple_Linear_Model_zh_CN/01_Simple_Linear_Model_zh_CN.html">
            
                <a href="../01_Simple_Linear_Model_zh_CN/01_Simple_Linear_Model_zh_CN.html">
            
                    
                    简单线性模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../02_Convolutional_Neural_Network_zh_CN/02_Convolutional_Neural_Network_zh_CN.html">
            
                <a href="../02_Convolutional_Neural_Network_zh_CN/02_Convolutional_Neural_Network_zh_CN.html">
            
                    
                    卷积神经网络
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../03_PrettyTensor_zh_CN/03_PrettyTensor_zh_CN.html">
            
                <a href="../03_PrettyTensor_zh_CN/03_PrettyTensor_zh_CN.html">
            
                    
                    PrettyTensor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../04_Save_Restore_zh_CN/04_Save_Restore_zh_CN.html">
            
                <a href="../04_Save_Restore_zh_CN/04_Save_Restore_zh_CN.html">
            
                    
                    保存 & 恢复
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.html">
            
                <a href="../05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.html">
            
                    
                    集成学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../06_CIFAR-10_zh_CN/06_CIFAR-10_zh_CN.html">
            
                <a href="../06_CIFAR-10_zh_CN/06_CIFAR-10_zh_CN.html">
            
                    
                    CIFAR-10
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.html">
            
                <a href="../07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.html">
            
                    
                    Inception 模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../08_Transfer_Learning_zh_CN/08_Transfer_Learning_zh_CN.html">
            
                <a href="../08_Transfer_Learning_zh_CN/08_Transfer_Learning_zh_CN.html">
            
                    
                    迁移学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../09_Video_Data_zh_CN/09_Video_Data_zh_CN.html">
            
                <a href="../09_Video_Data_zh_CN/09_Video_Data_zh_CN.html">
            
                    
                    视频数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../11_Adversarial_Examples_zh_CN/11_Adversarial_Examples_zh_CN.html">
            
                <a href="../11_Adversarial_Examples_zh_CN/11_Adversarial_Examples_zh_CN.html">
            
                    
                    对抗样本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../12_Adversarial_Noise_MNIST_zh_CN/12_Adversarial_Noise_MNIST_zh_CN.html">
            
                <a href="../12_Adversarial_Noise_MNIST_zh_CN/12_Adversarial_Noise_MNIST_zh_CN.html">
            
                    
                    MNIST的对抗噪声
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.html">
            
                <a href="../13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.html">
            
                    
                    可视化分析
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.14" data-path="14_DeepDream_zh_CN.html">
            
                <a href="14_DeepDream_zh_CN.html">
            
                    
                    DeepDream
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.html">
            
                <a href="../15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.html">
            
                    
                    风格迁移
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本書使用 GitBook 釋出
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >DeepDream</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tensorflow-&#x6559;&#x7A0B;-14">TensorFlow &#x6559;&#x7A0B; #14</h1>
<h1 id="deepdream">DeepDream</h1>
<p>by <a href="http://www.hvass-labs.org/" target="_blank">Magnus Erik Hvass Pedersen</a>
/ <a href="https://github.com/Hvass-Labs/TensorFlow-Tutorials" target="_blank">GitHub</a> / <a href="https://www.youtube.com/playlist?list=PL9Hr9sNUjfsmEu1ZniY0XpHSzl5uihcXZ" target="_blank">Videos on YouTube</a><br>&#x4E2D;&#x6587;&#x7FFB;&#x8BD1; <a href="https://zhuanlan.zhihu.com/insight-pixel" target="_blank">thrillerist</a>  / <a href="https://github.com/thrillerist/TensorFlow-Tutorials" target="_blank">Github</a></p>
<h2 id="&#x4ECB;&#x7ECD;">&#x4ECB;&#x7ECD;</h2>
<p>&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x6559;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;&#x5982;&#x4F55;&#x7528;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x68AF;&#x5EA6;&#x6765;&#x751F;&#x6210;&#x56FE;&#x50CF;&#x3002;&#x6559;&#x7A0B;#11&#x548C;#12&#x5C55;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x7528;&#x68AF;&#x5EA6;&#x6765;&#x751F;&#x6210;&#x5BF9;&#x6297;&#x566A;&#x58F0;&#x3002;&#x6559;&#x7A0B;#13&#x5C55;&#x793A;&#x4E86;&#x600E;&#x4E48;&#x7528;&#x68AF;&#x5EA6;&#x6765;&#x751F;&#x6210;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5185;&#x90E8;&#x7279;&#x5F81;&#x6240;&#x54CD;&#x5E94;&#x7684;&#x56FE;&#x50CF;&#x3002;</p>
<p>&#x672C;&#x6587;&#x4F1A;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x4E0E;&#x4E4B;&#x524D;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x4F1A;&#x7528;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x68AF;&#x5EA6;&#x6765;&#x653E;&#x5927;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x4E2D;&#x7684;&#x56FE;&#x6848;&#xFF08;patterns&#xFF09;&#x3002;&#x8FD9;&#x4E2A;&#x901A;&#x5E38;&#x79F0;&#x4E3A;DeepDream&#x7B97;&#x6CD5;&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x6280;&#x672F;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x8BB8;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x53D8;&#x4F53;&#x3002;</p>
<p>&#x672C;&#x6587;&#x57FA;&#x4E8E;&#x4E4B;&#x524D;&#x7684;&#x6559;&#x7A0B;&#x3002;&#x4F60;&#x9700;&#x8981;&#x5927;&#x6982;&#x5730;&#x719F;&#x6089;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF08;&#x8BE6;&#x89C1;&#x6559;&#x7A0B; #01&#x548C; #02&#xFF09;&#x3002;</p>
<h2 id="&#x6D41;&#x7A0B;&#x56FE;">&#x6D41;&#x7A0B;&#x56FE;</h2>
<p>&#x4E0B;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x56FE;&#x7C97;&#x7565;&#x5C55;&#x793A;&#x4E86;DeepDream&#x7B97;&#x6CD5;&#x7684;&#x60F3;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;Inception&#x6A21;&#x578B;&#xFF0C;&#x5B83;&#x7684;&#x5C42;&#x6B21;&#x8981;&#x6BD4;&#x8FD9;&#x8FB9;&#x663E;&#x793A;&#x7684;&#x66F4;&#x591A;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;TensorFlow&#x81EA;&#x52A8;&#x5BFC;&#x51FA;&#x7F51;&#x7EDC;&#x4E2D;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x5C42;&#x76F8;&#x5BF9;&#x4E8E;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x68AF;&#x5EA6;&#x3002;&#x7136;&#x540E;&#x7528;&#x68AF;&#x5EA6;&#x6765;&#x66F4;&#x65B0;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x91CD;&#x590D;&#x591A;&#x6B21;&#xFF0C;&#x76F4;&#x5230;&#x51FA;&#x73B0;&#x56FE;&#x6848;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x5BF9;&#x6240;&#x5F97;&#x5230;&#x7684;&#x56FE;&#x50CF;&#x6EE1;&#x610F;&#x4E3A;&#x6B62;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x7684;&#x539F;&#x7406;&#x5C31;&#x662F;&#xFF0C;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5728;&#x56FE;&#x50CF;&#x4E2D;&#x770B;&#x5230;&#x4E00;&#x4E9B;&#x56FE;&#x6848;&#x7684;&#x75D5;&#x8FF9;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x7528;&#x68AF;&#x5EA6;&#x628A;&#x5B83;&#x653E;&#x5927;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x663E;&#x793A;DeepDream&#x7B97;&#x6CD5;&#x7684;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#xFF0C;&#x4F8B;&#x5982;&#x68AF;&#x5EA6;&#x88AB;&#x5E73;&#x6ED1;&#x4E86;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x8BA8;&#x8BBA;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x4F18;&#x70B9;&#x3002;&#x68AF;&#x5EA6;&#x4E5F;&#x662F;&#x5206;&#x5757;&#x8BA1;&#x7B97;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x9AD8;&#x5206;&#x8FA8;&#x7387;&#x7684;&#x56FE;&#x50CF;&#x4E0A;&#x5DE5;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x8017;&#x5C3D;&#x8BA1;&#x7B97;&#x673A;&#x5185;&#x5B58;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> Image, display
Image(<span class="hljs-string">&apos;images/14_deepdream_flowchart.png&apos;</span>)
</code></pre>
<p><img src="output_3_0.png" alt="png"></p>
<h3 id="&#x9012;&#x5F52;&#x4F18;&#x5316;">&#x9012;&#x5F52;&#x4F18;&#x5316;</h3>
<p>Inception&#x6A21;&#x578B;&#x662F;&#x5728;&#x76F8;&#x5F53;&#x4F4E;&#x5206;&#x8FA8;&#x7387;&#x7684;&#x56FE;&#x50CF;&#x4E0A;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;&#x7684;&#xFF0C;&#x5927;&#x6982;200-300&#x50CF;&#x7D20;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x66F4;&#x5927;&#x5206;&#x8FA8;&#x7387;&#x7684;&#x56FE;&#x50CF;&#x65F6;&#xFF0C;DeepDream&#x7B97;&#x6CD5;&#x4F1A;&#x5728;&#x56FE;&#x50CF;&#x4E2D;&#x521B;&#x5EFA;&#x8BB8;&#x591A;&#x5C0F;&#x7684;&#x56FE;&#x6848;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x5C06;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7F29;&#x5C0F;&#x5230;200-300&#x50CF;&#x7D20;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E48;&#x4F4E;&#x7684;&#x5206;&#x8FA8;&#x7387;&#xFF08;&#x7684;&#x7ED3;&#x679C;&#xFF09;&#x662F;&#x50CF;&#x7D20;&#x5316;&#x800C;&#x4E14;&#x4E11;&#x964B;&#x7684;&#x3002;</p>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x591A;&#x6B21;&#x7F29;&#x5C0F;&#x539F;&#x59CB;&#x56FE;&#x50CF;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A;&#x8F83;&#x5C0F;&#x7684;&#x56FE;&#x50CF;&#x4E0A;&#x8FD0;&#x884C;DeepDream&#x7B97;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x5728;&#x56FE;&#x50CF;&#x4E2D;&#x521B;&#x5EFA;&#x66F4;&#x5927;&#x7684;&#x56FE;&#x6848;&#xFF0C;&#x7136;&#x540E;&#x4EE5;&#x66F4;&#x9AD8;&#x7684;&#x5206;&#x8FA8;&#x7387;&#x8FDB;&#x884C;&#x6539;&#x5584;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x6D41;&#x7A0B;&#x56FE;&#x7C97;&#x7565;&#x663E;&#x793A;&#x4E86;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x3002;&#x7B97;&#x6CD5;&#x9012;&#x5F52;&#x5730;&#x5B9E;&#x73B0;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x4EFB;&#x4F55;&#x6570;&#x91CF;&#x7684;&#x7F29;&#x5C0F;&#x7EA7;&#x522B;&#x3002;&#x7B97;&#x6CD5;&#x6709;&#x4E9B;&#x7EC6;&#x8282;&#x5E76;&#x672A;&#x5728;&#x8FD9;&#x91CC;&#x5C55;&#x793A;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x56FE;&#x50CF;&#x5728;&#x7F29;&#x5C0F;&#x4E4B;&#x524D;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x6A21;&#x7CCA;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x4E14;&#x539F;&#x59CB;&#x56FE;&#x50CF;&#x53EA;&#x662F;&#x4E0E;DeepDream&#x56FE;&#x50CF;&#x6DF7;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x6765;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x539F;&#x59CB;&#x7684;&#x7EC6;&#x8282;&#x3002;</p>
<pre><code class="lang-python">Image(<span class="hljs-string">&apos;images/14_deepdream_recursive_flowchart.png&apos;</span>)
</code></pre>
<p><img src="output_5_0.png" alt="png"></p>
<h2 id="&#x5BFC;&#x5165;">&#x5BFC;&#x5165;</h2>
<pre><code class="lang-python">%matplotlib inline
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> math

<span class="hljs-comment"># Image manipulation.</span>
<span class="hljs-keyword">import</span> PIL.Image
<span class="hljs-keyword">from</span> scipy.ndimage.filters <span class="hljs-keyword">import</span> gaussian_filter
</code></pre>
<p>&#x4F7F;&#x7528;Python3.5.2&#xFF08;Anaconda&#xFF09;&#x5F00;&#x53D1;&#xFF0C;TensorFlow&#x7248;&#x672C;&#x662F;&#xFF1A;</p>
<pre><code class="lang-python">tf.__version__
</code></pre>
<pre><code>&apos;1.1.0&apos;
</code></pre><h2 id="inception-&#x6A21;&#x578B;">Inception &#x6A21;&#x578B;</h2>
<p>&#x524D;&#x9762;&#x7684;&#x4E00;&#x4E9B;&#x6559;&#x7A0B;&#x90FD;&#x4F7F;&#x7528;&#x4E86;Inception v3&#x6A21;&#x578B;&#x3002;&#x672C;&#x6587;&#x5C06;&#x4F1A;&#x4F7F;&#x7528;Inception&#x6A21;&#x578B;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x53D8;&#x4F53;&#x3002;&#x7531;&#x4E8E;Google&#x5F00;&#x53D1;&#x8005;&#x5E76;&#x6CA1;&#x6709;&#x5F88;&#x597D;&#x7684;&#x4E3A;&#x5176;&#x64B0;&#x5199;&#x6587;&#x6863;&#xFF08;&#x8DDF;&#x901A;&#x5E38;&#x4E00;&#x6837;&#xFF09;&#xFF0C;&#x4E0D;&#x592A;&#x6E05;&#x695A;&#x6A21;&#x578B;&#x662F;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x8FD9;&#x91CC;&#x7528;&#x201C;Inception 5h&#x201D;&#x6765;&#x6307;&#x4EE3;&#x5B83;&#xFF0C;&#x56E0;&#x4E3A;zip&#x5305;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x5C3D;&#x7BA1;&#x770B;&#x8D77;&#x6765;&#x8FD9;&#x662F;Inception&#x6A21;&#x578B;&#x7684;&#x4E00;&#x4E2A;&#x65E9;&#x671F;&#x7684;&#x3001;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x7248;&#x672C;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;Inception 5h&#x6A21;&#x578B;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x66F4;&#x5BB9;&#x6613;&#x4F7F;&#x7528;&#xFF1A;&#x5B83;&#x63A5;&#x53D7;&#x4EFB;&#x4F55;&#x5C3A;&#x5BF8;&#x7684;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x6BD4;Inception v3&#x6A21;&#x578B;&#xFF08;&#x89C1;&#x6559;&#x7A0B; #13&#xFF09;&#x66F4;&#x6F02;&#x4EAE;&#x7684;&#x56FE;&#x50CF;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> inception5h
</code></pre>
<p>&#x4ECE;&#x7F51;&#x4E0A;&#x4E0B;&#x8F7D;Inception 5h&#x6A21;&#x578B;&#x3002;&#x8FD9;&#x662F;&#x4F60;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x9ED8;&#x8BA4;&#x6587;&#x4EF6;&#x5939;&#x3002;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5939;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># inception.data_dir = &apos;inception/5h/&apos;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x4E0D;&#x5B58;&#x5728;Inception&#x6A21;&#x578B;&#xFF0C;&#x5C31;&#x81EA;&#x52A8;&#x4E0B;&#x8F7D;&#x3002;
&#x5B83;&#x6709;50MB&#x3002;</p>
<pre><code class="lang-python">inception5h.maybe_download()
</code></pre>
<pre><code>Downloading Inception 5h Model ...
Data has apparently already been downloaded and unpacked.
</code></pre><p>&#x8F7D;&#x5165;&#x6A21;&#x578B;&#xFF0C;&#x4EE5;&#x4FBF;&#x4F7F;&#x7528;&#x3002;</p>
<pre><code class="lang-python">model = inception5h.Inception5h()
</code></pre>
<p>Inception 5h&#x6A21;&#x578B;&#x6709;&#x8BB8;&#x591A;&#x5C42;&#x53EF;&#x7528;&#x6765;&#x505A;DeepDreaming&#x3002;&#x6211;&#x4EEC;&#x5217;&#x51FA;&#x4E86;12&#x4E2A;&#x6700;&#x5E38;&#x7528;&#x7684;&#x5C42;&#xFF0C;&#x4EE5;&#x4F9B;&#x53C2;&#x8003;&#x3002;</p>
<pre><code class="lang-python">len(model.layer_tensors)
</code></pre>
<pre><code>12
</code></pre><h2 id="&#x64CD;&#x4F5C;&#x56FE;&#x50CF;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x64CD;&#x4F5C;&#x56FE;&#x50CF;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h2>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8F7D;&#x5165;&#x4E00;&#x5F20;&#x56FE;&#x50CF;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6D6E;&#x70B9;&#x578B;numpy&#x6570;&#x7EC4;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_image</span><span class="hljs-params">(filename)</span>:</span>
    image = PIL.Image.open(filename)

    <span class="hljs-keyword">return</span> np.float32(image)
</code></pre>
<p>&#x5C06;&#x56FE;&#x50CF;&#x4FDD;&#x5B58;&#x6210;jpeg&#x6587;&#x4EF6;&#x3002;&#x56FE;&#x50CF;&#x662F;&#x4FDD;&#x5B58;&#x7740;0-255&#x50CF;&#x7D20;&#x7684;numpy&#x6570;&#x7EC4;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_image</span><span class="hljs-params">(image, filename)</span>:</span>
    <span class="hljs-comment"># Ensure the pixel-values are between 0 and 255.</span>
    image = np.clip(image, <span class="hljs-number">0.0</span>, <span class="hljs-number">255.0</span>)

    <span class="hljs-comment"># Convert to bytes.</span>
    image = image.astype(np.uint8)

    <span class="hljs-comment"># Write the image-file in jpeg-format.</span>
    <span class="hljs-keyword">with</span> open(filename, <span class="hljs-string">&apos;wb&apos;</span>) <span class="hljs-keyword">as</span> file:
        PIL.Image.fromarray(image).save(file, <span class="hljs-string">&apos;jpeg&apos;</span>)
</code></pre>
<p>&#x8FD9;&#x662F;&#x7ED8;&#x5236;&#x56FE;&#x50CF;&#x7684;&#x51FD;&#x6570;&#x3002;&#x4F7F;&#x7528;matplotlib&#x5C06;&#x5F97;&#x5230;&#x4F4E;&#x5206;&#x8FA8;&#x7387;&#x7684;&#x56FE;&#x50CF;&#x3002;&#x4F7F;&#x7528;PIL&#x6548;&#x679C;&#x6BD4;&#x8F83;&#x597D;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_image</span><span class="hljs-params">(image)</span>:</span>
    <span class="hljs-comment"># Assume the pixel-values are scaled between 0 and 255.</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">False</span>:
        <span class="hljs-comment"># Convert the pixel-values to the range between 0.0 and 1.0</span>
        image = np.clip(image/<span class="hljs-number">255.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)

        <span class="hljs-comment"># Plot using matplotlib.</span>
        plt.imshow(image, interpolation=<span class="hljs-string">&apos;lanczos&apos;</span>)
        plt.show()
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># Ensure the pixel-values are between 0 and 255.</span>
        image = np.clip(image, <span class="hljs-number">0.0</span>, <span class="hljs-number">255.0</span>)

        <span class="hljs-comment"># Convert pixels to bytes.</span>
        image = image.astype(np.uint8)

        <span class="hljs-comment"># Convert to a PIL-image and display it.</span>
        display(PIL.Image.fromarray(image))
</code></pre>
<p>&#x5F52;&#x4E00;&#x5316;&#x56FE;&#x50CF;&#xFF0C;&#x5219;&#x50CF;&#x7D20;&#x503C;&#x5728;0.0&#x5230;1.0&#x4E4B;&#x95F4;&#x3002;&#x8FD9;&#x4E2A;&#x5728;&#x7ED8;&#x5236;&#x68AF;&#x5EA6;&#x65F6;&#x5F88;&#x6709;&#x7528;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">normalize_image</span><span class="hljs-params">(x)</span>:</span>
    <span class="hljs-comment"># Get the min and max values for all pixels in the input.</span>
    x_min = x.min()
    x_max = x.max()

    <span class="hljs-comment"># Normalize so all values are between 0.0 and 1.0</span>
    x_norm = (x - x_min) / (x_max - x_min)

    <span class="hljs-keyword">return</span> x_norm
</code></pre>
<p>&#x5BF9;&#x68AF;&#x5EA6;&#x505A;&#x5F52;&#x4E00;&#x5316;&#x4E4B;&#x540E;&#xFF0C;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7ED8;&#x5236;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_gradient</span><span class="hljs-params">(gradient)</span>:</span>
    <span class="hljs-comment"># Normalize the gradient so it is between 0.0 and 1.0</span>
    gradient_normalized = normalize_image(gradient)

    <span class="hljs-comment"># Plot the normalized gradient.</span>
    plt.imshow(gradient_normalized, interpolation=<span class="hljs-string">&apos;bilinear&apos;</span>)
    plt.show()
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x6574;&#x56FE;&#x50CF;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x662F;&#x4F60;&#x6307;&#x5B9A;&#x7684;&#x5177;&#x4F53;&#x7684;&#x56FE;&#x50CF;&#x5206;&#x8FA8;&#x7387;&#xFF0C;&#x6BD4;&#x5982;(100&#xFF0C;200)&#xFF0C;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x7F29;&#x653E;&#x56E0;&#x5B50;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x53C2;&#x6570;&#x662F;0.5&#x65F6;,&#x56FE;&#x50CF;&#x6BCF;&#x4E2A;&#x7EF4;&#x5EA6;&#x7F29;&#x5C0F;&#x4E00;&#x534A;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;PIL&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x4EE3;&#x7801;&#x6709;&#x70B9;&#x957F;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7528;numpy&#x6570;&#x7EC4;&#x6765;&#x5904;&#x7406;&#x56FE;&#x50CF;&#xFF0C;&#x5176;&#x4E2D;&#x50CF;&#x7D20;&#x503C;&#x662F;&#x6D6E;&#x70B9;&#x503C;&#x3002;PIL&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x4E2A;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5C06;&#x56FE;&#x50CF;&#x8F6C;&#x6362;&#x6210;8&#x4F4D;&#x5B57;&#x8282;&#xFF0C;&#x6765;&#x786E;&#x4FDD;&#x50CF;&#x7D20;&#x503C;&#x5728;&#x5408;&#x9002;&#x7684;&#x8303;&#x56F4;&#x5185;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x56FE;&#x50CF;&#x88AB;&#x8C03;&#x6574;&#x5927;&#x5C0F;&#x5E76;&#x8F6C;&#x6362;&#x56DE;&#x6D6E;&#x70B9;&#x503C;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">resize_image</span><span class="hljs-params">(image, size=None, factor=None)</span>:</span>
    <span class="hljs-comment"># If a rescaling-factor is provided then use it.</span>
    <span class="hljs-keyword">if</span> factor <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>:
        <span class="hljs-comment"># Scale the numpy array&apos;s shape for height and width.</span>
        size = np.array(image.shape[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>]) * factor

        <span class="hljs-comment"># The size is floating-point because it was scaled.</span>
        <span class="hljs-comment"># PIL requires the size to be integers.</span>
        size = size.astype(int)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># Ensure the size has length 2.</span>
        size = size[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>]

    <span class="hljs-comment"># The height and width is reversed in numpy vs. PIL.</span>
    size = tuple(reversed(size))

    <span class="hljs-comment"># Ensure the pixel-values are between 0 and 255.</span>
    img = np.clip(image, <span class="hljs-number">0.0</span>, <span class="hljs-number">255.0</span>)

    <span class="hljs-comment"># Convert the pixels to 8-bit bytes.</span>
    img = img.astype(np.uint8)

    <span class="hljs-comment"># Create PIL-object from numpy array.</span>
    img = PIL.Image.fromarray(img)

    <span class="hljs-comment"># Resize the image.</span>
    img_resized = img.resize(size, PIL.Image.LANCZOS)

    <span class="hljs-comment"># Convert 8-bit pixel values back to floating-point.</span>
    img_resized = np.float32(img_resized)

    <span class="hljs-keyword">return</span> img_resized
</code></pre>
<h2 id="deepdream-&#x7B97;&#x6CD5;">DeepDream &#x7B97;&#x6CD5;</h2>
<h3 id="&#x68AF;&#x5EA6;">&#x68AF;&#x5EA6;</h3>
<p>&#x4E0B;&#x9762;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x4E86;&#x5728;DeepDream&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x68AF;&#x5EA6;&#x3002;Inception 5h&#x6A21;&#x578B;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4EFB;&#x610F;&#x5C3A;&#x5BF8;&#x7684;&#x56FE;&#x50CF;&#xFF0C;&#x4F46;&#x592A;&#x5927;&#x7684;&#x56FE;&#x50CF;&#x53EF;&#x80FD;&#x4F1A;&#x5360;&#x7528;&#x5343;&#x5146;&#x5B57;&#x8282;&#x7684;&#x5185;&#x5B58;&#x3002;&#x4E3A;&#x4E86;&#x4F7F;&#x5185;&#x5B58;&#x5360;&#x7528;&#x6700;&#x4F4E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x5206;&#x5272;&#x6210;&#x5C0F;&#x7684;&#x56FE;&#x5757;&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x6BCF;&#x5C0F;&#x5757;&#x7684;&#x68AF;&#x5EA6;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5728;DeepDream&#x7B97;&#x6CD5;&#x6700;&#x7EC8;&#x751F;&#x6210;&#x7684;&#x56FE;&#x50CF;&#x4E2D;&#x4EA7;&#x751F;&#x8089;&#x773C;&#x53EF;&#x89C1;&#x7684;&#x7EBF;&#x6761;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x968F;&#x673A;&#x5730;&#x6311;&#x9009;&#x5C0F;&#x5757;&#xFF0C;&#x8FD9;&#x6837;&#x5B83;&#x4EEC;&#x7684;&#x4F4D;&#x7F6E;&#x5C31;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;&#x5728;&#x6700;&#x7EC8;&#x7684;DeepDream&#x56FE;&#x50CF;&#x91CC;&#xFF0C;&#x5C0F;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x7F1D;&#x9699;&#x4E0D;&#x53EF;&#x89C1;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x7528;&#x6765;&#x786E;&#x5B9A;&#x5408;&#x9002;&#x7684;&#x56FE;&#x5757;&#x5C3A;&#x5BF8;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x671F;&#x671B;&#x7684;&#x56FE;&#x5757;&#x5C3A;&#x5BF8;&#x4E3A;400x400&#x50CF;&#x7D20;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x5927;&#x5C0F;&#x53D6;&#x51B3;&#x4E8E;&#x56FE;&#x50CF;&#x5C3A;&#x5BF8;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_tile_size</span><span class="hljs-params">(num_pixels, tile_size=<span class="hljs-number">400</span>)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    num_pixels is the number of pixels in a dimension of the image.
    tile_size is the desired tile-size.
    &quot;&quot;&quot;</span>

    <span class="hljs-comment"># How many times can we repeat a tile of the desired size.</span>
    num_tiles = int(round(num_pixels / tile_size))

    <span class="hljs-comment"># Ensure that there is at least 1 tile.</span>
    num_tiles = max(<span class="hljs-number">1</span>, num_tiles)

    <span class="hljs-comment"># The actual tile-size.</span>
    actual_tile_size = math.ceil(num_pixels / num_tiles)

    <span class="hljs-keyword">return</span> actual_tile_size
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x4E86;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x68AF;&#x5EA6;&#x3002;&#x56FE;&#x50CF;&#x88AB;&#x5206;&#x5272;&#x6210;&#x5C0F;&#x5757;&#xFF0C;&#x7136;&#x540E;&#x5206;&#x522B;&#x8BA1;&#x7B97;&#x5404;&#x4E2A;&#x56FE;&#x5757;&#x7684;&#x68AF;&#x5EA6;&#x3002;&#x56FE;&#x5757;&#x662F;&#x968F;&#x673A;&#x9009;&#x62E9;&#x7684;&#xFF0C;&#x907F;&#x514D;&#x5728;&#x6700;&#x7EC8;&#x7684;DeepDream&#x56FE;&#x50CF;&#x5185;&#x4EA7;&#x751F;&#x53EF;&#x89C1;&#x7684;&#x7F1D;&#x9699;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tiled_gradient</span><span class="hljs-params">(gradient, image, tile_size=<span class="hljs-number">400</span>)</span>:</span>
    <span class="hljs-comment"># Allocate an array for the gradient of the entire image.</span>
    grad = np.zeros_like(image)

    <span class="hljs-comment"># Number of pixels for the x- and y-axes.</span>
    x_max, y_max, _ = image.shape

    <span class="hljs-comment"># Tile-size for the x-axis.</span>
    x_tile_size = get_tile_size(num_pixels=x_max, tile_size=tile_size)
    <span class="hljs-comment"># 1/4 of the tile-size.</span>
    x_tile_size4 = x_tile_size // <span class="hljs-number">4</span>

    <span class="hljs-comment"># Tile-size for the y-axis.</span>
    y_tile_size = get_tile_size(num_pixels=y_max, tile_size=tile_size)
    <span class="hljs-comment"># 1/4 of the tile-size</span>
    y_tile_size4 = y_tile_size // <span class="hljs-number">4</span>

    <span class="hljs-comment"># Random start-position for the tiles on the x-axis.</span>
    <span class="hljs-comment"># The random value is between -3/4 and -1/4 of the tile-size.</span>
    <span class="hljs-comment"># This is so the border-tiles are at least 1/4 of the tile-size,</span>
    <span class="hljs-comment"># otherwise the tiles may be too small which creates noisy gradients.</span>
    x_start = random.randint(<span class="hljs-number">-3</span>*x_tile_size4, -x_tile_size4)

    <span class="hljs-keyword">while</span> x_start &lt; x_max:
        <span class="hljs-comment"># End-position for the current tile.</span>
        x_end = x_start + x_tile_size

        <span class="hljs-comment"># Ensure the tile&apos;s start- and end-positions are valid.</span>
        x_start_lim = max(x_start, <span class="hljs-number">0</span>)
        x_end_lim = min(x_end, x_max)

        <span class="hljs-comment"># Random start-position for the tiles on the y-axis.</span>
        <span class="hljs-comment"># The random value is between -3/4 and -1/4 of the tile-size.</span>
        y_start = random.randint(<span class="hljs-number">-3</span>*y_tile_size4, -y_tile_size4)

        <span class="hljs-keyword">while</span> y_start &lt; y_max:
            <span class="hljs-comment"># End-position for the current tile.</span>
            y_end = y_start + y_tile_size

            <span class="hljs-comment"># Ensure the tile&apos;s start- and end-positions are valid.</span>
            y_start_lim = max(y_start, <span class="hljs-number">0</span>)
            y_end_lim = min(y_end, y_max)

            <span class="hljs-comment"># Get the image-tile.</span>
            img_tile = image[x_start_lim:x_end_lim,
                             y_start_lim:y_end_lim, :]

            <span class="hljs-comment"># Create a feed-dict with the image-tile.</span>
            feed_dict = model.create_feed_dict(image=img_tile)

            <span class="hljs-comment"># Use TensorFlow to calculate the gradient-value.</span>
            g = session.run(gradient, feed_dict=feed_dict)

            <span class="hljs-comment"># Normalize the gradient for the tile. This is</span>
            <span class="hljs-comment"># necessary because the tiles may have very different</span>
            <span class="hljs-comment"># values. Normalizing gives a more coherent gradient.</span>
            g /= (np.std(g) + <span class="hljs-number">1e-8</span>)

            <span class="hljs-comment"># Store the tile&apos;s gradient at the appropriate location.</span>
            grad[x_start_lim:x_end_lim,
                 y_start_lim:y_end_lim, :] = g

            <span class="hljs-comment"># Advance the start-position for the y-axis.</span>
            y_start = y_end

        <span class="hljs-comment"># Advance the start-position for the x-axis.</span>
        x_start = x_end

    <span class="hljs-keyword">return</span> grad
</code></pre>
<h3 id="&#x4F18;&#x5316;&#x56FE;&#x50CF;">&#x4F18;&#x5316;&#x56FE;&#x50CF;</h3>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F;DeepDream&#x7B97;&#x6CD5;&#x7684;&#x4E3B;&#x8981;&#x4F18;&#x5316;&#x5FAA;&#x73AF;&#x3002;&#x5B83;&#x6839;&#x636E;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x8BA1;&#x7B97;Inception&#x6A21;&#x578B;&#x4E2D;&#x7ED9;&#x5B9A;&#x5C42;&#x7684;&#x68AF;&#x5EA6;&#x3002;&#x7136;&#x540E;&#x5C06;&#x68AF;&#x5EA6;&#x6DFB;&#x52A0;&#x5230;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#xFF0C;&#x4ECE;&#x800C;&#x589E;&#x52A0;&#x5C42;&#x5F20;&#x91CF;(layer-tensor)&#x7684;&#x5E73;&#x5747;&#x503C;&#x3002;&#x591A;&#x6B21;&#x91CD;&#x590D;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x5E76;&#x653E;&#x5927;Inception&#x6A21;&#x578B;&#x5728;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x4E2D;&#x770B;&#x5230;&#x7684;&#x4EFB;&#x4F55;&#x56FE;&#x6848;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimize_image</span><span class="hljs-params">(layer_tensor, image,
                   num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, tile_size=<span class="hljs-number">400</span>,
                   show_gradient=False)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    Use gradient ascent to optimize an image so it maximizes the
    mean value of the given layer_tensor.

    Parameters:
    layer_tensor: Reference to a tensor that will be maximized.
    image: Input image used as the starting point.
    num_iterations: Number of optimization iterations to perform.
    step_size: Scale for each step of the gradient ascent.
    tile_size: Size of the tiles when calculating the gradient.
    show_gradient: Plot the gradient in each iteration.
    &quot;&quot;&quot;</span>

    <span class="hljs-comment"># Copy the image so we don&apos;t overwrite the original image.</span>
    img = image.copy()

    print(<span class="hljs-string">&quot;Image before:&quot;</span>)
    plot_image(img)

    print(<span class="hljs-string">&quot;Processing image: &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)

    <span class="hljs-comment"># Use TensorFlow to get the mathematical function for the</span>
    <span class="hljs-comment"># gradient of the given layer-tensor with regard to the</span>
    <span class="hljs-comment"># input image. This may cause TensorFlow to add the same</span>
    <span class="hljs-comment"># math-expressions to the graph each time this function is called.</span>
    <span class="hljs-comment"># It may use a lot of RAM and could be moved outside the function.</span>
    gradient = model.get_gradient(layer_tensor)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_iterations):
        <span class="hljs-comment"># Calculate the value of the gradient.</span>
        <span class="hljs-comment"># This tells us how to change the image so as to</span>
        <span class="hljs-comment"># maximize the mean of the given layer-tensor.</span>
        grad = tiled_gradient(gradient=gradient, image=img)

        <span class="hljs-comment"># Blur the gradient with different amounts and add</span>
        <span class="hljs-comment"># them together. The blur amount is also increased</span>
        <span class="hljs-comment"># during the optimization. This was found to give</span>
        <span class="hljs-comment"># nice, smooth images. You can try and change the formulas.</span>
        <span class="hljs-comment"># The blur-amount is called sigma (0=no blur, 1=low blur, etc.)</span>
        <span class="hljs-comment"># We could call gaussian_filter(grad, sigma=(sigma, sigma, 0.0))</span>
        <span class="hljs-comment"># which would not blur the colour-channel. This tends to</span>
        <span class="hljs-comment"># give psychadelic / pastel colours in the resulting images.</span>
        <span class="hljs-comment"># When the colour-channel is also blurred the colours of the</span>
        <span class="hljs-comment"># input image are mostly retained in the output image.</span>
        sigma = (i * <span class="hljs-number">4.0</span>) / num_iterations + <span class="hljs-number">0.5</span>
        grad_smooth1 = gaussian_filter(grad, sigma=sigma)
        grad_smooth2 = gaussian_filter(grad, sigma=sigma*<span class="hljs-number">2</span>)
        grad_smooth3 = gaussian_filter(grad, sigma=sigma*<span class="hljs-number">0.5</span>)
        grad = (grad_smooth1 + grad_smooth2 + grad_smooth3)

        <span class="hljs-comment"># Scale the step-size according to the gradient-values.</span>
        <span class="hljs-comment"># This may not be necessary because the tiled-gradient</span>
        <span class="hljs-comment"># is already normalized.</span>
        step_size_scaled = step_size / (np.std(grad) + <span class="hljs-number">1e-8</span>)

        <span class="hljs-comment"># Update the image by following the gradient.</span>
        img += grad * step_size_scaled

        <span class="hljs-keyword">if</span> show_gradient:
            <span class="hljs-comment"># Print statistics for the gradient.</span>
            msg = <span class="hljs-string">&quot;Gradient min: {0:&gt;9.6f}, max: {1:&gt;9.6f}, stepsize: {2:&gt;9.2f}&quot;</span>
            print(msg.format(grad.min(), grad.max(), step_size_scaled))

            <span class="hljs-comment"># Plot the gradient.</span>
            plot_gradient(grad)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># Otherwise show a little progress-indicator.</span>
            print(<span class="hljs-string">&quot;. &quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)

    print()
    print(<span class="hljs-string">&quot;Image after:&quot;</span>)
    plot_image(img)

    <span class="hljs-keyword">return</span> img
</code></pre>
<h3 id="&#x56FE;&#x50CF;&#x9012;&#x5F52;&#x4F18;&#x5316;">&#x56FE;&#x50CF;&#x9012;&#x5F52;&#x4F18;&#x5316;</h3>
<p>Inception&#x6A21;&#x578B;&#x5728;&#x76F8;&#x5F53;&#x5C0F;&#x7684;&#x56FE;&#x50CF;&#x4E0A;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;&#x3002;&#x4E0D;&#x6E05;&#x695A;&#x56FE;&#x50CF;&#x7684;&#x786E;&#x5207;&#x5927;&#x5C0F;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x6BCF;&#x4E2A;&#x7EF4;&#x5EA6;200-300&#x50CF;&#x7D20;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x8F83;&#x5927;&#x7684;&#x56FE;&#x50CF;&#xFF0C;&#x6BD4;&#x5982;1920x1080&#x50CF;&#x7D20;&#xFF0C;&#x90A3;&#x4E48;&#x4E0A;&#x9762;&#x7684;<code>optimize_image()</code>&#x51FD;&#x6570;&#x4F1A;&#x5728;&#x56FE;&#x50CF;&#x4E0A;&#x6DFB;&#x52A0;&#x5F88;&#x591A;&#x5C0F;&#x7684;&#x56FE;&#x6848;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x5C06;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x591A;&#x6B21;&#x7F29;&#x653E;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6BCF;&#x4E2A;&#x7F29;&#x653E;&#x56FE;&#x50CF;&#x6765;&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;<code>optimize_image()</code>&#x51FD;&#x6570;&#x3002;&#x8FD9;&#x5728;&#x6700;&#x7EC8;&#x7684;&#x56FE;&#x50CF;&#x4E2D;&#x751F;&#x6210;&#x8F83;&#x5927;&#x7684;&#x56FE;&#x6848;&#x3002;&#x5B83;&#x4E5F;&#x80FD;&#x52A0;&#x5FEB;&#x8BA1;&#x7B97;&#x901F;&#x5EA6;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recursive_optimize</span><span class="hljs-params">(layer_tensor, image,
                       num_repeats=<span class="hljs-number">4</span>, rescale_factor=<span class="hljs-number">0.7</span>, blend=<span class="hljs-number">0.2</span>,
                       num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>,
                       tile_size=<span class="hljs-number">400</span>)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    Recursively blur and downscale the input image.
    Each downscaled image is run through the optimize_image()
    function to amplify the patterns that the Inception model sees.

    Parameters:
    image: Input image used as the starting point.
    rescale_factor: Downscaling factor for the image.
    num_repeats: Number of times to downscale the image.
    blend: Factor for blending the original and processed images.

    Parameters passed to optimize_image():
    layer_tensor: Reference to a tensor that will be maximized.
    num_iterations: Number of optimization iterations to perform.
    step_size: Scale for each step of the gradient ascent.
    tile_size: Size of the tiles when calculating the gradient.
    &quot;&quot;&quot;</span>

    <span class="hljs-comment"># Do a recursive step?</span>
    <span class="hljs-keyword">if</span> num_repeats&gt;<span class="hljs-number">0</span>:
        <span class="hljs-comment"># Blur the input image to prevent artifacts when downscaling.</span>
        <span class="hljs-comment"># The blur amount is controlled by sigma. Note that the</span>
        <span class="hljs-comment"># colour-channel is not blurred as it would make the image gray.</span>
        sigma = <span class="hljs-number">0.5</span>
        img_blur = gaussian_filter(image, sigma=(sigma, sigma, <span class="hljs-number">0.0</span>))

        <span class="hljs-comment"># Downscale the image.</span>
        img_downscaled = resize_image(image=img_blur,
                                      factor=rescale_factor)

        <span class="hljs-comment"># Recursive call to this function.</span>
        <span class="hljs-comment"># Subtract one from num_repeats and use the downscaled image.</span>
        img_result = recursive_optimize(layer_tensor=layer_tensor,
                                        image=img_downscaled,
                                        num_repeats=num_repeats<span class="hljs-number">-1</span>,
                                        rescale_factor=rescale_factor,
                                        blend=blend,
                                        num_iterations=num_iterations,
                                        step_size=step_size,
                                        tile_size=tile_size)

        <span class="hljs-comment"># Upscale the resulting image back to its original size.</span>
        img_upscaled = resize_image(image=img_result, size=image.shape)

        <span class="hljs-comment"># Blend the original and processed images.</span>
        image = blend * image + (<span class="hljs-number">1.0</span> - blend) * img_upscaled

    print(<span class="hljs-string">&quot;Recursive level:&quot;</span>, num_repeats)

    <span class="hljs-comment"># Process the image using the DeepDream algorithm.</span>
    img_result = optimize_image(layer_tensor=layer_tensor,
                                image=image,
                                num_iterations=num_iterations,
                                step_size=step_size,
                                tile_size=tile_size)

    <span class="hljs-keyword">return</span> img_result
</code></pre>
<h2 id="tensorflow-&#x4F1A;&#x8BDD;">TensorFlow &#x4F1A;&#x8BDD;</h2>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;TensorFlow&#x4F1A;&#x8BDD;&#x6765;&#x8FD0;&#x884C;&#x56FE;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x5F0F;&#x7684;&#x4F1A;&#x8BDD;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5F80;&#x8BA1;&#x7B97;&#x56FE;&#x4E2D;&#x6DFB;&#x52A0;&#x68AF;&#x5EA6;&#x65B9;&#x7A0B;&#x3002;</p>
<pre><code class="lang-python">session = tf.InteractiveSession(graph=model.graph)
</code></pre>
<h2 id="hulk">Hulk</h2>
<p>&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x5F20;&#x7EFF;&#x5DE8;&#x4EBA;&#x7684;&#x56FE;&#x50CF;&#x3002;&#x6CE8;&#x610F;&#x770B;&#x770B;DeepDream&#x56FE;&#x50CF;&#x662F;&#x5982;&#x4F55;&#x4FDD;&#x7559;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x539F;&#x59CB;&#x56FE;&#x50CF;&#x989C;&#x8272;&#x7684;&#x3002;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x68AF;&#x5EA6;&#x5728;&#x5176;&#x989C;&#x8272;&#x901A;&#x9053;&#x4E2D;&#x88AB;&#x5E73;&#x6ED1;&#x5904;&#x7406;&#x4E86;&#xFF0C;&#x56E0;&#x6B64;&#x53D8;&#x5F97;&#x6709;&#x70B9;&#x50CF;&#x7070;&#x9636;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x6539;&#x53D8;&#x56FE;&#x50CF;&#x7684;&#x5F62;&#x72B6;&#xFF0C;&#x800C;&#x4E0D;&#x6539;&#x53D8;&#x5176;&#x989C;&#x8272;&#x3002;</p>
<pre><code class="lang-python">image = load_image(filename=<span class="hljs-string">&apos;images/hulk.jpg&apos;</span>)
plot_image(image)
</code></pre>
<p><img src="output_50_0.png" alt="png"></p>
<p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;Inception&#x6A21;&#x578B;&#x4E2D;&#x7684;&#x5F20;&#x91CF;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x5B83;&#x5C06;&#x5728;DeepDream&#x4F18;&#x5316;&#x7B97;&#x6CD5;&#x4E2D;&#x88AB;&#x6700;&#x5927;&#x5316;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;Inception&#x6A21;&#x578B;&#x7684;&#x7B2C;3&#x5C42;&#xFF08;&#x5C42;&#x7D22;&#x5F15;2&#xFF09;&#x3002;&#x5B83;&#x6709;192&#x4E2A;&#x901A;&#x9053;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5C1D;&#x8BD5;&#x6700;&#x5927;&#x5316;&#x8FD9;&#x4E9B;&#x901A;&#x9053;&#x7684;&#x5E73;&#x5747;&#x503C;&#x3002;</p>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">2</span>]
layer_tensor
</code></pre>
<pre><code>&lt;tf.Tensor &apos;conv2d2:0&apos; shape=(?, ?, ?, 192) dtype=float32&gt;
</code></pre><p>&#x73B0;&#x5728;&#x8FD0;&#x884C;DeepDream&#x4F18;&#x5316;&#x7B97;&#x6CD5;&#xFF0C;&#x603B;&#x5171;10&#x6B21;&#x8FED;&#x4EE3;&#xFF0C;&#x6B65;&#x957F;&#x4E3A;6.0&#xFF0C;&#x8FD9;&#x662F;&#x4E0B;&#x9762;&#x9012;&#x5F52;&#x4F18;&#x5316;&#x7684;&#x4E24;&#x500D;&#x3002;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x6211;&#x4EEC;&#x90FD;&#x5C55;&#x793A;&#x5B83;&#x7684;&#x68AF;&#x5EA6;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x56FE;&#x50CF;&#x65B9;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x75D5;&#x8FF9;&#x3002;</p>
<pre><code class="lang-python">img_result = optimize_image(layer_tensor, image,
                   num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">6.0</span>, tile_size=<span class="hljs-number">400</span>,
                   show_gradient=<span class="hljs-keyword">True</span>)
</code></pre>
<pre><code>Image before:
</code></pre><p><img src="output_54_1.png" alt="png"></p>
<pre><code>Processing image: Gradient min: -26.993517, max: 25.577057, stepsize:      3.35
</code></pre><p><img src="output_54_3.png" alt="png"></p>
<pre><code>Gradient min: -15.383774, max: 12.962121, stepsize:      5.97
</code></pre><p><img src="output_54_5.png" alt="png"></p>
<pre><code>Gradient min: -5.993865, max:  6.191866, stepsize:     10.42
</code></pre><p><img src="output_54_7.png" alt="png"></p>
<pre><code>Gradient min: -3.638639, max:  3.307561, stepsize:     15.68
</code></pre><p><img src="output_54_9.png" alt="png"></p>
<pre><code>Gradient min: -2.407669, max:  2.166253, stepsize:     22.57
</code></pre><p><img src="output_54_11.png" alt="png"></p>
<pre><code>Gradient min: -1.716694, max:  1.467488, stepsize:     29.86
</code></pre><p><img src="output_54_13.png" alt="png"></p>
<pre><code>Gradient min: -1.153857, max:  1.025310, stepsize:     38.37
</code></pre><p><img src="output_54_15.png" alt="png"></p>
<pre><code>Gradient min: -1.026255, max:  0.869002, stepsize:     48.34
</code></pre><p><img src="output_54_17.png" alt="png"></p>
<pre><code>Gradient min: -0.634610, max:  0.765562, stepsize:     63.08
</code></pre><p><img src="output_54_19.png" alt="png"></p>
<pre><code>Gradient min: -0.585900, max:  0.485299, stepsize:     83.16
</code></pre><p><img src="output_54_21.png" alt="png"></p>
<pre><code>Image after:
</code></pre><p><img src="output_54_23.png" alt="png"></p>
<p>&#x5982;&#x679C;&#x4F60;&#x613F;&#x610F;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x5B58;DeepDream&#x56FE;&#x50CF;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># save_image(img_result, filename=&apos;deepdream_hulk.jpg&apos;)</span>
</code></pre>
<p>&#x73B0;&#x5728;&#xFF0C;&#x9012;&#x5F52;&#x8C03;&#x7528;DeepDream&#x7B97;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x6267;&#x884C;5&#x4E2A;&#x9012;&#x5F52;&#xFF08;<code>num_repeats + 1</code>&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#x56FE;&#x50CF;&#x90FD;&#x88AB;&#x6A21;&#x7CCA;&#x5E76;&#x7F29;&#x5C0F;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x7F29;&#x5C0F;&#x56FE;&#x50CF;&#x4E0A;&#x8FD0;&#x884C;DeepDream&#x7B97;&#x6CD5;&#x3002;&#x63A5;&#x7740;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A;&#x6B65;&#x9AA4;&#x4E2D;&#xFF0C;&#x5C06;&#x4EA7;&#x751F;&#x7684;DeepDream&#x56FE;&#x50CF;&#x4E0E;&#x539F;&#x59CB;&#x56FE;&#x50CF;&#x6DF7;&#x5408;&#xFF0C;&#x4ECE;&#x539F;&#x59CB;&#x56FE;&#x50CF;&#x83B7;&#x53D6;&#x4E00;&#x70B9;&#x7EC6;&#x8282;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x91CD;&#x590D;&#x4E86;&#x591A;&#x6B21;&#x3002;</p>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x73B0;&#x5728;DeepDream&#x7684;&#x56FE;&#x6848;&#x66F4;&#x5927;&#x4E86;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5148;&#x5728;&#x4F4E;&#x5206;&#x8FA8;&#x7387;&#x56FE;&#x50CF;&#x4E0A;&#x521B;&#x5EFA;&#x56FE;&#x6848;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8F83;&#x9AD8;&#x5206;&#x8FA8;&#x7387;&#x56FE;&#x50CF;&#x4E0A;&#x8FDB;&#x884C;&#x7EC6;&#x5316;&#x3002;</p>
<pre><code class="lang-python">img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">4</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<pre><code>Recursive level: 0
Image before:
</code></pre><p><img src="output_58_1.png" alt="png"></p>
<pre><code>Processing image: . . . . . . . . . . 
Image after:
</code></pre><p><img src="output_58_3.png" alt="png"></p>
<pre><code>Recursive level: 1
Image before:
</code></pre><p><img src="output_58_5.png" alt="png"></p>
<pre><code>Processing image: . . . . . . . . . . 
Image after:
</code></pre><p><img src="output_58_7.png" alt="png"></p>
<pre><code>Recursive level: 2
Image before:
</code></pre><p><img src="output_58_9.png" alt="png"></p>
<pre><code>Processing image: . . . . . . . . . . 
Image after:
</code></pre><p><img src="output_58_11.png" alt="png"></p>
<pre><code>Recursive level: 3
Image before:
</code></pre><p><img src="output_58_13.png" alt="png"></p>
<pre><code>Processing image: . . . . . . . . . . 
Image after:
</code></pre><p><img src="output_58_15.png" alt="png"></p>
<pre><code>Recursive level: 4
Image before:
</code></pre><p><img src="output_58_17.png" alt="png"></p>
<pre><code>Processing image: . . . . . . . . . . 
Image after:
</code></pre><p><img src="output_58_19.png" alt="png"></p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C06;&#x6700;&#x5927;&#x5316;Inception&#x6A21;&#x578B;&#x4E2D;&#x7684;&#x8F83;&#x9AD8;&#x5C42;&#x3002;&#x4F7F;&#x7528;7&#x53F7;&#x5C42;&#xFF08;&#x7D22;&#x5F15;6&#xFF09;&#x4E3A;&#x4F8B;&#x3002;&#x8BE5;&#x5C42;&#x8BC6;&#x522B;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x4E2D;&#x66F4;&#x590D;&#x6742;&#x7684;&#x5F62;&#x72B6;&#xFF0C;&#x6240;&#x4EE5;DeepDream&#x7B97;&#x6CD5;&#x4E5F;&#x5C06;&#x4EA7;&#x751F;&#x66F4;&#x590D;&#x6742;&#x7684;&#x56FE;&#x50CF;&#x3002;&#x8FD9;&#x4E00;&#x5C42;&#x4F3C;&#x4E4E;&#x8BC6;&#x522B;&#x4E86;&#x72D7;&#x7684;&#x8138;&#x548C;&#x6BDB;&#x53D1;&#xFF0C;&#x56E0;&#x6B64;DeepDream&#x7B97;&#x6CD5;&#x5F80;&#x56FE;&#x50CF;&#x4E2D;&#x6DFB;&#x52A0;&#x4E86;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x3002;</p>
<p>&#x518D;&#x6B21;&#x6CE8;&#x610F;&#xFF0C;&#x4E0E;DeepDream&#x7B97;&#x6CD5;&#x5176;&#x4ED6;&#x53D8;&#x4F53;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x5927;&#x90E8;&#x5206;&#x989C;&#x8272;&#x88AB;&#x4FDD;&#x7559;&#x4E86;&#x4E0B;&#x6765;&#xFF0C;&#x521B;&#x5EFA;&#x4E86;&#x66F4;&#x591A;&#x67D4;&#x548C;&#x7684;&#x989C;&#x8272;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5728;&#x989C;&#x8272;&#x901A;&#x9053;&#x4E2D;&#x5E73;&#x6ED1;&#x4E86;&#x68AF;&#x5EA6;&#xFF0C;&#x4F7F;&#x5176;&#x53D8;&#x5F97;&#x6709;&#x70B9;&#x50CF;&#x7070;&#x9636;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x4F1A;&#x592A;&#x591A;&#x5730;&#x6539;&#x53D8;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x989C;&#x8272;&#x3002;</p>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">6</span>]
img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">4</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<p>&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x7528;DeepDream&#x7B97;&#x6CD5;&#x6765;&#x6700;&#x5927;&#x5316;&#x5C42;&#x7684;&#x7279;&#x5F81;&#x901A;&#x9053;&#x7684;&#x5B50;&#x96C6;&#x3002;&#x6B64;&#x65F6;&#x5C42;&#x7684;&#x7D22;&#x5F15;&#x4E3A;7&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x6709;&#x524D;3&#x4E2A;&#x7279;&#x5F81;&#x901A;&#x9053;&#x88AB;&#x6700;&#x5927;&#x5316;&#x3002;</p>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">7</span>][:,:,:,<span class="hljs-number">0</span>:<span class="hljs-number">3</span>]
img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">4</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5C55;&#x793A;&#x4E86;&#x6700;&#x5927;&#x5316;Inception&#x6A21;&#x578B;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x7279;&#x5F81;&#x901A;&#x9053;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x4E0D;&#x592A;&#x6E05;&#x695A;&#x8FD9;&#x4E00;&#x5C42;&#x53CA;&#x8FD9;&#x4E2A;&#x7279;&#x5F81;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x4E2D;&#x8BC6;&#x522B;&#x51FA;&#x4EC0;&#x4E48;&#x6765;&#x3002;  </p>
<p>&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x7684;<code>num_repeates</code>&#x53C2;&#x6570;&#x8BBE;&#x4E3A;4&#xFF0C;&#x6211;&#x5728;&#x914D;&#x6709;NVIDIA GT 650M&#x7684;&#x7B14;&#x8BB0;&#x672C;&#x4E0A;&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E0B;&#x9762;&#x5C06;<code>num_repeates</code>&#x8BBE;&#x4E3A;3&#xFF0C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x6539;&#x56DE;&#x6765;&#x3002;&#xFF09;</p>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">11</span>][:,:,:,<span class="hljs-number">0</span>]
img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">3</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<h2 id="giger">Giger</h2>
<pre><code class="lang-python">image = load_image(filename=<span class="hljs-string">&apos;images/giger.jpg&apos;</span>)
plot_image(image)
</code></pre>
<p><img src="output_66_0.png" alt="png"></p>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">3</span>]
img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">3</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">5</span>]
img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">3</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<h2 id="escher">Escher</h2>
<pre><code class="lang-python">image = load_image(filename=<span class="hljs-string">&apos;images/escher_planefilling2.jpg&apos;</span>)
plot_image(image)
</code></pre>
<p><img src="output_70_0.png" alt="png"></p>
<pre><code class="lang-python">layer_tensor = model.layer_tensors[<span class="hljs-number">6</span>]
img_result = recursive_optimize(layer_tensor=layer_tensor, image=image,
                 num_iterations=<span class="hljs-number">10</span>, step_size=<span class="hljs-number">3.0</span>, rescale_factor=<span class="hljs-number">0.7</span>,
                 num_repeats=<span class="hljs-number">3</span>, blend=<span class="hljs-number">0.2</span>)
</code></pre>
<h2 id="&#x5173;&#x95ED;tensorflow&#x4F1A;&#x8BDD;">&#x5173;&#x95ED;TensorFlow&#x4F1A;&#x8BDD;</h2>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x7528;TensorFlow&#x5B8C;&#x6210;&#x4E86;&#x4EFB;&#x52A1;&#xFF0C;&#x5173;&#x95ED;session&#xFF0C;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># This has been commented out in case you want to modify and experiment</span>
<span class="hljs-comment"># with the Notebook without having to restart it.</span>
<span class="hljs-comment"># session.close()</span>
</code></pre>
<h2 id="&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</h2>
<p>&#x8FD9;&#x7BC7;&#x6559;&#x7A0B;&#x5C55;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x68AF;&#x5EA6;&#x6765;&#x653E;&#x5927;&#x56FE;&#x50CF;&#x4E2D;&#x7684;&#x56FE;&#x6848;&#x3002;&#x8F93;&#x51FA;&#x56FE;&#x50CF;&#x4F3C;&#x4E4E;&#x5DF2;&#x7ECF;&#x7528;&#x62BD;&#x8C61;&#x7684;&#x6216;&#x7C7B;&#x4F3C;&#x52A8;&#x7269;&#x7684;&#x56FE;&#x6848;&#x6765;&#x91CD;&#x65B0;&#x7ED8;&#x5236;&#x4E86;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x8BB8;&#x591A;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x7684;&#x53D8;&#x4F53;&#xFF0C;&#x6765;&#x751F;&#x6210;&#x4E0D;&#x540C;&#x7684;&#x8F93;&#x51FA;&#x56FE;&#x50CF;&#x3002;&#x6211;&#x4EEC;&#x9F13;&#x52B1;&#x4F60;&#x4FEE;&#x6539;&#x4E0A;&#x8FF0;&#x53C2;&#x6570;&#x548C;&#x7B97;&#x6CD5;&#x8FDB;&#x884C;&#x5B9E;&#x9A8C;&#x3002;</p>
<h2 id="&#x7EC3;&#x4E60;">&#x7EC3;&#x4E60;</h2>
<p>&#x4E0B;&#x9762;&#x4F7F;&#x4E00;&#x4E9B;&#x53EF;&#x80FD;&#x4F1A;&#x8BA9;&#x4F60;&#x63D0;&#x5347;TensorFlow&#x6280;&#x80FD;&#x7684;&#x4E00;&#x4E9B;&#x5EFA;&#x8BAE;&#x7EC3;&#x4E60;&#x3002;&#x4E3A;&#x4E86;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x66F4;&#x5408;&#x9002;&#x5730;&#x4F7F;&#x7528;TensorFlow&#xFF0C;&#x5B9E;&#x8DF5;&#x7ECF;&#x9A8C;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x3002;</p>
<p>&#x5728;&#x4F60;&#x5BF9;&#x8FD9;&#x4E2A;Notebook&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x4E4B;&#x524D;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5148;&#x5907;&#x4EFD;&#x4E00;&#x4E0B;&#x3002;</p>
<ul>
<li>&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x56FE;&#x50CF;&#x3002;</li>
<li>&#x8BD5;&#x8BD5;<code>optimize_image()</code>&#x548C;<code>recursive_optimize()</code>&#x7684;&#x4E0D;&#x540C;&#x53C2;&#x6570;&#xFF0C;&#x770B;&#x770B;&#x5B83;&#x5982;&#x4F55;&#x5F71;&#x54CD;&#x7ED3;&#x679C;&#x3002;</li>
<li>&#x8BD5;&#x7740;&#x53BB;&#x6389;<code>optimize_image()</code>&#x4E2D;&#x7684;&#x68AF;&#x5EA6;&#x3002;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>&#x5728;&#x8FD0;&#x884C;<code>optimize_image()</code>&#x65F6;&#x7ED8;&#x5236;&#x68AF;&#x5EA6;&#x3002;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E9B;&#x5931;&#x771F;&#x5417;&#xFF1F;&#x4F60;&#x8BA4;&#x4E3A;&#x662F;&#x4EC0;&#x4E48;&#x539F;&#x56E0;&#xFF1F;&#x8FD9;&#x91CD;&#x8981;&#x5417;&#xFF1F;&#x4F60;&#x80FD;&#x627E;&#x5230;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x53BB;&#x6389;&#x5B83;&#x4EEC;&#x5417;&#xFF1F;</li>
<li>&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x566A;&#x58F0;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x3002;&#x8FD9;&#x4E0E;&#x6559;&#x7A0B;&#xFF03;13&#x4E2D;&#x7528;&#x4E8E;&#x53EF;&#x89C6;&#x5316;&#x5206;&#x6790;&#x7684;&#x7C7B;&#x4F3C;&#x3002;&#x4F1A;&#x751F;&#x6210;&#x6BD4;&#x672C;&#x6559;&#x7A0B;&#x4E2D;&#x66F4;&#x597D;&#x7684;&#x56FE;&#x50CF;&#x5417;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>&#x5728;<code>inception5h.py</code>&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7684;<code>Inception5h.get_gradient()</code>&#x91CC;&#xFF0C;&#x5220;&#x9664;<code>tf.square()</code>&#x3002; DeepDream&#x56FE;&#x50CF;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x53D8;&#x5316;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x68AF;&#x5EA6;&#x79FB;&#x5230;<code>optimize_image()</code>&#x5916;&#x9762;&#x4EE5;&#x8282;&#x7701;&#x5185;&#x5B58;&#x5417;&#xFF1F;</li>
<li>&#x4F60;&#x80FD;&#x4F7F;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x5F97;&#x66F4;&#x5FEB;&#x5417;&#xFF1F;&#x4E00;&#x4E2A;&#x60F3;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x5728;TensorFlow&#x4E2D;&#x5B9E;&#x73B0;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x548C;&#x8C03;&#x6574;&#x5927;&#x5C0F;&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x91CD;&#x590D;&#x8C03;&#x7528;<code>optimize_image()</code>&#x5E76;&#x5728;&#x56FE;&#x50CF;&#x4E0A;&#x653E;&#x5927;&#x4E00;&#x70B9;&#xFF0C;&#x5236;&#x4F5C;&#x4E00;&#x4E2A;DeepDream&#x7535;&#x5F71;&#x3002;</li>
<li>&#x9010;&#x5E27;&#x5904;&#x7406;&#x7535;&#x5F71;&#x3002;&#x60A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728;&#x5E27;&#x95F4;&#x4FDD;&#x6301;&#x7A33;&#x5B9A;&#x3002;</li>
<li>&#x5411;&#x670B;&#x53CB;&#x89E3;&#x91CA;&#x7A0B;&#x5E8F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x3002;</li>
</ul>
<h2 id="license-mit">License (MIT)</h2>
<p>Copyright (c) 2016 by <a href="http://www.hvass-labs.org/" target="_blank">Magnus Erik Hvass Pedersen</a></p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.html" class="navigation navigation-prev " aria-label="Previous page: 可视化分析">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.html" class="navigation navigation-next " aria-label="Next page: 风格迁移">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"DeepDream","level":"1.14","depth":1,"next":{"title":"风格迁移","level":"1.15","depth":1,"path":"15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.md","ref":"15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.md","articles":[]},"previous":{"title":"可视化分析","level":"1.13","depth":1,"path":"13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.md","ref":"13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.md","articles":[]},"dir":"ltr"},"config":{"plugins":["comment"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"comment":{"highlightCommented":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"wizardforcel","pdf":{"pageNumbers":true,"fontSize":16,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"TensorFlow 教程（Hvass）","language":"zh","links":{"sidebar":{"TensorFlow 教程（Hvass）":"https://www.gitbook.com/book/wizardforcel/tf-tut-hvass"},"gitbook":true},"gitbook":"*","description":"Tensorflow 教程（Hvass）"},"file":{"path":"14_DeepDream_zh_CN/14_DeepDream_zh_CN.md","mtime":"2017-09-18T01:21:37.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-09-18T01:34:14.068Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-comment/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

