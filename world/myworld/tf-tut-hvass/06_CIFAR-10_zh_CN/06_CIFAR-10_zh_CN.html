
<!DOCTYPE HTML>
<html lang="zh" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>CIFAR-10 · TensorFlow 教程（Hvass）</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="wizardforcel">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-comment/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.html" />
    
    
    <link rel="prev" href="../05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="輸入並搜尋" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.gitbook.com/book/wizardforcel/tf-tut-hvass" target="_blank" class="custom-link">TensorFlow 教程（Hvass）</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    TensorFlow 教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../01_Simple_Linear_Model_zh_CN/01_Simple_Linear_Model_zh_CN.html">
            
                <a href="../01_Simple_Linear_Model_zh_CN/01_Simple_Linear_Model_zh_CN.html">
            
                    
                    简单线性模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../02_Convolutional_Neural_Network_zh_CN/02_Convolutional_Neural_Network_zh_CN.html">
            
                <a href="../02_Convolutional_Neural_Network_zh_CN/02_Convolutional_Neural_Network_zh_CN.html">
            
                    
                    卷积神经网络
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../03_PrettyTensor_zh_CN/03_PrettyTensor_zh_CN.html">
            
                <a href="../03_PrettyTensor_zh_CN/03_PrettyTensor_zh_CN.html">
            
                    
                    PrettyTensor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../04_Save_Restore_zh_CN/04_Save_Restore_zh_CN.html">
            
                <a href="../04_Save_Restore_zh_CN/04_Save_Restore_zh_CN.html">
            
                    
                    保存 & 恢复
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.html">
            
                <a href="../05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.html">
            
                    
                    集成学习
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7" data-path="06_CIFAR-10_zh_CN.html">
            
                <a href="06_CIFAR-10_zh_CN.html">
            
                    
                    CIFAR-10
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.html">
            
                <a href="../07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.html">
            
                    
                    Inception 模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../08_Transfer_Learning_zh_CN/08_Transfer_Learning_zh_CN.html">
            
                <a href="../08_Transfer_Learning_zh_CN/08_Transfer_Learning_zh_CN.html">
            
                    
                    迁移学习
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../09_Video_Data_zh_CN/09_Video_Data_zh_CN.html">
            
                <a href="../09_Video_Data_zh_CN/09_Video_Data_zh_CN.html">
            
                    
                    视频数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../11_Adversarial_Examples_zh_CN/11_Adversarial_Examples_zh_CN.html">
            
                <a href="../11_Adversarial_Examples_zh_CN/11_Adversarial_Examples_zh_CN.html">
            
                    
                    对抗样本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../12_Adversarial_Noise_MNIST_zh_CN/12_Adversarial_Noise_MNIST_zh_CN.html">
            
                <a href="../12_Adversarial_Noise_MNIST_zh_CN/12_Adversarial_Noise_MNIST_zh_CN.html">
            
                    
                    MNIST的对抗噪声
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.html">
            
                <a href="../13_Visual_Analysis_zh_CN/13_Visual_Analysis_zh_CN.html">
            
                    
                    可视化分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../14_DeepDream_zh_CN/14_DeepDream_zh_CN.html">
            
                <a href="../14_DeepDream_zh_CN/14_DeepDream_zh_CN.html">
            
                    
                    DeepDream
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.html">
            
                <a href="../15_Style_Transfer_zh_CN/15_Style_Transfer_zh_CN.html">
            
                    
                    风格迁移
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本書使用 GitBook 釋出
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >CIFAR-10</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tensorflow-&#x6559;&#x7A0B;-06">TensorFlow &#x6559;&#x7A0B; #06</h1>
<h1 id="cifar-10">CIFAR-10</h1>
<p>by <a href="http://www.hvass-labs.org/" target="_blank">Magnus Erik Hvass Pedersen</a>
/ <a href="https://github.com/Hvass-Labs/TensorFlow-Tutorials" target="_blank">GitHub</a> / <a href="https://www.youtube.com/playlist?list=PL9Hr9sNUjfsmEu1ZniY0XpHSzl5uihcXZ" target="_blank">Videos on YouTube</a><br>&#x4E2D;&#x6587;&#x7FFB;&#x8BD1; <a href="https://zhuanlan.zhihu.com/insight-pixel" target="_blank">thrillerist</a>/<a href="https://github.com/thrillerist/TensorFlow-Tutorials" target="_blank">Github</a></p>
<h2 id="&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</h2>
<p>&#x8FD9;&#x7BC7;&#x6559;&#x7A0B;&#x4ECB;&#x7ECD;&#x4E86;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5728;CIRAR-10&#x6570;&#x636E;&#x96C6;&#x4E0A;&#x8FDB;&#x884C;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x8BF4;&#x660E;&#x4E86;&#x5728;&#x8BAD;&#x7EC3;&#x548C;&#x6D4B;&#x8BD5;&#x65F6;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x7F51;&#x7EDC;&#x3002;</p>
<p>&#x672C;&#x6587;&#x57FA;&#x4E8E;&#x4E0A;&#x4E00;&#x7BC7;&#x6559;&#x7A0B;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x57FA;&#x672C;&#x7684;TensorFlow&#x548C;&#x9644;&#x52A0;&#x5305;Pretty Tensor&#x3002;&#x5176;&#x4E2D;&#x5927;&#x91CF;&#x4EE3;&#x7801;&#x548C;&#x6587;&#x5B57;&#x4E0E;&#x4E4B;&#x524D;&#x6559;&#x7A0B;&#x76F8;&#x4F3C;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x770B;&#x8FC7;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5730;&#x6D4F;&#x89C8;&#x672C;&#x6587;&#x3002;</p>
<h2 id="&#x6D41;&#x7A0B;&#x56FE;">&#x6D41;&#x7A0B;&#x56FE;</h2>
<p>&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x8868;&#x76F4;&#x63A5;&#x663E;&#x793A;&#x4E86;&#x4E4B;&#x540E;&#x5B9E;&#x73B0;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E2D;&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012;&#x3002;&#x9996;&#x5148;&#x6709;&#x4E00;&#x4E2A;&#x626D;&#x66F2;&#xFF08;distorts&#xFF09;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x9884;&#x5904;&#x7406;&#x5C42;&#xFF0C;&#x7528;&#x6765;&#x4EBA;&#x4E3A;&#x5730;&#x6269;&#x5927;&#x8BAD;&#x7EC3;&#x96C6;&#x3002;&#x63A5;&#x7740;&#x6709;&#x4E24;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#xFF0C;&#x4E24;&#x4E2A;&#x5168;&#x8FDE;&#x63A5;&#x5C42;&#x548C;&#x4E00;&#x4E2A;softmax&#x5206;&#x7C7B;&#x5C42;&#x3002;&#x5728;&#x540E;&#x9762;&#x4F1A;&#x6709;&#x66F4;&#x5927;&#x7684;&#x56FE;&#x793A;&#x6765;&#x663E;&#x793A;&#x6743;&#x91CD;&#x548C;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x6559;&#x7A0B; #02 &#x6709;&#x5377;&#x79EF;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x56FE;&#x50CF;&#x662F;&#x8BEF;&#x5206;&#x7C7B;&#x7684;&#x3002;&#x56FE;&#x50CF;&#x4E0A;&#x6709;&#x4E00;&#x53EA;&#x72D7;&#xFF0C;&#x4F46;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E0D;&#x786E;&#x5B9A;&#x5B83;&#x662F;&#x72D7;&#x8FD8;&#x662F;&#x732B;&#xFF0C;&#x8BA4;&#x4E3A;&#x66F4;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x732B;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> Image
Image(<span class="hljs-string">&apos;images/06_network_flowchart.png&apos;</span>)
</code></pre>
<p><img src="output_4_0.png" alt="png"></p>
<h2 id="&#x5BFC;&#x5165;">&#x5BFC;&#x5165;</h2>
<pre><code class="lang-python">%matplotlib inline
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> confusion_matrix
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># Use PrettyTensor to simplify Neural Network construction.</span>
<span class="hljs-keyword">import</span> prettytensor <span class="hljs-keyword">as</span> pt
</code></pre>
<p>&#x4F7F;&#x7528;Python3.5.2&#xFF08;Anaconda&#xFF09;&#x5F00;&#x53D1;&#xFF0C;TensorFlow&#x7248;&#x672C;&#x662F;&#xFF1A;</p>
<pre><code class="lang-python">tf.__version__
</code></pre>
<pre><code>&apos;0.12.0-rc0&apos;
</code></pre><p>PrettyTensor &#x7248;&#x672C;:</p>
<pre><code class="lang-python">pt.__version__
</code></pre>
<pre><code>&apos;0.7.1&apos;
</code></pre><h2 id="&#x8F7D;&#x5165;&#x6570;&#x636E;">&#x8F7D;&#x5165;&#x6570;&#x636E;</h2>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> cifar10
</code></pre>
<p>&#x8BBE;&#x7F6E;&#x7535;&#x8111;&#x4E0A;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x96C6;&#x7684;&#x8DEF;&#x5F84;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># cifar10.data_path = &quot;data/CIFAR-10/&quot;</span>
</code></pre>
<p>CIFAR-10&#x6570;&#x636E;&#x96C6;&#x5927;&#x6982;&#x6709;163MB&#xFF0C;&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x8DEF;&#x5F84;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x6587;&#x4EF6;&#x7684;&#x8BDD;&#xFF0C;&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x4E0B;&#x8F7D;&#x3002;</p>
<pre><code class="lang-python">cifar10.maybe_download_and_extract()
</code></pre>
<pre><code>Data has apparently already been downloaded and unpacked.
</code></pre><p>&#x8F7D;&#x5165;&#x5206;&#x7C7B;&#x540D;&#x79F0;&#x3002;</p>
<pre><code class="lang-python">class_names = cifar10.load_class_names()
class_names
</code></pre>
<pre><code>Loading data: data/CIFAR-10/cifar-10-batches-py/batches.meta





[&apos;airplane&apos;,
 &apos;automobile&apos;,
 &apos;bird&apos;,
 &apos;cat&apos;,
 &apos;deer&apos;,
 &apos;dog&apos;,
 &apos;frog&apos;,
 &apos;horse&apos;,
 &apos;ship&apos;,
 &apos;truck&apos;]
</code></pre><p>&#x8F7D;&#x5165;&#x8BAD;&#x7EC3;&#x96C6;&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x56FE;&#x50CF;&#x3001;&#x6574;&#x5F62;&#x5206;&#x7C7B;&#x53F7;&#x7801;&#x3001;&#x4EE5;&#x53CA;&#x7528;One-Hot&#x7F16;&#x7801;&#x7684;&#x5206;&#x7C7B;&#x53F7;&#x6570;&#x7EC4;&#xFF0C;&#x79F0;&#x4E3A;&#x6807;&#x7B7E;&#x3002;</p>
<pre><code class="lang-python">images_train, cls_train, labels_train = cifar10.load_training_data()
</code></pre>
<pre><code>Loading data: data/CIFAR-10/cifar-10-batches-py/data_batch_1
Loading data: data/CIFAR-10/cifar-10-batches-py/data_batch_2
Loading data: data/CIFAR-10/cifar-10-batches-py/data_batch_3
Loading data: data/CIFAR-10/cifar-10-batches-py/data_batch_4
Loading data: data/CIFAR-10/cifar-10-batches-py/data_batch_5
</code></pre><p>&#x8F7D;&#x5165;&#x6D4B;&#x8BD5;&#x96C6;&#x3002;</p>
<pre><code class="lang-python">images_test, cls_test, labels_test = cifar10.load_test_data()
</code></pre>
<pre><code>Loading data: data/CIFAR-10/cifar-10-batches-py/test_batch
</code></pre><p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x8F7D;&#x5165;&#x4E86;CIFAR-10&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x5B83;&#x5305;&#x542B;60,000&#x5F20;&#x56FE;&#x50CF;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x7684;&#x6807;&#x7B7E;&#xFF08;&#x56FE;&#x50CF;&#x7684;&#x5206;&#x7C7B;&#xFF09;&#x3002;&#x6570;&#x636E;&#x96C6;&#x88AB;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x5B50;&#x96C6;&#xFF0C;&#x5373;&#x8BAD;&#x7EC3;&#x96C6;&#x548C;&#x6D4B;&#x8BD5;&#x96C6;&#x3002;</p>
<pre><code class="lang-python">print(<span class="hljs-string">&quot;Size of:&quot;</span>)
print(<span class="hljs-string">&quot;- Training-set:\t\t{}&quot;</span>.format(len(images_train)))
print(<span class="hljs-string">&quot;- Test-set:\t\t{}&quot;</span>.format(len(images_test)))
</code></pre>
<pre><code>Size of:
- Training-set:        50000
- Test-set:        10000
</code></pre><h3 id="&#x6570;&#x636E;&#x7EF4;&#x5EA6;">&#x6570;&#x636E;&#x7EF4;&#x5EA6;</h3>
<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x591A;&#x6B21;&#x7528;&#x5230;&#x6570;&#x636E;&#x7EF4;&#x5EA6;&#x3002;cirfa10&#x6A21;&#x5757;&#x4E2D;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x597D;&#x4E86;&#x8FD9;&#x4E9B;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;import&#x8FDB;&#x6765;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> cifar10 <span class="hljs-keyword">import</span> img_size, num_channels, num_classes
</code></pre>
<p>&#x56FE;&#x50CF;&#x662F;32 x 32&#x50CF;&#x7D20;&#x7684;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5C06;&#x56FE;&#x50CF;&#x88C1;&#x526A;&#x81F3;24 x 24&#x50CF;&#x7D20;&#x3002;</p>
<pre><code class="lang-python">img_size_cropped = <span class="hljs-number">24</span>
</code></pre>
<h3 id="&#x7528;&#x6765;&#x7ED8;&#x5236;&#x56FE;&#x7247;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x7528;&#x6765;&#x7ED8;&#x5236;&#x56FE;&#x7247;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x6765;&#x5728;3x3&#x7684;&#x6805;&#x683C;&#x4E2D;&#x753B;9&#x5F20;&#x56FE;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6BCF;&#x5F20;&#x56FE;&#x50CF;&#x4E0B;&#x9762;&#x5199;&#x51FA;&#x771F;&#x5B9E;&#x7C7B;&#x522B;&#x548C;&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_images</span><span class="hljs-params">(images, cls_true, cls_pred=None, smooth=True)</span>:</span>

    <span class="hljs-keyword">assert</span> len(images) == len(cls_true) == <span class="hljs-number">9</span>

    <span class="hljs-comment"># Create figure with sub-plots.</span>
    fig, axes = plt.subplots(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)

    <span class="hljs-comment"># Adjust vertical spacing if we need to print ensemble and best-net.</span>
    <span class="hljs-keyword">if</span> cls_pred <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
        hspace = <span class="hljs-number">0.3</span>
    <span class="hljs-keyword">else</span>:
        hspace = <span class="hljs-number">0.6</span>
    fig.subplots_adjust(hspace=hspace, wspace=<span class="hljs-number">0.3</span>)

    <span class="hljs-keyword">for</span> i, ax <span class="hljs-keyword">in</span> enumerate(axes.flat):
        <span class="hljs-comment"># Interpolation type.</span>
        <span class="hljs-keyword">if</span> smooth:
            interpolation = <span class="hljs-string">&apos;spline16&apos;</span>
        <span class="hljs-keyword">else</span>:
            interpolation = <span class="hljs-string">&apos;nearest&apos;</span>

        <span class="hljs-comment"># Plot image.</span>
        ax.imshow(images[i, :, :, :],
                  interpolation=interpolation)

        <span class="hljs-comment"># Name of the true class.</span>
        cls_true_name = class_names[cls_true[i]]

        <span class="hljs-comment"># Show true and predicted classes.</span>
        <span class="hljs-keyword">if</span> cls_pred <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
            xlabel = <span class="hljs-string">&quot;True: {0}&quot;</span>.format(cls_true_name)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># Name of the predicted class.</span>
            cls_pred_name = class_names[cls_pred[i]]

            xlabel = <span class="hljs-string">&quot;True: {0}\nPred: {1}&quot;</span>.format(cls_true_name, cls_pred_name)

        <span class="hljs-comment"># Show the classes as the label on the x-axis.</span>
        ax.set_xlabel(xlabel)

        <span class="hljs-comment"># Remove ticks from the plot.</span>
        ax.set_xticks([])
        ax.set_yticks([])

    <span class="hljs-comment"># Ensure the plot is shown correctly with multiple plots</span>
    <span class="hljs-comment"># in a single Notebook cell.</span>
    plt.show()
</code></pre>
<h3 id="&#x7ED8;&#x5236;&#x51E0;&#x5F20;&#x56FE;&#x50CF;&#x6765;&#x770B;&#x770B;&#x6570;&#x636E;&#x662F;&#x5426;&#x6B63;&#x786E;">&#x7ED8;&#x5236;&#x51E0;&#x5F20;&#x56FE;&#x50CF;&#x6765;&#x770B;&#x770B;&#x6570;&#x636E;&#x662F;&#x5426;&#x6B63;&#x786E;</h3>
<pre><code class="lang-python"><span class="hljs-comment"># Get the first images from the test-set.</span>
images = images_test[<span class="hljs-number">0</span>:<span class="hljs-number">9</span>]

<span class="hljs-comment"># Get the true classes for those images.</span>
cls_true = cls_test[<span class="hljs-number">0</span>:<span class="hljs-number">9</span>]

<span class="hljs-comment"># Plot the images and labels using our helper-function above.</span>
plot_images(images=images, cls_true=cls_true, smooth=<span class="hljs-keyword">False</span>)
</code></pre>
<p><img src="output_34_0.png" alt="png"></p>
<p>&#x4E0A;&#x9762;&#x50CF;&#x7D20;&#x5316;&#x7684;&#x56FE;&#x50CF;&#x662F;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x8F93;&#x5165;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5BF9;&#x56FE;&#x50CF;&#x8FDB;&#x884C;&#x5E73;&#x6ED1;&#x5904;&#x7406;&#xFF0C;&#x53EF;&#x80FD;&#x66F4;&#x6613;&#x4E8E;&#x4EBA;&#x773C;&#x8BC6;&#x522B;&#x3002;</p>
<pre><code class="lang-python">plot_images(images=images, cls_true=cls_true, smooth=<span class="hljs-keyword">True</span>)
</code></pre>
<p><img src="output_36_0.png" alt="png"></p>
<h2 id="tensorflow&#x56FE;">TensorFlow&#x56FE;</h2>
<p>TensorFlow&#x7684;&#x5168;&#x90E8;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x79F0;&#x4E4B;&#x4E3A;&#x8BA1;&#x7B97;&#x56FE;&#xFF08;computational graph&#xFF09;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5B83;&#x4F1A;&#x6BD4;&#x76F4;&#x63A5;&#x5728;Python&#x4E2D;&#x8FDB;&#x884C;&#x76F8;&#x540C;&#x8BA1;&#x7B97;&#x91CF;&#x8981;&#x9AD8;&#x6548;&#x5F97;&#x591A;&#x3002;TensorFlow&#x6BD4;Numpy&#x66F4;&#x9AD8;&#x6548;&#xFF0C;&#x56E0;&#x4E3A;TensorFlow&#x4E86;&#x89E3;&#x6574;&#x4E2A;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x7684;&#x8BA1;&#x7B97;&#x56FE;&#xFF0C;&#x7136;&#x800C;Numpy&#x53EA;&#x77E5;&#x9053;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x4E0A;&#x552F;&#x4E00;&#x7684;&#x6570;&#x5B66;&#x8FD0;&#x7B97;&#x3002;</p>
<p>TensorFlow&#x4E5F;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x5730;&#x8BA1;&#x7B97;&#x9700;&#x8981;&#x4F18;&#x5316;&#x7684;&#x53D8;&#x91CF;&#x7684;&#x68AF;&#x5EA6;&#xFF0C;&#x4F7F;&#x5F97;&#x6A21;&#x578B;&#x6709;&#x66F4;&#x597D;&#x7684;&#x8868;&#x73B0;&#x3002;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x56FE;&#x662F;&#x7B80;&#x5355;&#x6570;&#x5B66;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7ED3;&#x5408;&#xFF0C;&#x56E0;&#x6B64;&#x6574;&#x4E2A;&#x56FE;&#x7684;&#x68AF;&#x5EA6;&#x53EF;&#x4EE5;&#x7528;&#x94FE;&#x5F0F;&#x6CD5;&#x5219;&#x63A8;&#x5BFC;&#x51FA;&#x6765;&#x3002;</p>
<p>TensorFlow&#x8FD8;&#x80FD;&#x5229;&#x7528;&#x591A;&#x6838;CPU&#x548C;GPU&#xFF0C;Google&#x4E5F;&#x4E3A;TensorFlow&#x5236;&#x9020;&#x4E86;&#x79F0;&#x4E3A;TPUs&#xFF08;Tensor Processing Units&#xFF09;&#x7684;&#x7279;&#x6B8A;&#x82AF;&#x7247;&#xFF0C;&#x5B83;&#x6BD4;GPU&#x66F4;&#x5FEB;&#x3002;</p>
<p>&#x4E00;&#x4E2A;TensorFlow&#x56FE;&#x7531;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#xFF1A;</p>
<ul>
<li>&#x5360;&#x4F4D;&#x7B26;&#x53D8;&#x91CF;&#xFF08;Placeholder&#xFF09;&#x7528;&#x6765;&#x6539;&#x53D8;&#x56FE;&#x7684;&#x8F93;&#x5165;&#x3002;</li>
<li>&#x6A21;&#x578B;&#x53D8;&#x91CF;&#xFF08;Model&#xFF09;&#x5C06;&#x4F1A;&#x88AB;&#x4F18;&#x5316;&#xFF0C;&#x4F7F;&#x5F97;&#x6A21;&#x578B;&#x8868;&#x73B0;&#x5F97;&#x66F4;&#x597D;&#x3002;</li>
<li>&#x6A21;&#x578B;&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E9B;&#x6570;&#x5B66;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x6839;&#x636E;Placeholder&#x548C;&#x6A21;&#x578B;&#x7684;&#x8F93;&#x5165;&#x53D8;&#x91CF;&#x6765;&#x8BA1;&#x7B97;&#x4E00;&#x4E9B;&#x8F93;&#x51FA;&#x3002;</li>
<li>&#x4E00;&#x4E2A;cost&#x5EA6;&#x91CF;&#x7528;&#x6765;&#x6307;&#x5BFC;&#x53D8;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x4F18;&#x5316;&#x7B56;&#x7565;&#x4F1A;&#x66F4;&#x65B0;&#x6A21;&#x578B;&#x7684;&#x53D8;&#x91CF;&#x3002;</li>
</ul>
<p>&#x53E6;&#x5916;&#xFF0C;TensorFlow&#x56FE;&#x4E5F;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E9B;&#x8C03;&#x8BD5;&#x72B6;&#x6001;&#xFF0C;&#x6BD4;&#x5982;&#x7528;TensorBoard&#x6253;&#x5370;log&#x6570;&#x636E;&#xFF0C;&#x672C;&#x6559;&#x7A0B;&#x4E0D;&#x6D89;&#x53CA;&#x8FD9;&#x4E9B;&#x3002;</p>
<h3 id="&#x5360;&#x4F4D;&#x7B26;-&#xFF08;placeholder&#xFF09;&#x53D8;&#x91CF;">&#x5360;&#x4F4D;&#x7B26; &#xFF08;Placeholder&#xFF09;&#x53D8;&#x91CF;</h3>
<p>Placeholder&#x662F;&#x4F5C;&#x4E3A;&#x56FE;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x8FD0;&#x884C;&#x56FE;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x53EF;&#x80FD;&#x6539;&#x53D8;&#x5B83;&#x4EEC;&#x3002;&#x5C06;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x79F0;&#x4E3A;feeding placeholder&#x53D8;&#x91CF;&#xFF0C;&#x540E;&#x9762;&#x5C06;&#x4F1A;&#x63CF;&#x8FF0;&#x8FD9;&#x4E2A;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4E3A;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x5B9A;&#x4E49;placeholder&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x8BA9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x8F93;&#x5165;&#x5230;TensorFlow&#x56FE;&#x4E2D;&#x7684;&#x56FE;&#x50CF;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5F20;&#x91CF;&#xFF08;tensor&#xFF09;&#xFF0C;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x591A;&#x7EF4;&#x5411;&#x91CF;&#x6216;&#x77E9;&#x9635;&#x3002;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8BBE;&#x7F6E;&#x4E3A;float32&#xFF0C;&#x5F62;&#x72B6;&#x8BBE;&#x4E3A;<code>[None, img_size, img_size, num_channels]</code>&#x4EE3;&#x8868;tensor&#x53EF;&#x80FD;&#x4FDD;&#x5B58;&#x7740;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;&#x56FE;&#x50CF;&#xFF0C;&#x6BCF;&#x5F20;&#x56FE;&#x50CF;&#x5BBD;&#x9AD8;&#x90FD;&#x4E3A;<code>img_size</code>&#xFF0C;&#x6709;<code>num_channels</code>&#x4E2A;&#x989C;&#x8272;&#x901A;&#x9053;&#x3002;</p>
<pre><code class="lang-python">x = tf.placeholder(tf.float32, shape=[<span class="hljs-keyword">None</span>, img_size, img_size, num_channels], name=<span class="hljs-string">&apos;x&apos;</span>)
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4E3A;&#x8F93;&#x5165;&#x53D8;&#x91CF;<code>x</code>&#x4E2D;&#x7684;&#x56FE;&#x50CF;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x771F;&#x5B9E;&#x6807;&#x7B7E;&#x5B9A;&#x4E49;placeholder&#x53D8;&#x91CF;&#x3002;&#x53D8;&#x91CF;&#x7684;&#x5F62;&#x72B6;&#x662F;<code>[None, num_classes]</code>&#xFF0C;&#x8FD9;&#x4EE3;&#x8868;&#x7740;&#x5B83;&#x4FDD;&#x5B58;&#x4E86;&#x4EFB;&#x610F;&#x6570;&#x91CF;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x6BCF;&#x4E2A;&#x6807;&#x7B7E;&#x662F;&#x957F;&#x5EA6;&#x4E3A;<code>num_classes</code>&#x7684;&#x5411;&#x91CF;&#xFF0C;&#x672C;&#x4F8B;&#x4E2D;&#x957F;&#x5EA6;&#x4E3A;10&#x3002;</p>
<pre><code class="lang-python">y_true = tf.placeholder(tf.float32, shape=[<span class="hljs-keyword">None</span>, num_classes], name=<span class="hljs-string">&apos;y_true&apos;</span>)
</code></pre>
<p>&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;class-number&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;placeholder&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x7528;argmax&#x6765;&#x8BA1;&#x7B97;&#x5B83;&#x3002;&#x8FD9;&#x91CC;&#x53EA;&#x662F;TensorFlow&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#xFF0C;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x4EC0;&#x4E48;&#x8FD0;&#x7B97;&#x3002;</p>
<pre><code class="lang-python">y_true_cls = tf.argmax(y_true, dimension=<span class="hljs-number">1</span>)
</code></pre>
<h3 id="&#x9884;&#x5904;&#x7406;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x9884;&#x5904;&#x7406;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x4E0B;&#x9762;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x4E86;&#x7528;&#x6765;&#x9884;&#x5904;&#x7406;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;TensorFlow&#x8BA1;&#x7B97;&#x56FE;&#x3002;&#x8FD9;&#x91CC;&#x5E76;&#x672A;&#x6267;&#x884C;&#x8BA1;&#x7B97;&#xFF0C;&#x51FD;&#x6570;&#x53EA;&#x662F;&#x7ED9;TensorFlow&#x8BA1;&#x7B97;&#x56FE;&#x6DFB;&#x52A0;&#x4E86;&#x8282;&#x70B9;&#x3002;</p>
<p>&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5728;&#x8BAD;&#x7EC3;&#x548C;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x7684;&#x9884;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x4E0D;&#x540C;&#xFF1A;</p>
<ul>
<li><p>&#x5BF9;&#x4E8E;&#x8BAD;&#x7EC3;&#x6765;&#x8BF4;&#xFF0C;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x662F;&#x968F;&#x673A;&#x88C1;&#x526A;&#x3001;&#x6C34;&#x5E73;&#x7FFB;&#x8F6C;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x7528;&#x968F;&#x673A;&#x503C;&#x6765;&#x8C03;&#x6574;&#x8272;&#x8C03;&#x3001;&#x5BF9;&#x6BD4;&#x5EA6;&#x548C;&#x9971;&#x548C;&#x5EA6;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x521B;&#x5EFA;&#x4E86;&#x539F;&#x59CB;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x968F;&#x673A;&#x53D8;&#x4F53;&#xFF0C;&#x4EBA;&#x4E3A;&#x5730;&#x6269;&#x5145;&#x4E86;&#x8BAD;&#x7EC3;&#x96C6;&#x3002;&#x540E;&#x9762;&#x4F1A;&#x663E;&#x793A;&#x4E00;&#x4E9B;&#x626D;&#x66F2;&#x8FC7;&#x7684;&#x56FE;&#x50CF;&#x6837;&#x672C;&#x3002;</p>
</li>
<li><p>&#x5BF9;&#x4E8E;&#x6D4B;&#x8BD5;&#xFF0C;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x6839;&#x636E;&#x4E2D;&#x5FC3;&#x88C1;&#x526A;&#xFF0C;&#x5176;&#x4ED6;&#x4E0D;&#x4F5C;&#x8C03;&#x6574;&#x3002;</p>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pre_process_image</span><span class="hljs-params">(image, training)</span>:</span>
    <span class="hljs-comment"># This function takes a single image as input,</span>
    <span class="hljs-comment"># and a boolean whether to build the training or testing graph.</span>

    <span class="hljs-keyword">if</span> training:
        <span class="hljs-comment"># For training, add the following to the TensorFlow graph.</span>

        <span class="hljs-comment"># Randomly crop the input image.</span>
        image = tf.random_crop(image, size=[img_size_cropped, img_size_cropped, num_channels])

        <span class="hljs-comment"># Randomly flip the image horizontally.</span>
        image = tf.image.random_flip_left_right(image)

        <span class="hljs-comment"># Randomly adjust hue, contrast and saturation.</span>
        image = tf.image.random_hue(image, max_delta=<span class="hljs-number">0.05</span>)
        image = tf.image.random_contrast(image, lower=<span class="hljs-number">0.3</span>, upper=<span class="hljs-number">1.0</span>)
        image = tf.image.random_brightness(image, max_delta=<span class="hljs-number">0.2</span>)
        image = tf.image.random_saturation(image, lower=<span class="hljs-number">0.0</span>, upper=<span class="hljs-number">2.0</span>)

        <span class="hljs-comment"># Some of these functions may overflow and result in pixel</span>
        <span class="hljs-comment"># values beyond the [0, 1] range. It is unclear from the</span>
        <span class="hljs-comment"># documentation of TensorFlow 0.10.0rc0 whether this is</span>
        <span class="hljs-comment"># intended. A simple solution is to limit the range.</span>

        <span class="hljs-comment"># Limit the image pixels between [0, 1] in case of overflow.</span>
        image = tf.minimum(image, <span class="hljs-number">1.0</span>)
        image = tf.maximum(image, <span class="hljs-number">0.0</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># For training, add the following to the TensorFlow graph.</span>

        <span class="hljs-comment"># Crop the input image around the centre so it is the same</span>
        <span class="hljs-comment"># size as images that are randomly cropped during training.</span>
        image = tf.image.resize_image_with_crop_or_pad(image,
                                                       target_height=img_size_cropped,
                                                       target_width=img_size_cropped)

    <span class="hljs-keyword">return</span> image
</code></pre>
<p>&#x4E0B;&#x9762;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x8F93;&#x5165;batch&#x4E2D;&#x6BCF;&#x5F20;&#x56FE;&#x50CF;&#x90FD;&#x8C03;&#x7528;&#x4EE5;&#x4E0A;&#x51FD;&#x6570;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pre_process</span><span class="hljs-params">(images, training)</span>:</span>
    <span class="hljs-comment"># Use TensorFlow to loop over all the input images and call</span>
    <span class="hljs-comment"># the function above which takes a single image as input.</span>
    images = tf.map_fn(<span class="hljs-keyword">lambda</span> image: pre_process_image(image, training), images)

    <span class="hljs-keyword">return</span> images
</code></pre>
<p>&#x4E3A;&#x4E86;&#x7ED8;&#x5236;&#x626D;&#x66F2;&#x8FC7;&#x7684;&#x56FE;&#x50CF;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;TensorFlow&#x521B;&#x5EFA;&#x9884;&#x5904;&#x7406;graph&#xFF0C;&#x540E;&#x9762;&#x5C06;&#x4F1A;&#x8FD0;&#x884C;&#x5B83;&#x3002;</p>
<pre><code class="lang-python">distorted_images = pre_process(images=x, training=<span class="hljs-keyword">True</span>)
</code></pre>
<h3 id="&#x521B;&#x5EFA;&#x4E3B;&#x8981;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x521B;&#x5EFA;&#x4E3B;&#x8981;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x4E0B;&#x9762;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x4E86;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x4E3B;&#x8981;&#x90E8;&#x5206;&#x3002;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x6559;&#x7A0B;&#x63CF;&#x8FF0;&#x8FC7;&#x7684;Pretty Tensor&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main_network</span><span class="hljs-params">(images, training)</span>:</span>
    <span class="hljs-comment"># Wrap the input images as a Pretty Tensor object.</span>
    x_pretty = pt.wrap(images)

    <span class="hljs-comment"># Pretty Tensor uses special numbers to distinguish between</span>
    <span class="hljs-comment"># the training and testing phases.</span>
    <span class="hljs-keyword">if</span> training:
        phase = pt.Phase.train
    <span class="hljs-keyword">else</span>:
        phase = pt.Phase.infer

    <span class="hljs-comment"># Create the convolutional neural network using Pretty Tensor.</span>
    <span class="hljs-comment"># It is very similar to the previous tutorials, except</span>
    <span class="hljs-comment"># the use of so-called batch-normalization in the first layer.</span>
    <span class="hljs-keyword">with</span> pt.defaults_scope(activation_fn=tf.nn.relu, phase=phase):
        y_pred, loss = x_pretty.\
            conv2d(kernel=<span class="hljs-number">5</span>, depth=<span class="hljs-number">64</span>, name=<span class="hljs-string">&apos;layer_conv1&apos;</span>, batch_normalize=<span class="hljs-keyword">True</span>).\
            max_pool(kernel=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>).\
            conv2d(kernel=<span class="hljs-number">5</span>, depth=<span class="hljs-number">64</span>, name=<span class="hljs-string">&apos;layer_conv2&apos;</span>).\
            max_pool(kernel=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>).\
            flatten().\
            fully_connected(size=<span class="hljs-number">256</span>, name=<span class="hljs-string">&apos;layer_fc1&apos;</span>).\
            fully_connected(size=<span class="hljs-number">128</span>, name=<span class="hljs-string">&apos;layer_fc2&apos;</span>).\
            softmax_classifier(num_classes=num_classes, labels=y_true)

    <span class="hljs-keyword">return</span> y_pred, loss
</code></pre>
<h3 id="&#x521B;&#x5EFA;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x521B;&#x5EFA;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x4E0B;&#x9762;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x521B;&#x5EFA;&#x4E86;&#x6574;&#x4E2A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x5305;&#x542B;&#x4E0A;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x9884;&#x5904;&#x7406;&#x4EE5;&#x53CA;&#x4E3B;&#x8981;&#x5904;&#x7406;&#x6A21;&#x5757;&#x3002;</p>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x88AB;&#x7F16;&#x7801;&#x5230;&apos;network&apos;&#x53D8;&#x91CF;&#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x5728;TensorFlow&#x56FE;&#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x4E24;&#x4E2A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x50CF;&#x8FD9;&#x6837;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E24;&#x4E2A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4E2D;&#x590D;&#x7528;&#x53D8;&#x91CF;&#xFF0C;&#x56E0;&#x6B64;&#x8BAD;&#x7EC3;&#x7F51;&#x7EDC;&#x4F18;&#x5316;&#x8FC7;&#x7684;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x5728;&#x6D4B;&#x8BD5;&#x7F51;&#x7EDC;&#x4E2D;&#x590D;&#x7528;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_network</span><span class="hljs-params">(training)</span>:</span>
    <span class="hljs-comment"># Wrap the neural network in the scope named &apos;network&apos;.</span>
    <span class="hljs-comment"># Create new variables during training, and re-use during testing.</span>
    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&apos;network&apos;</span>, reuse=<span class="hljs-keyword">not</span> training):
        <span class="hljs-comment"># Just rename the input placeholder variable for convenience.</span>
        images = x

        <span class="hljs-comment"># Create TensorFlow graph for pre-processing.</span>
        images = pre_process(images=images, training=training)

        <span class="hljs-comment"># Create TensorFlow graph for the main processing.</span>
        y_pred, loss = main_network(images=images, training=training)

    <span class="hljs-keyword">return</span> y_pred, loss
</code></pre>
<h3 id="&#x4E3A;&#x8BAD;&#x7EC3;&#x9636;&#x6BB5;&#x521B;&#x5EFA;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;">&#x4E3A;&#x8BAD;&#x7EC3;&#x9636;&#x6BB5;&#x521B;&#x5EFA;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;</h3>
<p>&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x4F18;&#x5316;&#x8FED;&#x4EE3;&#x6B21;&#x6570;&#x7684;TensorFlow&#x53D8;&#x91CF;&#x3002;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x6559;&#x7A0B;&#x4E2D;&#xFF0C;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;Python&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x672C;&#x6559;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x7528;checkpoints&#x4E2D;&#x7684;&#x5176;&#x4ED6;TensorFlow&#x53D8;&#x91CF;&#x6765;&#x4FDD;&#x5B58;&#x3002;</p>
<p><code>trainable=False</code>&#x8868;&#x793A;TensorFlow&#x4E0D;&#x4F1A;&#x4F18;&#x5316;&#x6B64;&#x53D8;&#x91CF;&#x3002;</p>
<pre><code class="lang-python">global_step = tf.Variable(initial_value=<span class="hljs-number">0</span>,
                          name=<span class="hljs-string">&apos;global_step&apos;</span>, trainable=<span class="hljs-keyword">False</span>)
</code></pre>
<p>&#x521B;&#x5EFA;&#x8BAD;&#x7EC3;&#x7528;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x51FD;&#x6570; <code>create_network()</code>&#x8FD4;&#x56DE;<code>y_pred</code>&#x548C;<code>loss</code>&#xFF0C;&#x4F46;&#x5728;&#x8BAD;&#x7EC3;&#x65F6;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x7528;&#x5230;<code>loss</code>&#x51FD;&#x6570;&#x3002;</p>
<pre><code class="lang-python">_, loss = create_network(training=<span class="hljs-keyword">True</span>)
</code></pre>
<p>&#x521B;&#x5EFA;&#x6700;&#x5C0F;&#x5316;<code>loss</code>&#x51FD;&#x6570;&#x7684;&#x4F18;&#x5316;&#x5668;&#x3002;&#x540C;&#x65F6;&#x5C06;<code>global_step</code>&#x4F20;&#x7ED9;&#x4F18;&#x5316;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x5B83;&#x90FD;&#x51CF;&#x4E00;&#x3002;</p>
<pre><code class="lang-python">optimizer = tf.train.AdamOptimizer(learning_rate=<span class="hljs-number">1e-4</span>).minimize(loss, global_step=global_step)
</code></pre>
<h3 id="&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;">&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;</h3>
<p>&#x73B0;&#x5728;&#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x9636;&#x6BB5;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002; &#x540C;&#x6837;&#x7684;&#xFF0C;<code>create_network()</code> &#x8FD4;&#x56DE;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x9884;&#x6D4B;&#x6807;&#x7B7E; <code>y_pred</code>&#xFF0C;&#x4F18;&#x5316;&#x8FC7;&#x7A0B;&#x4E5F;&#x7528;&#x5230; <code>loss</code>&#x51FD;&#x6570;&#x3002;&#x6D4B;&#x8BD5;&#x65F6;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;<code>y_pred</code>&#x3002;</p>
<pre><code class="lang-python">y_pred, _ = create_network(training=<span class="hljs-keyword">False</span>)
</code></pre>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x8BA1;&#x7B97;&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#x53F7;&#x7684;&#x6574;&#x5F62;&#x6570;&#x5B57;&#x3002;&#x7F51;&#x7EDC;&#x7684;&#x8F93;&#x51FA;<code>y_pred</code>&#x662F;&#x4E00;&#x4E2A;10&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x6570;&#x7EC4;&#x3002;&#x7C7B;&#x522B;&#x53F7;&#x662F;&#x6570;&#x7EC4;&#x4E2D;&#x6700;&#x5927;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#x3002;</p>
<pre><code class="lang-python">y_pred_cls = tf.argmax(y_pred, dimension=<span class="hljs-number">1</span>)
</code></pre>
<p>&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x5411;&#x91CF;&#xFF0C;&#x7528;&#x6765;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x6BCF;&#x5F20;&#x56FE;&#x7247;&#x7684;&#x771F;&#x5B9E;&#x7C7B;&#x522B;&#x662F;&#x5426;&#x4E0E;&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#x76F8;&#x540C;&#x3002;</p>
<pre><code class="lang-python">correct_prediction = tf.equal(y_pred_cls, y_true_cls)
</code></pre>
<p>&#x4E0A;&#x9762;&#x7684;&#x8BA1;&#x7B97;&#x5148;&#x5C06;&#x5E03;&#x5C14;&#x503C;&#x5411;&#x91CF;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x6210;&#x6D6E;&#x70B9;&#x578B;&#x5411;&#x91CF;&#xFF0C;&#x8FD9;&#x6837;&#x5B50;False&#x5C31;&#x53D8;&#x6210;0&#xFF0C;True&#x53D8;&#x6210;1&#xFF0C;&#x7136;&#x540E;&#x8BA1;&#x7B97;&#x8FD9;&#x4E9B;&#x503C;&#x7684;&#x5E73;&#x5747;&#x6570;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x7684;&#x51C6;&#x786E;&#x7387;&#x3002;</p>
<pre><code class="lang-python">accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))
</code></pre>
<h3 id="saver">Saver</h3>
<p>&#x4E3A;&#x4E86;&#x4FDD;&#x5B58;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x53D8;&#x91CF;&#xFF08;&#x8FD9;&#x6837;&#x4E0D;&#x5FC5;&#x518D;&#x6B21;&#x8BAD;&#x7EC3;&#x7F51;&#x7EDC;&#x5C31;&#x80FD;&#x91CD;&#x8F7D;&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;Saver-object&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x53CA;&#x6062;&#x590D;TensorFlow&#x56FE;&#x7684;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x5E76;&#x672A;&#x4FDD;&#x5B58;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#xFF08;&#x4FDD;&#x5B58;&#x64CD;&#x4F5C;&#xFF09;&#x5728;&#x540E;&#x9762;&#x7684;<code>optimize()</code>&#x51FD;&#x6570;&#x4E2D;&#x5B8C;&#x6210;&#x3002;</p>
<pre><code class="lang-python">saver = tf.train.Saver()
</code></pre>
<h3 id="&#x83B7;&#x53D6;&#x6743;&#x91CD;">&#x83B7;&#x53D6;&#x6743;&#x91CD;</h3>
<p>&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x7ED8;&#x5236;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x6743;&#x91CD;&#x3002;&#x5F53;&#x4F7F;&#x7528;Pretty Tensor&#x6765;&#x521B;&#x5EFA;&#x7F51;&#x7EDC;&#x65F6;&#xFF0C;&#x5C42;&#x7684;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x90FD;&#x662F;&#x7531;Pretty Tensoe&#x95F4;&#x63A5;&#x521B;&#x5EFA;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8981;&#x4ECE;TensorFlow&#x4E2D;&#x83B7;&#x53D6;&#x53D8;&#x91CF;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7528;<code>layer_conv1</code> &#x548C; <code>layer_conv2</code>&#x4EE3;&#x8868;&#x4E24;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x3002;&#x8FD9;&#x4E5F;&#x53EB;&#x53D8;&#x91CF;&#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x4E0D;&#x8981;&#x4E0E;&#x4E0A;&#x9762;&#x63CF;&#x8FF0;&#x7684;<code>defaults_scope</code>&#x6DF7;&#x6DC6;&#x4E86;&#xFF09;&#x3002;PrettyTensor&#x4F1A;&#x81EA;&#x52A8;&#x7ED9;&#x5B83;&#x4E3A;&#x6BCF;&#x4E2A;&#x5C42;&#x521B;&#x5EFA;&#x7684;&#x53D8;&#x91CF;&#x547D;&#x540D;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C42;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x540D;&#x79F0;&#x548C;&#x53D8;&#x91CF;&#x540D;&#x6765;&#x53D6;&#x5F97;&#x67D0;&#x4E00;&#x5C42;&#x7684;&#x6743;&#x91CD;&#x3002;</p>
<p>&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x6709;&#x70B9;&#x7B28;&#x62D9;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x4E0D;&#x5F97;&#x4E0D;&#x7528;TensorFlow&#x51FD;&#x6570;<code>get_variable()</code>&#xFF0C;&#x5B83;&#x662F;&#x8BBE;&#x8BA1;&#x7ED9;&#x5176;&#x4ED6;&#x7528;&#x9014;&#x7684;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x53D8;&#x91CF;&#x6216;&#x91CD;&#x7528;&#x73B0;&#x6709;&#x53D8;&#x91CF;&#x3002;&#x521B;&#x5EFA;&#x4E0B;&#x9762;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x5F88;&#x7B80;&#x5355;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_weights_variable</span><span class="hljs-params">(layer_name)</span>:</span>
    <span class="hljs-comment"># Retrieve an existing variable named &apos;weights&apos; in the scope</span>
    <span class="hljs-comment"># with the given layer_name.</span>
    <span class="hljs-comment"># This is awkward because the TensorFlow function was</span>
    <span class="hljs-comment"># really intended for another purpose.</span>

    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;network/&quot;</span> + layer_name, reuse=<span class="hljs-keyword">True</span>):
        variable = tf.get_variable(<span class="hljs-string">&apos;weights&apos;</span>)

    <span class="hljs-keyword">return</span> variable
</code></pre>
<p>&#x501F;&#x52A9;&#x8FD9;&#x4E2A;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x4E9B;&#x662F;TensorFlow&#x7684;objects&#x3002;&#x4F60;&#x9700;&#x8981;&#x7C7B;&#x4F3C;&#x7684;&#x64CD;&#x4F5C;&#x6765;&#x83B7;&#x53D6;&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5BB9;&#xFF1A; <code>contents = session.run(weights_conv1)</code> &#xFF0C;&#x4E0B;&#x9762;&#x4F1A;&#x63D0;&#x5230;&#x8FD9;&#x4E2A;&#x3002;</p>
<pre><code class="lang-python">weights_conv1 = get_weights_variable(layer_name=<span class="hljs-string">&apos;layer_conv1&apos;</span>)
weights_conv2 = get_weights_variable(layer_name=<span class="hljs-string">&apos;layer_conv2&apos;</span>)
</code></pre>
<h3 id="&#x83B7;&#x53D6;layer&#x7684;&#x8F93;&#x51FA;">&#x83B7;&#x53D6;layer&#x7684;&#x8F93;&#x51FA;</h3>
<p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0E;&#x4E0A;&#x9762;&#x83B7;&#x53D6;&#x6743;&#x91CD;&#x7684;&#x51FD;&#x6570;&#x6709;&#x6240;&#x4E0D;&#x540C;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x627E;&#x56DE;&#x5377;&#x79EF;&#x5C42;&#x8F93;&#x51FA;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5F20;&#x91CF;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_layer_output</span><span class="hljs-params">(layer_name)</span>:</span>
    <span class="hljs-comment"># The name of the last operation of the convolutional layer.</span>
    <span class="hljs-comment"># This assumes you are using Relu as the activation-function.</span>
    tensor_name = <span class="hljs-string">&quot;network/&quot;</span> + layer_name + <span class="hljs-string">&quot;/Relu:0&quot;</span>

    <span class="hljs-comment"># Get the tensor with this name.</span>
    tensor = tf.get_default_graph().get_tensor_by_name(tensor_name)

    <span class="hljs-keyword">return</span> tensor
</code></pre>
<p>&#x53D6;&#x5F97;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;&#x4EE5;&#x4FBF;&#x4E4B;&#x540E;&#x7ED8;&#x5236;&#x3002;</p>
<pre><code class="lang-python">output_conv1 = get_layer_output(layer_name=<span class="hljs-string">&apos;layer_conv1&apos;</span>)
output_conv2 = get_layer_output(layer_name=<span class="hljs-string">&apos;layer_conv2&apos;</span>)
</code></pre>
<h2 id="&#x8FD0;&#x884C;tensorflow">&#x8FD0;&#x884C;TensorFlow</h2>
<h3 id="&#x521B;&#x5EFA;tensorflow&#x4F1A;&#x8BDD;&#xFF08;session&#xFF09;">&#x521B;&#x5EFA;TensorFlow&#x4F1A;&#x8BDD;&#xFF08;session&#xFF09;</h3>
<p>&#x4E00;&#x65E6;&#x521B;&#x5EFA;&#x4E86;TensorFlow&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;TensorFlow&#x4F1A;&#x8BDD;&#xFF0C;&#x7528;&#x6765;&#x8FD0;&#x884C;&#x56FE;&#x3002;</p>
<pre><code class="lang-python">session = tf.Session()
</code></pre>
<h3 id="&#x521D;&#x59CB;&#x5316;&#x6216;&#x6062;&#x590D;&#x53D8;&#x91CF;">&#x521D;&#x59CB;&#x5316;&#x6216;&#x6062;&#x590D;&#x53D8;&#x91CF;</h3>
<p>&#x8BAD;&#x7EC3;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x4F1A;&#x82B1;&#x4E0A;&#x5F88;&#x957F;&#x65F6;&#x95F4;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5F53;&#x4F60;&#x6CA1;&#x6709;GPU&#x7684;&#x65F6;&#x5019;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x5728;&#x8BAD;&#x7EC3;&#x65F6;&#x4FDD;&#x5B58;checkpoints&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x5728;&#x5176;&#x4ED6;&#x65F6;&#x95F4;&#x7EE7;&#x7EED;&#x8BAD;&#x7EC3;&#xFF08;&#x6BD4;&#x5982;&#x665A;&#x4E0A;&#xFF09;&#xFF0C;&#x4EE5;&#x540E;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x8BAD;&#x7EC3;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5C31;&#x7528;&#x8FD9;&#x4E9B;&#x6765;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x91CD;&#x65B0;&#x8BAD;&#x7EC3;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5148;&#x5220;&#x6389;&#x8FD9;&#x4E9B;checkpoints&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x7528;&#x6765;&#x4FDD;&#x5B58;checkpoints&#x7684;&#x6587;&#x4EF6;&#x5939;&#x3002;</p>
<pre><code class="lang-python">save_dir = <span class="hljs-string">&apos;checkpoints/&apos;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5939;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x521B;&#x5EFA;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(save_dir):
    os.makedirs(save_dir)
</code></pre>
<p>&#x8FD9;&#x662F;checkpoints&#x7684;&#x57FA;&#x672C;&#x6587;&#x4EF6;&#x540D;&#xFF0C;TensorFlow&#x4F1A;&#x5728;&#x540E;&#x9762;&#x6DFB;&#x52A0;&#x8FED;&#x4EE3;&#x6B21;&#x6570;&#x7B49;&#x3002;</p>
<pre><code class="lang-python">save_path = os.path.join(save_dir, <span class="hljs-string">&apos;cifar10_cnn&apos;</span>)
</code></pre>
<p>&#x8BD5;&#x7740;&#x8F7D;&#x5165;&#x6700;&#x65B0;&#x7684;checkpoint&#x3002;&#x5982;&#x679C;checkpoint&#x4E0D;&#x5B58;&#x5728;&#x6216;&#x6539;&#x53D8;&#x4E86;TensorFlow&#x56FE;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5931;&#x8D25;&#x5E76;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">try</span>:
    print(<span class="hljs-string">&quot;Trying to restore last checkpoint ...&quot;</span>)

    <span class="hljs-comment"># Use TensorFlow to find the latest checkpoint - if any.</span>
    last_chk_path = tf.train.latest_checkpoint(checkpoint_dir=save_dir)

    <span class="hljs-comment"># Try and load the data in the checkpoint.</span>
    saver.restore(session, save_path=last_chk_path)

    <span class="hljs-comment"># If we get to this point, the checkpoint was successfully loaded.</span>
    print(<span class="hljs-string">&quot;Restored checkpoint from:&quot;</span>, last_chk_path)
<span class="hljs-keyword">except</span>:
    <span class="hljs-comment"># If the above failed for some reason, simply</span>
    <span class="hljs-comment"># initialize all the variables for the TensorFlow graph.</span>
    print(<span class="hljs-string">&quot;Failed to restore checkpoint. Initializing variables instead.&quot;</span>)
    session.run(tf.global_variables_initializer())
</code></pre>
<pre><code>Trying to restore last checkpoint ...
Restored checkpoint from: checkpoints/cifar10_cnn-150000
</code></pre><h3 id="&#x521B;&#x5EFA;&#x968F;&#x673A;&#x8BAD;&#x7EC3;batch&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x521B;&#x5EFA;&#x968F;&#x673A;&#x8BAD;&#x7EC3;batch&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x5728;&#x8BAD;&#x7EC3;&#x96C6;&#x4E2D;&#x6709;50,000&#x5F20;&#x56FE;&#x3002;&#x7528;&#x8FD9;&#x4E9B;&#x56FE;&#x50CF;&#x8BA1;&#x7B97;&#x6A21;&#x578B;&#x7684;&#x68AF;&#x5EA6;&#x4F1A;&#x82B1;&#x5F88;&#x591A;&#x65F6;&#x95F4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x4F18;&#x5316;&#x5668;&#x7684;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x91CC;&#x53EA;&#x7528;&#x5230;&#x4E86;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x7684;&#x56FE;&#x50CF;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5185;&#x5B58;&#x8017;&#x5C3D;&#x5BFC;&#x81F4;&#x7535;&#x8111;&#x6B7B;&#x673A;&#x6216;&#x53D8;&#x5F97;&#x5F88;&#x6162;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x8BD5;&#x7740;&#x51CF;&#x5C11;&#x8FD9;&#x4E9B;&#x6570;&#x91CF;&#xFF0C;&#x4F46;&#x540C;&#x65F6;&#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x66F4;&#x4F18;&#x5316;&#x7684;&#x8FED;&#x4EE3;&#x3002;</p>
<pre><code class="lang-python">train_batch_size = <span class="hljs-number">64</span>
</code></pre>
<p>&#x51FD;&#x6570;&#x4ECE;&#x8BAD;&#x7EC3;&#x96C6;&#x4E2D;&#x6311;&#x9009;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x7684;training-batch&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_batch</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-comment"># Number of images in the training-set.</span>
    num_images = len(images_train)

    <span class="hljs-comment"># Create a random index.</span>
    idx = np.random.choice(num_images,
                           size=train_batch_size,
                           replace=<span class="hljs-keyword">False</span>)

    <span class="hljs-comment"># Use the random index to select random images and labels.</span>
    x_batch = images_train[idx, :, :, :]
    y_batch = labels_train[idx, :]

    <span class="hljs-keyword">return</span> x_batch, y_batch
</code></pre>
<h3 id="&#x6267;&#x884C;&#x4F18;&#x5316;&#x8FED;&#x4EE3;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x6267;&#x884C;&#x4F18;&#x5316;&#x8FED;&#x4EE3;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x51FD;&#x6570;&#x7528;&#x6765;&#x6267;&#x884C;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x8FED;&#x4EE3;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x9010;&#x6E10;&#x6539;&#x5584;&#x7F51;&#x7EDC;&#x5C42;&#x7684;&#x53D8;&#x91CF;&#x3002;&#x5728;&#x6BCF;&#x6B21;&#x8FED;&#x4EE3;&#x4E2D;&#xFF0C;&#x4F1A;&#x4ECE;&#x8BAD;&#x7EC3;&#x96C6;&#x4E2D;&#x9009;&#x62E9;&#x65B0;&#x7684;&#x4E00;&#x6279;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;TensorFlow&#x5728;&#x8FD9;&#x4E9B;&#x8BAD;&#x7EC3;&#x6837;&#x672C;&#x4E0A;&#x6267;&#x884C;&#x4F18;&#x5316;&#x3002;&#x6BCF;100&#x6B21;&#x8FED;&#x4EE3;&#x4F1A;&#x6253;&#x5370;&#x51FA;&#x8FDB;&#x5EA6;&#x3002;&#x6BCF;1000&#x6B21;&#x8FED;&#x4EE3;&#x540E;&#x4F1A;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;checkpoint&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x8FED;&#x4EE3;&#x5B8C;&#x6BD5;&#x4E5F;&#x4F1A;&#x4FDD;&#x5B58;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">optimize</span><span class="hljs-params">(num_iterations)</span>:</span>
    <span class="hljs-comment"># Start-time used for printing time-usage below.</span>
    start_time = time.time()

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_iterations):
        <span class="hljs-comment"># Get a batch of training examples.</span>
        <span class="hljs-comment"># x_batch now holds a batch of images and</span>
        <span class="hljs-comment"># y_true_batch are the true labels for those images.</span>
        x_batch, y_true_batch = random_batch()

        <span class="hljs-comment"># Put the batch into a dict with the proper names</span>
        <span class="hljs-comment"># for placeholder variables in the TensorFlow graph.</span>
        feed_dict_train = {x: x_batch,
                           y_true: y_true_batch}

        <span class="hljs-comment"># Run the optimizer using this batch of training data.</span>
        <span class="hljs-comment"># TensorFlow assigns the variables in feed_dict_train</span>
        <span class="hljs-comment"># to the placeholder variables and then runs the optimizer.</span>
        <span class="hljs-comment"># We also want to retrieve the global_step counter.</span>
        i_global, _ = session.run([global_step, optimizer],
                                  feed_dict=feed_dict_train)

        <span class="hljs-comment"># Print status to screen every 100 iterations (and last).</span>
        <span class="hljs-keyword">if</span> (i_global % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> (i == num_iterations - <span class="hljs-number">1</span>):
            <span class="hljs-comment"># Calculate the accuracy on the training-batch.</span>
            batch_acc = session.run(accuracy,
                                    feed_dict=feed_dict_train)

            <span class="hljs-comment"># Print status.</span>
            msg = <span class="hljs-string">&quot;Global Step: {0:&gt;6}, Training Batch Accuracy: {1:&gt;6.1%}&quot;</span>
            print(msg.format(i_global, batch_acc))

        <span class="hljs-comment"># Save a checkpoint to disk every 1000 iterations (and last).</span>
        <span class="hljs-keyword">if</span> (i_global % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">or</span> (i == num_iterations - <span class="hljs-number">1</span>):
            <span class="hljs-comment"># Save all variables of the TensorFlow graph to a</span>
            <span class="hljs-comment"># checkpoint. Append the global_step counter</span>
            <span class="hljs-comment"># to the filename so we save the last several checkpoints.</span>
            saver.save(session,
                       save_path=save_path,
                       global_step=global_step)

            print(<span class="hljs-string">&quot;Saved checkpoint.&quot;</span>)

    <span class="hljs-comment"># Ending time.</span>
    end_time = time.time()

    <span class="hljs-comment"># Difference between start and end-times.</span>
    time_dif = end_time - start_time

    <span class="hljs-comment"># Print the time-usage.</span>
    print(<span class="hljs-string">&quot;Time usage: &quot;</span> + str(timedelta(seconds=int(round(time_dif)))))
</code></pre>
<h3 id="&#x7528;&#x6765;&#x7ED8;&#x5236;&#x9519;&#x8BEF;&#x6837;&#x672C;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x7528;&#x6765;&#x7ED8;&#x5236;&#x9519;&#x8BEF;&#x6837;&#x672C;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x51FD;&#x6570;&#x7528;&#x6765;&#x7ED8;&#x5236;&#x6D4B;&#x8BD5;&#x96C6;&#x4E2D;&#x88AB;&#x8BEF;&#x5206;&#x7C7B;&#x7684;&#x6837;&#x672C;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_example_errors</span><span class="hljs-params">(cls_pred, correct)</span>:</span>
    <span class="hljs-comment"># This function is called from print_test_accuracy() below.</span>

    <span class="hljs-comment"># cls_pred is an array of the predicted class-number for</span>
    <span class="hljs-comment"># all images in the test-set.</span>

    <span class="hljs-comment"># correct is a boolean array whether the predicted class</span>
    <span class="hljs-comment"># is equal to the true class for each image in the test-set.</span>

    <span class="hljs-comment"># Negate the boolean array.</span>
    incorrect = (correct == <span class="hljs-keyword">False</span>)

    <span class="hljs-comment"># Get the images from the test-set that have been</span>
    <span class="hljs-comment"># incorrectly classified.</span>
    images = images_test[incorrect]

    <span class="hljs-comment"># Get the predicted classes for those images.</span>
    cls_pred = cls_pred[incorrect]

    <span class="hljs-comment"># Get the true classes for those images.</span>
    cls_true = cls_test[incorrect]

    <span class="hljs-comment"># Plot the first 9 images.</span>
    plot_images(images=images[<span class="hljs-number">0</span>:<span class="hljs-number">9</span>],
                cls_true=cls_true[<span class="hljs-number">0</span>:<span class="hljs-number">9</span>],
                cls_pred=cls_pred[<span class="hljs-number">0</span>:<span class="hljs-number">9</span>])
</code></pre>
<h3 id="&#x7ED8;&#x5236;&#x6DF7;&#x6DC6;&#xFF08;confusion&#xFF09;&#x77E9;&#x9635;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x7ED8;&#x5236;&#x6DF7;&#x6DC6;&#xFF08;confusion&#xFF09;&#x77E9;&#x9635;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_confusion_matrix</span><span class="hljs-params">(cls_pred)</span>:</span>
    <span class="hljs-comment"># This is called from print_test_accuracy() below.</span>

    <span class="hljs-comment"># cls_pred is an array of the predicted class-number for</span>
    <span class="hljs-comment"># all images in the test-set.</span>

    <span class="hljs-comment"># Get the confusion matrix using sklearn.</span>
    cm = confusion_matrix(y_true=cls_test,  <span class="hljs-comment"># True class for test-set.</span>
                          y_pred=cls_pred)  <span class="hljs-comment"># Predicted class.</span>

    <span class="hljs-comment"># Print the confusion matrix as text.</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_classes):
        <span class="hljs-comment"># Append the class-name to each line.</span>
        class_name = <span class="hljs-string">&quot;({}) {}&quot;</span>.format(i, class_names[i])
        print(cm[i, :], class_name)

    <span class="hljs-comment"># Print the class-numbers for easy reference.</span>
    class_numbers = [<span class="hljs-string">&quot; ({0})&quot;</span>.format(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_classes)]
    print(<span class="hljs-string">&quot;&quot;</span>.join(class_numbers))
</code></pre>
<h3 id="&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x56FE;&#x50CF;&#x7684;&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#xFF0C;&#x540C;&#x65F6;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EE3;&#x8868;&#x6BCF;&#x5F20;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#x662F;&#x5426;&#x6B63;&#x786E;&#x7684;&#x5E03;&#x5C14;&#x6570;&#x7EC4;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x8BA1;&#x7B97;&#x53EF;&#x80FD;&#x4F1A;&#x8017;&#x8D39;&#x592A;&#x591A;&#x5185;&#x5B58;&#xFF0C;&#x5C31;&#x5206;&#x6279;&#x5904;&#x7406;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;&#x7535;&#x8111;&#x6B7B;&#x673A;&#x4E86;&#xFF0C;&#x8BD5;&#x7740;&#x964D;&#x4F4E;batch-size&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># Split the data-set in batches of this size to limit RAM usage.</span>
batch_size = <span class="hljs-number">256</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict_cls</span><span class="hljs-params">(images, labels, cls_true)</span>:</span>
    <span class="hljs-comment"># Number of images.</span>
    num_images = len(images)

    <span class="hljs-comment"># Allocate an array for the predicted classes which</span>
    <span class="hljs-comment"># will be calculated in batches and filled into this array.</span>
    cls_pred = np.zeros(shape=num_images, dtype=np.int)

    <span class="hljs-comment"># Now calculate the predicted classes for the batches.</span>
    <span class="hljs-comment"># We will just iterate through all the batches.</span>
    <span class="hljs-comment"># There might be a more clever and Pythonic way of doing this.</span>

    <span class="hljs-comment"># The starting index for the next batch is denoted i.</span>
    i = <span class="hljs-number">0</span>

    <span class="hljs-keyword">while</span> i &lt; num_images:
        <span class="hljs-comment"># The ending index for the next batch is denoted j.</span>
        j = min(i + batch_size, num_images)

        <span class="hljs-comment"># Create a feed-dict with the images and labels</span>
        <span class="hljs-comment"># between index i and j.</span>
        feed_dict = {x: images[i:j, :],
                     y_true: labels[i:j, :]}

        <span class="hljs-comment"># Calculate the predicted class using TensorFlow.</span>
        cls_pred[i:j] = session.run(y_pred_cls, feed_dict=feed_dict)

        <span class="hljs-comment"># Set the start-index for the next batch to the</span>
        <span class="hljs-comment"># end-index of the current batch.</span>
        i = j

    <span class="hljs-comment"># Create a boolean array whether each image is correctly classified.</span>
    correct = (cls_true == cls_pred)

    <span class="hljs-keyword">return</span> correct, cls_pred
</code></pre>
<p>Calculate the predicted class for the test-set.</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict_cls_test</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">return</span> predict_cls(images = images_test,
                       labels = labels_test,
                       cls_true = cls_test)
</code></pre>
<h3 id="&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x4E86;&#x7ED9;&#x5B9A;&#x5E03;&#x5C14;&#x6570;&#x7EC4;&#x7684;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#xFF0C;&#x5E03;&#x5C14;&#x6570;&#x7EC4;&#x8868;&#x793A;&#x6BCF;&#x5F20;&#x56FE;&#x50CF;&#x662F;&#x5426;&#x88AB;&#x6B63;&#x786E;&#x5206;&#x7C7B;&#x3002;&#x6BD4;&#x5982;&#xFF0C; <code>cls_accuracy([True, True, False, False, False]) = 2/5 = 0.4</code>&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E5F;&#x8FD4;&#x56DE;&#x4E86;&#x6B63;&#x786E;&#x5206;&#x7C7B;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classification_accuracy</span><span class="hljs-params">(correct)</span>:</span>
    <span class="hljs-comment"># When averaging a boolean array, False means 0 and True means 1.</span>
    <span class="hljs-comment"># So we are calculating: number of True / len(correct) which is</span>
    <span class="hljs-comment"># the same as the classification accuracy.</span>

    <span class="hljs-comment"># Return the classification accuracy</span>
    <span class="hljs-comment"># and the number of correct classifications.</span>
    <span class="hljs-keyword">return</span> correct.mean(), correct.sum()
</code></pre>
<h3 id="&#x5C55;&#x793A;&#x6027;&#x80FD;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x5C55;&#x793A;&#x6027;&#x80FD;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<p>&#x51FD;&#x6570;&#x7528;&#x6765;&#x6253;&#x5370;&#x6D4B;&#x8BD5;&#x96C6;&#x4E0A;&#x7684;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x3002;</p>
<p>&#x4E3A;&#x6D4B;&#x8BD5;&#x96C6;&#x4E0A;&#x7684;&#x6240;&#x6709;&#x56FE;&#x7247;&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x4F1A;&#x82B1;&#x8D39;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4ECE;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x91CC;&#x8C03;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x5206;&#x7C7B;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_test_accuracy</span><span class="hljs-params">(show_example_errors=False,
                        show_confusion_matrix=False)</span>:</span>

    <span class="hljs-comment"># For all the images in the test-set,</span>
    <span class="hljs-comment"># calculate the predicted classes and whether they are correct.</span>
    correct, cls_pred = predict_cls_test()

    <span class="hljs-comment"># Classification accuracy and the number of correct classifications.</span>
    acc, num_correct = classification_accuracy(correct)

    <span class="hljs-comment"># Number of images being classified.</span>
    num_images = len(correct)

    <span class="hljs-comment"># Print the accuracy.</span>
    msg = <span class="hljs-string">&quot;Accuracy on Test-Set: {0:.1%} ({1} / {2})&quot;</span>
    print(msg.format(acc, num_correct, num_images))

    <span class="hljs-comment"># Plot some examples of mis-classifications, if desired.</span>
    <span class="hljs-keyword">if</span> show_example_errors:
        print(<span class="hljs-string">&quot;Example errors:&quot;</span>)
        plot_example_errors(cls_pred=cls_pred, correct=correct)

    <span class="hljs-comment"># Plot the confusion matrix, if desired.</span>
    <span class="hljs-keyword">if</span> show_confusion_matrix:
        print(<span class="hljs-string">&quot;Confusion Matrix:&quot;</span>)
        plot_confusion_matrix(cls_pred=cls_pred)
</code></pre>
<h3 id="&#x7ED8;&#x5236;&#x5377;&#x79EF;&#x6743;&#x91CD;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x7ED8;&#x5236;&#x5377;&#x79EF;&#x6743;&#x91CD;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_conv_weights</span><span class="hljs-params">(weights, input_channel=<span class="hljs-number">0</span>)</span>:</span>
    <span class="hljs-comment"># Assume weights are TensorFlow ops for 4-dim variables</span>
    <span class="hljs-comment"># e.g. weights_conv1 or weights_conv2.</span>

    <span class="hljs-comment"># Retrieve the values of the weight-variables from TensorFlow.</span>
    <span class="hljs-comment"># A feed-dict is not necessary because nothing is calculated.</span>
    w = session.run(weights)

    <span class="hljs-comment"># Print statistics for the weights.</span>
    print(<span class="hljs-string">&quot;Min:  {0:.5f}, Max:   {1:.5f}&quot;</span>.format(w.min(), w.max()))
    print(<span class="hljs-string">&quot;Mean: {0:.5f}, Stdev: {1:.5f}&quot;</span>.format(w.mean(), w.std()))

    <span class="hljs-comment"># Get the lowest and highest values for the weights.</span>
    <span class="hljs-comment"># This is used to correct the colour intensity across</span>
    <span class="hljs-comment"># the images so they can be compared with each other.</span>
    w_min = np.min(w)
    w_max = np.max(w)
    abs_max = max(abs(w_min), abs(w_max))

    <span class="hljs-comment"># Number of filters used in the conv. layer.</span>
    num_filters = w.shape[<span class="hljs-number">3</span>]

    <span class="hljs-comment"># Number of grids to plot.</span>
    <span class="hljs-comment"># Rounded-up, square-root of the number of filters.</span>
    num_grids = math.ceil(math.sqrt(num_filters))

    <span class="hljs-comment"># Create figure with a grid of sub-plots.</span>
    fig, axes = plt.subplots(num_grids, num_grids)

    <span class="hljs-comment"># Plot all the filter-weights.</span>
    <span class="hljs-keyword">for</span> i, ax <span class="hljs-keyword">in</span> enumerate(axes.flat):
        <span class="hljs-comment"># Only plot the valid filter-weights.</span>
        <span class="hljs-keyword">if</span> i&lt;num_filters:
            <span class="hljs-comment"># Get the weights for the i&apos;th filter of the input channel.</span>
            <span class="hljs-comment"># The format of this 4-dim tensor is determined by the</span>
            <span class="hljs-comment"># TensorFlow API. See Tutorial #02 for more details.</span>
            img = w[:, :, input_channel, i]

            <span class="hljs-comment"># Plot image.</span>
            ax.imshow(img, vmin=-abs_max, vmax=abs_max,
                      interpolation=<span class="hljs-string">&apos;nearest&apos;</span>, cmap=<span class="hljs-string">&apos;seismic&apos;</span>)

        <span class="hljs-comment"># Remove ticks from the plot.</span>
        ax.set_xticks([])
        ax.set_yticks([])

    <span class="hljs-comment"># Ensure the plot is shown correctly with multiple plots</span>
    <span class="hljs-comment"># in a single Notebook cell.</span>
    plt.show()
</code></pre>
<h3 id="&#x7ED8;&#x5236;&#x5377;&#x79EF;&#x5C42;&#x8F93;&#x51FA;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;">&#x7ED8;&#x5236;&#x5377;&#x79EF;&#x5C42;&#x8F93;&#x51FA;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;</h3>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_layer_output</span><span class="hljs-params">(layer_output, image)</span>:</span>
    <span class="hljs-comment"># Assume layer_output is a 4-dim tensor</span>
    <span class="hljs-comment"># e.g. output_conv1 or output_conv2.</span>

    <span class="hljs-comment"># Create a feed-dict which holds the single input image.</span>
    <span class="hljs-comment"># Note that TensorFlow needs a list of images,</span>
    <span class="hljs-comment"># so we just create a list with this one image.</span>
    feed_dict = {x: [image]}

    <span class="hljs-comment"># Retrieve the output of the layer after inputting this image.</span>
    values = session.run(layer_output, feed_dict=feed_dict)

    <span class="hljs-comment"># Get the lowest and highest values.</span>
    <span class="hljs-comment"># This is used to correct the colour intensity across</span>
    <span class="hljs-comment"># the images so they can be compared with each other.</span>
    values_min = np.min(values)
    values_max = np.max(values)

    <span class="hljs-comment"># Number of image channels output by the conv. layer.</span>
    num_images = values.shape[<span class="hljs-number">3</span>]

    <span class="hljs-comment"># Number of grid-cells to plot.</span>
    <span class="hljs-comment"># Rounded-up, square-root of the number of filters.</span>
    num_grids = math.ceil(math.sqrt(num_images))

    <span class="hljs-comment"># Create figure with a grid of sub-plots.</span>
    fig, axes = plt.subplots(num_grids, num_grids)

    <span class="hljs-comment"># Plot all the filter-weights.</span>
    <span class="hljs-keyword">for</span> i, ax <span class="hljs-keyword">in</span> enumerate(axes.flat):
        <span class="hljs-comment"># Only plot the valid image-channels.</span>
        <span class="hljs-keyword">if</span> i&lt;num_images:
            <span class="hljs-comment"># Get the images for the i&apos;th output channel.</span>
            img = values[<span class="hljs-number">0</span>, :, :, i]

            <span class="hljs-comment"># Plot image.</span>
            ax.imshow(img, vmin=values_min, vmax=values_max,
                      interpolation=<span class="hljs-string">&apos;nearest&apos;</span>, cmap=<span class="hljs-string">&apos;binary&apos;</span>)

        <span class="hljs-comment"># Remove ticks from the plot.</span>
        ax.set_xticks([])
        ax.set_yticks([])

    <span class="hljs-comment"># Ensure the plot is shown correctly with multiple plots</span>
    <span class="hljs-comment"># in a single Notebook cell.</span>
    plt.show()
</code></pre>
<h2 id="&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x53D8;&#x4F53;&#x7684;&#x6837;&#x672C;">&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x53D8;&#x4F53;&#x7684;&#x6837;&#x672C;</h2>
<p>&#x4E3A;&#x4E86;&#x4EBA;&#x4E3A;&#x5730;&#x589E;&#x52A0;&#x8BAD;&#x7EC3;&#x7528;&#x7684;&#x56FE;&#x50CF;&#x6570;&#x91CF;&#xFF0C;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x9884;&#x5904;&#x7406;&#x83B7;&#x53D6;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x7684;&#x968F;&#x673A;&#x53D8;&#x4F53;&#x3002;&#x8FD9;&#x8BA9;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5728;&#x8BC6;&#x522B;&#x548C;&#x5206;&#x7C7B;&#x56FE;&#x50CF;&#x65F6;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x7528;&#x6765;&#x7ED8;&#x5236;&#x8F93;&#x5165;&#x56FE;&#x50CF;&#x53D8;&#x4F53;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_distorted_image</span><span class="hljs-params">(image, cls_true)</span>:</span>
    <span class="hljs-comment"># Repeat the input image 9 times.</span>
    image_duplicates = np.repeat(image[np.newaxis, :, :, :], <span class="hljs-number">9</span>, axis=<span class="hljs-number">0</span>)

    <span class="hljs-comment"># Create a feed-dict for TensorFlow.</span>
    feed_dict = {x: image_duplicates}

    <span class="hljs-comment"># Calculate only the pre-processing of the TensorFlow graph</span>
    <span class="hljs-comment"># which distorts the images in the feed-dict.</span>
    result = session.run(distorted_images, feed_dict=feed_dict)

    <span class="hljs-comment"># Plot the images.</span>
    plot_images(images=result, cls_true=np.repeat(cls_true, <span class="hljs-number">9</span>))
</code></pre>
<p>&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6D4B;&#x8BD5;&#x96C6;&#x56FE;&#x50CF;&#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x5206;&#x7C7B;&#x53F7;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_test_image</span><span class="hljs-params">(i)</span>:</span>
    <span class="hljs-keyword">return</span> images_test[i, :, :, :], cls_test[i]
</code></pre>
<p>&#x4ECE;&#x6D4B;&#x8BD5;&#x96C6;&#x4E2D;&#x53D6;&#x4E00;&#x5F20;&#x56FE;&#x50CF;&#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x771F;&#x5B9E;&#x7C7B;&#x522B;&#x3002;</p>
<pre><code class="lang-python">img, cls = get_test_image(<span class="hljs-number">16</span>)
</code></pre>
<p>&#x753B;&#x51FA;&#x56FE;&#x50CF;&#x7684;9&#x5F20;&#x968F;&#x673A;&#x53D8;&#x4F53;&#x3002;&#x5982;&#x679C;&#x4F60;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5F97;&#x5230;&#x4E0D;&#x592A;&#x4E00;&#x6837;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<pre><code class="lang-python">plot_distorted_image(img, cls)
</code></pre>
<p><img src="output_131_0.png" alt="png"></p>
<h2 id="&#x6267;&#x884C;&#x4F18;&#x5316;">&#x6267;&#x884C;&#x4F18;&#x5316;</h2>
<p>&#x6211;&#x7684;&#x7B14;&#x8BB0;&#x672C;&#x7535;&#x8111;&#x662F;4&#x6838;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;2GHz&#x3002;&#x7535;&#x8111;&#x5E26;&#x6709;&#x4E00;&#x4E2A;GPU&#xFF0C;&#x4F46;&#x5BF9;TensorFlow&#x6765;&#x8BF4;&#x4E0D;&#x592A;&#x5FEB;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x7528;&#x4E86;CPU&#x3002;&#x5728;&#x7535;&#x8111;&#x4E0A;&#x8FED;&#x4EE3;10,000&#x6B21;&#x5927;&#x6982;&#x82B1;&#x4E86;1&#x4E2A;&#x5C0F;&#x65F6;&#x3002;&#x672C;&#x6559;&#x7A0B;&#x4E2D;&#x6211;&#x6267;&#x884C;&#x4E86;150,000&#x6B21;&#x4F18;&#x5316;&#x8FED;&#x4EE3;&#xFF0C;&#x5171;&#x82B1;&#x4E86;15&#x4E2A;&#x5C0F;&#x65F6;&#x3002;&#x6211;&#x8BA9;&#x5B83;&#x5728;&#x591C;&#x91CC;&#x4EE5;&#x53CA;&#x767D;&#x5929;&#x7684;&#x51E0;&#x4E2A;&#x65F6;&#x95F4;&#x6BB5;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5728;&#x4F18;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#x4FDD;&#x5B58;&#x4E86;checkpoints&#xFF0C;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#x65F6;&#x4F1A;&#x8F7D;&#x5165;&#x6700;&#x540E;&#x7684;&#x90A3;&#x4E2A;checkpoint&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5148;&#x505C;&#x6B62;&#xFF0C;&#x7B49;&#x665A;&#x70B9;&#x518D;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4F18;&#x5316;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">False</span>:
    optimize(num_iterations=<span class="hljs-number">1000</span>)
</code></pre>
<h2 id="&#x7ED3;&#x679C;">&#x7ED3;&#x679C;</h2>
<p>&#x5728;150,000&#x6B21;&#x4F18;&#x5316;&#x8FED;&#x4EE3;&#x4E4B;&#x540E;&#xFF0C;&#x6D4B;&#x8BD5;&#x96C6;&#x4E0A;&#x7684;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x5927;&#x7EA6;79%-80%&#x3002;&#x4E0B;&#x9762;&#x753B;&#x51FA;&#x4E86;&#x4E00;&#x4E9B;&#x8BEF;&#x5206;&#x7C7B;&#x7684;&#x56FE;&#x50CF;&#x3002;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E9B;&#x5373;&#x4F7F;&#x4EBA;&#x773C;&#x4E5F;&#x5F88;&#x96BE;&#x5206;&#x8FA8;&#x51FA;&#x6765;&#xFF0C;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x662F;&#x5408;&#x4E4E;&#x60C5;&#x7406;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x6BD4;&#x5982;&#x5927;&#x578B;&#x8F66;&#x548C;&#x5361;&#x8F66;&#xFF0C;&#x732B;&#x4E0E;&#x72D7;&#xFF0C;&#x4F46;&#x6709;&#x4E9B;&#x9519;&#x8BEF;&#x5C31;&#x6709;&#x70B9;&#x5947;&#x602A;&#x4E86;&#x3002;</p>
<pre><code class="lang-python">print_test_accuracy(show_example_errors=<span class="hljs-keyword">True</span>,
                    show_confusion_matrix=<span class="hljs-keyword">True</span>)
</code></pre>
<pre><code>Accuracy on Test-Set: 79.3% (7932 / 10000)
Example errors:
</code></pre><p><img src="output_136_1.png" alt="png"></p>
<pre><code>Confusion Matrix:
[775  20  71   8  14   4  18  10  44  36] (0) airplane
[  7 914   5   0   3   7   9   3  14  38] (1) automobile
[ 32   2 724  28  42  44  94  17   9   8] (2) bird
[ 18   7  48 508  56 209  99  29   7  19] (3) cat
[  4   2  45  25 769  29  75  43   3   5] (4) deer
[  8   6  34  89  35 748  38  32   1   9] (5) dog
[  4   2  18   9  14  14 930   4   2   3] (6) frog
[  6   2  23  18  31  55  17 833   0  15] (7) horse
[ 31  29  15  11   8   7  15   0 856  28] (8) ship
[ 13  67   4   5   0   4   7   7  18 875] (9) truck
 (0) (1) (2) (3) (4) (5) (6) (7) (8) (9)
</code></pre><h3 id="&#x5377;&#x79EF;&#x6743;&#x91CD;">&#x5377;&#x79EF;&#x6743;&#x91CD;</h3>
<p>&#x4E0B;&#x9762;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E9B;&#x7B2C;&#x4E00;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x6743;&#x91CD;&#xFF08;&#x6216;&#x6EE4;&#x6CE2;&#xFF09;&#x3002;&#x5171;&#x6709;3&#x4E2A;&#x8F93;&#x5165;&#x901A;&#x9053;&#xFF0C;&#x56E0;&#x6B64;&#x6709;&#x4E09;&#x7EC4;&#xFF08;&#x6570;&#x636E;&#xFF09;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x6539;&#x53D8;<code>input_channel</code>&#x6765;&#x6539;&#x53D8;&#x7ED8;&#x5236;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x6743;&#x91CD;&#x6B63;&#x503C;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x8D1F;&#x503C;&#x662F;&#x84DD;&#x7684;&#x3002;</p>
<pre><code class="lang-python">plot_conv_weights(weights=weights_conv1, input_channel=<span class="hljs-number">0</span>)
</code></pre>
<pre><code>Min:  -0.61643, Max:   0.63949
Mean: -0.00177, Stdev: 0.16469
</code></pre><p><img src="output_138_1.png" alt="png"></p>
<p>&#x4E0B;&#x9762;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E9B;&#x7B2C;&#x4E8C;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x6743;&#x91CD;&#xFF08;&#x6216;&#x6EE4;&#x6CE2;&#xFF09;&#x3002;&#x5B83;&#x4EEC;&#x6BD4;&#x7B2C;&#x4E00;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x6743;&#x91CD;&#x66F4;&#x63A5;&#x8FD1;&#x96F6;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6BD4;&#x8F83;&#x4F4E;&#x7684;&#x6807;&#x51C6;&#x5DEE;&#x3002;</p>
<pre><code class="lang-python">plot_conv_weights(weights=weights_conv2, input_channel=<span class="hljs-number">1</span>)
</code></pre>
<pre><code>Min:  -0.73326, Max:   0.25344
Mean: -0.00394, Stdev: 0.05466
</code></pre><p><img src="output_140_1.png" alt="png"></p>
<h3 id="&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;">&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;</h3>
<p>&#x7ED8;&#x5236;&#x56FE;&#x50CF;&#x7684;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_image</span><span class="hljs-params">(image)</span>:</span>
    <span class="hljs-comment"># Create figure with sub-plots.</span>
    fig, axes = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)

    <span class="hljs-comment"># References to the sub-plots.</span>
    ax0 = axes.flat[<span class="hljs-number">0</span>]
    ax1 = axes.flat[<span class="hljs-number">1</span>]

    <span class="hljs-comment"># Show raw and smoothened images in sub-plots.</span>
    ax0.imshow(image, interpolation=<span class="hljs-string">&apos;nearest&apos;</span>)
    ax1.imshow(image, interpolation=<span class="hljs-string">&apos;spline16&apos;</span>)

    <span class="hljs-comment"># Set labels.</span>
    ax0.set_xlabel(<span class="hljs-string">&apos;Raw&apos;</span>)
    ax1.set_xlabel(<span class="hljs-string">&apos;Smooth&apos;</span>)

    <span class="hljs-comment"># Ensure the plot is shown correctly with multiple plots</span>
    <span class="hljs-comment"># in a single Notebook cell.</span>
    plt.show()
</code></pre>
<p>&#x7ED8;&#x5236;&#x4E00;&#x5F20;&#x6D4B;&#x8BD5;&#x96C6;&#x4E2D;&#x7684;&#x56FE;&#x50CF;&#x3002;&#x672A;&#x5904;&#x7406;&#x7684;&#x50CF;&#x7D20;&#x56FE;&#x50CF;&#x4F5C;&#x4E3A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x8F93;&#x5165;&#x3002;</p>
<pre><code class="lang-python">img, cls = get_test_image(<span class="hljs-number">16</span>)
plot_image(img)
</code></pre>
<p><img src="output_145_0.png" alt="png"></p>
<p>&#x5C06;&#x539F;&#x59CB;&#x56FE;&#x50CF;&#x4F5C;&#x4E3A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x7136;&#x540E;&#x753B;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;&#x3002;</p>
<pre><code class="lang-python">plot_layer_output(output_conv1, image=img)
</code></pre>
<p><img src="output_147_0.png" alt="png"></p>
<p>&#x5C06;&#x540C;&#x6837;&#x7684;&#x56FE;&#x50CF;&#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#xFF0C;&#x753B;&#x51FA;&#x7B2C;&#x4E8C;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;&#x3002;</p>
<pre><code class="lang-python">plot_layer_output(output_conv2, image=img)
</code></pre>
<p><img src="output_149_0.png" alt="png"></p>
<h3 id="&#x9884;&#x6D4B;&#x7684;&#x7C7B;&#x522B;&#x6807;&#x7B7E;">&#x9884;&#x6D4B;&#x7684;&#x7C7B;&#x522B;&#x6807;&#x7B7E;</h3>
<p>&#x83B7;&#x53D6;&#x56FE;&#x50CF;&#x7684;&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#x6807;&#x7B7E;&#x548C;&#x7C7B;&#x522B;&#x53F7;&#x3002;</p>
<pre><code class="lang-python">label_pred, cls_pred = session.run([y_pred, y_pred_cls],
                                   feed_dict={x: [img]})
</code></pre>
<p>&#x6253;&#x5370;&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#x6807;&#x7B7E;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># Set the rounding options for numpy.</span>
np.set_printoptions(precision=<span class="hljs-number">3</span>, suppress=<span class="hljs-keyword">True</span>)

<span class="hljs-comment"># Print the predicted label.</span>
print(label_pred[<span class="hljs-number">0</span>])
</code></pre>
<pre><code>[ 0.     0.     0.     0.493  0.     0.49   0.006  0.01   0.     0.   ]
</code></pre><p>&#x9884;&#x6D4B;&#x7C7B;&#x522B;&#x6807;&#x7B7E;&#x662F;&#x957F;&#x5EA6;&#x4E3A;10&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4EE3;&#x8868;&#x7740;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x6709;&#x591A;&#x5927;&#x4FE1;&#x5FC3;&#x8BA4;&#x4E3A;&#x56FE;&#x50CF;&#x662F;&#x8BE5;&#x7C7B;&#x522B;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x7D22;&#x5F15;3&#x7684;&#x503C;&#x662F;0.493&#xFF0C;5&#x7684;&#x503C;&#x4E3A;0.490&#x3002;&#x8FD9;&#x8868;&#x793A;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x76F8;&#x4FE1;&#x56FE;&#x50CF;&#x8981;&#x4E48;&#x662F;&#x7C7B;&#x522B;3&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x7C7B;&#x522B;5&#xFF0C;&#x5373;&#x732B;&#x6216;&#x72D7;&#x3002;</p>
<pre><code class="lang-python">class_names[<span class="hljs-number">3</span>]
</code></pre>
<pre><code>&apos;cat&apos;
</code></pre><pre><code class="lang-python">class_names[<span class="hljs-number">5</span>]
</code></pre>
<pre><code>&apos;dog&apos;
</code></pre><h3 id="&#x5173;&#x95ED;tensorflow&#x4F1A;&#x8BDD;">&#x5173;&#x95ED;TensorFlow&#x4F1A;&#x8BDD;</h3>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x7528;TensorFlow&#x5B8C;&#x6210;&#x4E86;&#x4EFB;&#x52A1;&#xFF0C;&#x5173;&#x95ED;session&#xFF0C;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment"># This has been commented out in case you want to modify and experiment</span>
<span class="hljs-comment"># with the Notebook without having to restart it.</span>
<span class="hljs-comment"># session.close()</span>
</code></pre>
<h2 id="&#x7ED3;&#x8BBA;">&#x7ED3;&#x8BBA;</h2>
<p>&#x8FD9;&#x7BC7;&#x6559;&#x7A0B;&#x4ECB;&#x7ECD;&#x4E86;&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5728;CIRAR-10&#x6570;&#x636E;&#x96C6;&#x4E0A;&#x8FDB;&#x884C;&#x56FE;&#x50CF;&#x5206;&#x7C7B;&#x7684;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x3002;&#x6D4B;&#x8BD5;&#x96C6;&#x4E0A;&#x7684;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x5927;&#x6982;79-80%&#x3002;</p>
<p>&#x540C;&#x65F6;&#x4E5F;&#x753B;&#x51FA;&#x4E86;&#x5377;&#x79EF;&#x5C42;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x4F46;&#x5F88;&#x96BE;&#x770B;&#x51FA;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x5982;&#x4F55;&#x5206;&#x8FA8;&#x5E76;&#x5206;&#x7C7B;&#x56FE;&#x50CF;&#x3002;&#x9700;&#x8981;&#x66F4;&#x597D;&#x7684;&#x53EF;&#x89C6;&#x5316;&#x6280;&#x5DE7;&#x3002;</p>
<h2 id="&#x7EC3;&#x4E60;">&#x7EC3;&#x4E60;</h2>
<p>&#x4E0B;&#x9762;&#x4F7F;&#x4E00;&#x4E9B;&#x53EF;&#x80FD;&#x4F1A;&#x8BA9;&#x4F60;&#x63D0;&#x5347;TensorFlow&#x6280;&#x80FD;&#x7684;&#x4E00;&#x4E9B;&#x5EFA;&#x8BAE;&#x7EC3;&#x4E60;&#x3002;&#x4E3A;&#x4E86;&#x5B66;&#x4E60;&#x5982;&#x4F55;&#x66F4;&#x5408;&#x9002;&#x5730;&#x4F7F;&#x7528;TensorFlow&#xFF0C;&#x5B9E;&#x8DF5;&#x7ECF;&#x9A8C;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x3002;</p>
<p>&#x5728;&#x4F60;&#x5BF9;&#x8FD9;&#x4E2A;Nootbook&#x8FDB;&#x884C;&#x6539;&#x53D8;&#x4E4B;&#x524D;&#xFF0C;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5148;&#x5907;&#x4EFD;&#x4E00;&#x4E0B;&#x3002;</p>
<ul>
<li>&#x6267;&#x884C;10,000&#x6B21;&#x8FED;&#x4EE3;&#xFF0C;&#x770B;&#x770B;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x5982;&#x4F55;&#x3002;&#x5C06;&#x4F1A;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;checkpoint&#x6765;&#x50A8;&#x5B58;TensorFlow&#x56FE;&#x7684;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x3002;</li>
<li>&#x518D;&#x6267;&#x884C;100,000&#x6B21;&#x8FED;&#x4EE3;&#xFF0C;&#x770B;&#x770B;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x6709;&#x6CA1;&#x6709;&#x63D0;&#x5347;&#x3002;&#x7136;&#x540E;&#x518D;&#x6267;&#x884C;100,000&#x6B21;&#x3002;&#x51C6;&#x786E;&#x7387;&#x6709;&#x63D0;&#x5347;&#x5417;&#xFF0C;&#x4F60;&#x8BA4;&#x4E3A;&#x503C;&#x5F97;&#x8FD9;&#x4E9B;&#x589E;&#x52A0;&#x7684;&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x5417;&#xFF1F;</li>
<li>&#x8BD5;&#x7740;&#x518D;&#x9884;&#x5904;&#x7406;&#x9636;&#x6BB5;&#x6539;&#x53D8;&#x56FE;&#x50CF;&#x7684;&#x53D8;&#x4F53;&#x3002;</li>
<li>&#x8BD5;&#x7740;&#x6539;&#x53D8;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x8BA9;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x66F4;&#x5927;&#x6216;&#x66F4;&#x5C0F;&#x3002;&#x8FD9;&#x5BF9;&#x8BAD;&#x7EC3;&#x65F6;&#x95F4;&#x6216;&#x5206;&#x7C7B;&#x51C6;&#x786E;&#x7387;&#x6709;&#x4EC0;&#x4E48;&#x5F71;&#x54CD;&#xFF1F;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5F53;&#x4F60;&#x6539;&#x53D8;&#x4E86;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x91CD;&#x65B0;&#x8F7D;&#x5165;checkpoints&#x4E86;&#x3002;</li>
<li>&#x8BD5;&#x7740;&#x5728;&#x7B2C;&#x4E8C;&#x4E2A;&#x5377;&#x79EF;&#x5C42;&#x4F7F;&#x7528;batch-normalization&#x3002;&#x4E5F;&#x8BD5;&#x8BD5;&#x5728;&#x4FE9;&#x4E2A;&#x5C42;&#x4E2D;&#x90FD;&#x5220;&#x6389;&#x5B83;&#x3002;</li>
<li>&#x7814;&#x7A76;&#x4E00;&#x4E9B;CIFAR-10&#x4E0A;&#x7684;<a href="http://rodrigob.github.io/are_we_there_yet/build/classification_datasets_results.html" target="_blank">&#x66F4;&#x597D;&#x7684;&#x795E;&#x7ECF;&#x7F51;&#x7EDC;</a> &#xFF0C;&#x8BD5;&#x7740;&#x5B9E;&#x73B0;&#x5B83;&#x4EEC;&#x3002;</li>
<li>&#x5411;&#x670B;&#x53CB;&#x89E3;&#x91CA;&#x7A0B;&#x5E8F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x3002;</li>
</ul>
<h2 id="license-mit">License (MIT)</h2>
<p>Copyright (c) 2016 by <a href="http://www.hvass-labs.org/" target="_blank">Magnus Erik Hvass Pedersen</a></p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.html" class="navigation navigation-prev " aria-label="Previous page: 集成学习">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.html" class="navigation navigation-next " aria-label="Next page: Inception 模型">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"CIFAR-10","level":"1.7","depth":1,"next":{"title":"Inception 模型","level":"1.8","depth":1,"path":"07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.md","ref":"07_Inception_Model_zh_CN/07_Inception_Model_zh_CN.md","articles":[]},"previous":{"title":"集成学习","level":"1.6","depth":1,"path":"05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.md","ref":"05_Ensemble_Learning_zh_CN/05_Ensemble_Learning_zh_CN.md","articles":[]},"dir":"ltr"},"config":{"plugins":["comment"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"comment":{"highlightCommented":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"wizardforcel","pdf":{"pageNumbers":true,"fontSize":16,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"TensorFlow 教程（Hvass）","language":"zh","links":{"sidebar":{"TensorFlow 教程（Hvass）":"https://www.gitbook.com/book/wizardforcel/tf-tut-hvass"},"gitbook":true},"gitbook":"*","description":"Tensorflow 教程（Hvass）"},"file":{"path":"06_CIFAR-10_zh_CN/06_CIFAR-10_zh_CN.md","mtime":"2017-09-18T01:21:37.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-09-18T01:34:14.068Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-comment/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

