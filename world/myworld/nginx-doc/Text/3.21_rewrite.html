<!DOCTYPE HTML>
<html lang="zh-tw" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>HttpRewrite模块 | Nginx 中文官方文档</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.5">
        <meta name="author" content="wizardforcel">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-comment/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../Text/3.22_httpssi.html" />
    
    
    <link rel="prev" href="../Text/3.20_httpproxy.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="3.21"
        data-chapter-title="HttpRewrite模块"
        data-filepath="Text/3.21_rewrite.md"
        data-basepath=".."
        data-revision="Mon Dec 14 2015 06:00:19 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
                
                <li>
                    <a href="https://www.gitbook.com/book/wizardforcel/nginx-doc" target="blank" class="custom-link">Nginx 中文官方文档</a>
                </li>
            
            

            
            <li class="divider"></li>
            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        介紹
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Text/1.html">
            
                
                    <a href="../Text/1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        主要文档
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="Text/1.1_overview.html">
            
                
                    <a href="../Text/1.1_overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Nginx功能概述
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Text/1.2_nginxchswhyuseit.html">
            
                
                    <a href="../Text/1.2_nginxchswhyuseit.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        为什么选择Nginx
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Text/1.3_install.html">
            
                
                    <a href="../Text/1.3_install.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Nginx安装
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Text/1.4_nginxchscommandline.html">
            
                
                    <a href="../Text/1.4_nginxchscommandline.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        运行和控制Nginx
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Text/1.5_notation.html">
            
                
                    <a href="../Text/1.5_notation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        配置符号参考
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Text/1.6_optimizations.html">
            
                
                    <a href="../Text/1.6_optimizations.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        优化 Nginx
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Text/1.7_faq.html">
            
                
                    <a href="../Text/1.7_faq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        常见问题(FAQ)
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Text/1.8_debug.html">
            
                
                    <a href="../Text/1.8_debug.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.8.</b>
                        
                        调试 nginx
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Text/2.html">
            
                
                    <a href="../Text/2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        核心模块
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Text/2.1_mainmodule.html">
            
                
                    <a href="../Text/2.1_mainmodule.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Nginx主模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Text/2.2_events.html">
            
                
                    <a href="../Text/2.2_events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Nginx事件模块
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Text/3.html">
            
                
                    <a href="../Text/3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        基本模块
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="Text/3.1_httpcore.html">
            
                
                    <a href="../Text/3.1_httpcore.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        http核心模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Text/3.2_httpupstream.html">
            
                
                    <a href="../Text/3.2_httpupstream.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        HttpIndex模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Text/3.3_httpaccess.html">
            
                
                    <a href="../Text/3.3_httpaccess.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        HttpAccess模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="Text/3.4_httpauthbasic.html">
            
                
                    <a href="../Text/3.4_httpauthbasic.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        HttpAuthBasic模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="Text/3.5_httpautoindex.html">
            
                
                    <a href="../Text/3.5_httpautoindex.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        HttpAutoindex模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="Text/3.6_browser.html">
            
                
                    <a href="../Text/3.6_browser.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Browser模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="Text/3.7_charset.html">
            
                
                    <a href="../Text/3.7_charset.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Charset模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="Text/3.8_httpemptygif.html">
            
                
                    <a href="../Text/3.8_httpemptygif.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        HttpEmptyGif模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="Text/3.9_httpfcgi.html">
            
                
                    <a href="../Text/3.9_httpfcgi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        HttpFcgi模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="Text/3.10_geo.html">
            
                
                    <a href="../Text/3.10_geo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.10.</b>
                        
                        Geo模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="Text/3.11_httpgzip.html">
            
                
                    <a href="../Text/3.11_httpgzip.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.11.</b>
                        
                        HttpGzip模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="Text/3.12_httpheaders.html">
            
                
                    <a href="../Text/3.12_httpheaders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.12.</b>
                        
                        HttpHeaders模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="Text/3.13_httpindex.html">
            
                
                    <a href="../Text/3.13_httpindex.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.13.</b>
                        
                        HttpIndex模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="Text/3.14_httpreferer.html">
            
                
                    <a href="../Text/3.14_httpreferer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.14.</b>
                        
                        HttpReferer模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.15" data-path="Text/3.15_httplimitzone.html">
            
                
                    <a href="../Text/3.15_httplimitzone.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.15.</b>
                        
                        HttpLimit zone
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.16" data-path="Text/3.16_httplimitrequest.html">
            
                
                    <a href="../Text/3.16_httplimitrequest.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.16.</b>
                        
                        HttpLimitReqest模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.17" data-path="Text/3.17_httplog.html">
            
                
                    <a href="../Text/3.17_httplog.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.17.</b>
                        
                        HttpLog模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.18" data-path="Text/3.18_map.html">
            
                
                    <a href="../Text/3.18_map.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.18.</b>
                        
                        map
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.19" data-path="Text/3.19_memcached.html">
            
                
                    <a href="../Text/3.19_memcached.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.19.</b>
                        
                        Memcached
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.20" data-path="Text/3.20_httpproxy.html">
            
                
                    <a href="../Text/3.20_httpproxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.20.</b>
                        
                        HttpProxy模块
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.21" data-path="Text/3.21_rewrite.html">
            
                
                    <a href="../Text/3.21_rewrite.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.21.</b>
                        
                        HttpRewrite模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.22" data-path="Text/3.22_httpssi.html">
            
                
                    <a href="../Text/3.22_httpssi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.22.</b>
                        
                        HttpSSI模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.23" data-path="Text/3.23_userid.html">
            
                
                    <a href="../Text/3.23_userid.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.23.</b>
                        
                        HttpUserId
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Text/4.html">
            
                
                    <a href="../Text/4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        其他模块
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Text/4.1_addition.html">
            
                
                    <a href="../Text/4.1_addition.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Addition模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="Text/4.2_embeddedperl.html">
            
                
                    <a href="../Text/4.2_embeddedperl.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        EmbeddedPerl
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Text/4.3_flv.html">
            
                
                    <a href="../Text/4.3_flv.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        flv
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="Text/4.4_gzipstatic.html">
            
                
                    <a href="../Text/4.4_gzipstatic.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        HttpGzipStatic
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Text/4.5_randomindex.html">
            
                
                    <a href="../Text/4.5_randomindex.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        RandomIndex
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="Text/4.6_geoip.html">
            
                
                    <a href="../Text/4.6_geoip.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        HttpGeoIP
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="Text/4.7_realip.html">
            
                
                    <a href="../Text/4.7_realip.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        HttpRealIp
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="Text/4.8_ssl.html">
            
                
                    <a href="../Text/4.8_ssl.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        HttpSSL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="Text/4.9_stubstatus.html">
            
                
                    <a href="../Text/4.9_stubstatus.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        StubStatus模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="Text/4.10_sub.html">
            
                
                    <a href="../Text/4.10_sub.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.10.</b>
                        
                        HttpSubstitution
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="Text/4.11_httpdav.html">
            
                
                    <a href="../Text/4.11_httpdav.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.11.</b>
                        
                        HttpDav模块
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="Text/4.12_googleperftools.html">
            
                
                    <a href="../Text/4.12_googleperftools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.</b>
                        
                        GooglePerftools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="Text/4.13_xslt.html">
            
                
                    <a href="../Text/4.13_xslt.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.13.</b>
                        
                        HttpXSLT
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="Text/4.14_securelink.html">
            
                
                    <a href="../Text/4.14_securelink.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.14.</b>
                        
                        HttpSecureLink
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.15" data-path="Text/4.15_imagefilter.html">
            
                
                    <a href="../Text/4.15_imagefilter.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.15.</b>
                        
                        HttpImageFilter
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Text/5.html">
            
                
                    <a href="../Text/5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        mail模块
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Text/5.1_mailcore.html">
            
                
                    <a href="../Text/5.1_mailcore.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        MailCore
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="Text/5.2_mailauth.html">
            
                
                    <a href="../Text/5.2_mailauth.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        MailAuth
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="Text/5.3_mailproxy.html">
            
                
                    <a href="../Text/5.3_mailproxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        MailProxy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="Text/5.4_mailssl.html">
            
                
                    <a href="../Text/5.4_mailssl.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        MailSSL
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Text/6.html">
            
                
                    <a href="../Text/6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        安装
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Text/6.1_nginx_windows.html">
            
                
                    <a href="../Text/6.1_nginx_windows.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        nginx在windows上的安装
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="Text/6.2_nginx_freebsd.html">
            
                
                    <a href="../Text/6.2_nginx_freebsd.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        nginx在freebsd上的安装
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="Text/6.3_nginx_ubuntu.html">
            
                
                    <a href="../Text/6.3_nginx_ubuntu.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        nginx在ubuntu上的安装
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="Text/6.4_nginx_fedora.html">
            
                
                    <a href="../Text/6.4_nginx_fedora.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        nginx在fedora上的安装
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="Text/6.5_nginx_php_fpm.html">
            
                
                    <a href="../Text/6.5_nginx_php_fpm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        nginx php-fpm安装配置
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Text/7.html">
            
                
                    <a href="../Text/7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        配置示例和方法
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Text/7.1_fullexample.html">
            
                
                    <a href="../Text/7.1_fullexample.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        完整例子
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="Text/7.2_fullexample2.html">
            
                
                    <a href="../Text/7.2_fullexample2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        完整例子2
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="Text/7.3_virtualhost.html">
            
                
                    <a href="../Text/7.3_virtualhost.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        虚拟主机
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="Text/7.4_loadbalance.html">
            
                
                    <a href="../Text/7.4_loadbalance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        负载均衡
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="Text/7.5_doorchain.html">
            
                
                    <a href="../Text/7.5_doorchain.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.</b>
                        
                        nginx防盗链
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="Text/7.6_checkerrors.html">
            
                
                    <a href="../Text/7.6_checkerrors.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.6.</b>
                        
                        HWLoadbalancerCheckErrors
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    本書使用 GitBook 釋出
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Nginx 中文官方文档</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h3 id="httprewrite&#x6A21;&#x5757;">HttpRewrite&#x6A21;&#x5757;</h3>
<p>This module makes it possible to change URI using regular expressions, and to redirect and select configuration depending on variables.</p>
<p>&#x8BE5;&#x6A21;&#x5757;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x6539;&#x53D8;URI&#xFF0C;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x53D8;&#x91CF;&#x6765;&#x8F6C;&#x5411;&#x4EE5;&#x53CA;&#x9009;&#x62E9;&#x914D;&#x7F6E;&#x3002;</p>
<p>If the directives of this module are given at the server level, then they are carried out before the location of the request is determined. If in that selected location there are further rewrite directives, then they also are carried out. If the URI changed as a result of the execution of directives inside location, then location is again determined for the new URI.</p>
<p>&#x5982;&#x679C;&#x5728;server&#x7EA7;&#x522B;&#x8BBE;&#x7F6E;&#x8BE5;&#x9009;&#x9879;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x4EEC;&#x5C06;&#x5728;location&#x4E4B;&#x524D;&#x751F;&#x6548;&#x3002;&#x5982;&#x679C;&#x5728;location&#x8FD8;&#x6709;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x91CD;&#x5199;&#x89C4;&#x5219;&#xFF0C;location&#x90E8;&#x5206;&#x7684;&#x89C4;&#x5219;&#x4F9D;&#x7136;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E2A;URI&#x91CD;&#x5199;&#x662F;&#x56E0;&#x4E3A;location&#x90E8;&#x5206;&#x7684;&#x89C4;&#x5219;&#x9020;&#x6210;&#x7684;&#xFF0C;&#x90A3;&#x4E48;location&#x90E8;&#x5206;&#x4F1A;&#x518D;&#x6B21;&#x88AB;&#x6267;&#x884C;&#x4F5C;&#x4E3A;&#x65B0;&#x7684;URI&#x3002;</p>
<p>This cycle can be repeated up to 10 times, after which Nginx returns a 500 error.</p>
<p>&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x4F1A;&#x6267;&#x884C;10&#x6B21;&#xFF0C;&#x7136;&#x540E;Nginx&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;500&#x9519;&#x8BEF;&#x3002;</p>
<h3 id="directives">Directives</h3>
<ul>
<li>[#break break]</li>
<li>[#if if]</li>
<li>[#return return]</li>
<li>[#rewrite rewrite]</li>
<li>[#set set]</li>
<li>[#uninitialized_variable_warn uninitialized_variable_warn]</li>
</ul>
<h3 id="break">break</h3>
<p><strong>&#x8BED;&#x6CD5;:*</strong>break*</p>
<p><strong>&#x9ED8;&#x8BA4;&#x503C;:*</strong>none*</p>
<p><strong>&#x4F5C;&#x7528;&#x57DF;:*</strong>server, location, if*</p>
<p>Completes the current set of rules. &#x4F5C;&#x7528;&#x662F;&#x5B8C;&#x6210;&#x5F53;&#x524D;&#x7684;&#x89C4;&#x5219;&#x5217;</p>
<p>&#x793A;&#x4F8B;:</p>
<pre><code>if ($slow) {
: limit_rate  10k;
: break;
}
</code></pre><h3 id="if">if</h3>
<p><strong>&#x8BED;&#x6CD5;:*</strong>if (condition) { ... }*</p>
<p><strong>&#x9ED8;&#x8BA4;:*</strong>none*</p>
<p><strong>&#x4F5C;&#x7528;&#x57DF;:*</strong>server, location*</p>
<p>Checks the truth of a condition. If the condition evaluates to true, then the code indicated in the curly braces is carried out and the request is processed in accordance with the configuration within the following block. Configuration inside directive if is inherited from the previous level.</p>
<p>They can be assigned as the condition:</p>
<ul>
<li>the name of variable; false values are: empty string &quot;&quot;, or any string starting with &quot;0&quot;;</li>
<li>the comparison of variable with the line with using the <code>=</code> and <code>!=</code> operators;</li>
<li>pattern matching with regular expressions using the symbols <code>~*</code> and <code>~</code>:</li>
<li><code>~</code> is case-sensitive match;</li>
<li>&apos;~&apos;&#x7B26;&#x5408;&#xFF0C;&#x4F46;&#x662F;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;</li>
<li><code>~*</code> specifies a case-insensitive match (firefox matches FireFox)</li>
<li>~*&#x5927;&#x5C0F;&#x5199;&#x4E0D;&#x654F;&#x611F;&#x7684;&#x7B26;&#x5408;&#xFF08;firefox&#x7B26;&#x5408;FireFox&#xFF09;</li>
<li><code>!~ and !~*</code> mean the opposite, &quot;doesn&apos;t match&quot;</li>
<li>!~&#x548C;!~*&#x4EE3;&#x8868;&#x76F8;&#x53CD;&#xFF0C;&#x201C;&#x4E0D;&#x7B26;&#x5408;&#x201D;</li>
<li>checking for the existence of a file using the <code>-f and !-f</code> operators;&#x4F7F;&#x7528;-f&#x4EE5;&#x53CA;!-f&#x68C0;&#x6D4B;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;</li>
<li>checking existence of a directory using the <code>-d and !-d</code> operators;&#x4F7F;&#x7528;-d&#x4EE5;&#x53CA;!-d&#x68C0;&#x6D4B;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x662F;&#x5426;&#x5B58;&#x5728;</li>
<li><p>checking existence of a file, directory or symbolic link using the <code>-e and !-e</code> operators;&#x4F7F;&#x7528;-e&#x4EE5;&#x53CA;!-e&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x7B26;&#x53F7;&#x94FE;&#x63A5;&#x3002;</p>
</li>
<li><p>checking whether a file is executable using the <code>-x and !-x</code> operators.&#x4F7F;&#x7528;-x&#x4EE5;&#x53CA;!-x&#x68C0;&#x6D4B;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x53EF;&#x6267;&#x884C;</p>
</li>
</ul>
<p> Parts of the regular expressions can be in parentheses, whose value can then later be accessed in the <code>$1 to &gt;$9</code> variables.</p>
<p>Examples of use:</p>
<pre><code>if ($http_user_agent ~ MSIE) {
: rewrite  ^(.*)$  /msie/$1  break;
}
if ($http_cookie ~* &quot;id=([^;] +)(?:;|$)&quot; ) {
: set  $id  $1;
}
if ($request_method = POST ) {
: return 405;
}
if (!-f $request_filename) {
: break;
: proxy_pass  http://127.0.0.1;
}
if ($slow) {
: limit_rate  10k;
}
if ($invalid_referer) {
: return   403;
}
</code></pre><p>The value of the built-in variable <code>$invalid_referer</code> is given by the directive valid_referers.</p>
<h3 id="return">return</h3>
<p><strong>&#x8BED;&#x6CD5;:*</strong>return code*</p>
<p><strong>&#x9ED8;&#x8BA4;&#x503C;:*</strong>none*</p>
<p><strong>&#x4F5C;&#x7528;&#x57DF;:*</strong>server, location, if*</p>
<p>This directive concludes execution of the rules and returns the status code indicated to client. It is possible to use the following values: 204, 400, 402-406, 408, 410, 411, 413, 416 and 500-504. Furthermore, nonstandard code 444 closes the connection without sending any headers.</p>
<p>&#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#x6839;&#x636E;&#x89C4;&#x5219;&#x7684;&#x6267;&#x884C;&#x60C5;&#x51B5;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x503C;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x53EF;&#x4F7F;&#x7528;&#x503C;&#x5305;&#x62EC;&#xFF1A;204&#xFF0C;400&#xFF0C;402-406&#xFF0C;408&#xFF0C;410&#xFF0C;411&#xFF0C;413&#xFF0C;416&#x4EE5;&#x53CA;500-504&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x975E;&#x6807;&#x51C6;&#x7684;444&#x4EE3;&#x7801;-&#x672A;&#x53D1;&#x9001;&#x4EFB;&#x4F55;&#x5934;&#x4FE1;&#x606F;&#x4E0B;&#x7ED3;&#x675F;&#x8FDE;&#x63A5;&#x3002;</p>
<h3 id="rewrite">rewrite</h3>
<p><strong>&#x8BED;&#x6CD5;:*</strong>rewrite regex replacement flag*</p>
<p><strong>&#x9ED8;&#x8BA4;:*</strong>none*</p>
<p><strong>&#x4F5C;&#x7528;&#x57DF;:*</strong>server, location, if*</p>
<p>This directive changes URI in accordance with the regular expression and the replacement string. Directives are carried out in order of appearance in the configuration file.</p>
<p>&#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#x6839;&#x636E;&#x8868;&#x8FBE;&#x5F0F;&#x6765;&#x66F4;&#x6539;URI&#xFF0C;&#x6216;&#x8005;&#x4FEE;&#x6539;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x6307;&#x4EE4;&#x6839;&#x636E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x6267;&#x884C;&#x3002;</p>
<p>Be aware that the rewrite regex only matches the relative path instead of the absolute URL. If you want to match the hostname, you should use an if condition, like so:</p>
<p>&#x6CE8;&#x610F;&#x91CD;&#x5199;&#x8868;&#x8FBE;&#x5F0F;&#x53EA;&#x5BF9;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x6709;&#x6548;&#x3002;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x914D;&#x5BF9;&#x4E3B;&#x673A;&#x540D;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;if&#x8BED;&#x53E5;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>if ($host ~* www\.(.*)) {
: set $host_without_www $1;
: rewrite ^(.*)$ http://$host_without_www$1 permanent; # $1 contains &apos;/foo&apos;, not &apos;www.mydomain.com/foo&apos;
}
</code></pre><p>Flags make it possible to end the execution of rewrite directives.</p>
<p>If the replacement string begins with <code>http://</code> then the client will be redirected, and any further rewrite directives are terminated.</p>
<p>Flags can be any of the following:</p>
<ul>
<li>last - completes processing of rewrite directives, after which searches for corresponding URI and location</li>
<li>break - completes processing of rewrite directives</li>
<li>redirect - returns temporary redirect with code 302; it is used if the substituting line begins with <code>http://</code></li>
<li>permanent - returns permanent redirect with code 301</li>
</ul>
<p>Note that if an redirect is relative (has no host part), then when redirecting Nginx uses the &quot;Host&quot; header if the header match name of server_name directive or the first name of <code>server_name</code> directive, if the header does not match or is absent. If no <code>server_name</code> is set, then the local hostname is used. If you want Nginx to always use the &quot;Host&quot; header, you can use a wildcard &quot;*&quot; <code>server_name</code> (but see the restrictions on doing so).Example:</p>
<pre><code>rewrite  ^(/download/.*)/media/(.*)\..*$  $1/mp3/$2.mp3  last;
rewrite  ^(/download/.*)/audio/(.*)\..*$  $1/mp3/$2.ra   last;
return   403;
</code></pre><p>But if we place these directives in location /download/, then it is necessary to replace flag &quot;last&quot; by &quot;break&quot;, otherwise nginx will hit the 10 cycle limit and return error 500:</p>
<pre><code>location /download/ {
: rewrite  ^(/download/.*)/media/(.*)\..*$  $1/mp3/$2.mp3  break;
: rewrite  ^(/download/.*)/audio/(.*)\..*$  $1/mp3/$2.ra   break;
: return   403;
}
</code></pre><p>If in the line of replacement arguments are indicated, then the rest of the request arguments are appended to them. To avoid having them appended, place a question mark as the last character:</p>
<pre><code>: rewrite  ^/users/(.*)$  /show?user=$1?  last;
</code></pre><p>&#x6CE8;: &#x5BF9;&#x82B1;&#x62EC;&#x53F7;( { &#x548C; } )&#x6765;&#x8BF4;, &#x4ED6;&#x4EEC;&#x65E2;&#x80FD;&#x7528;&#x5728;&#x91CD;&#x5B9A;&#x5411;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x91CC;&#xFF0C;&#x4E5F;&#x662F;&#x7528;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#x5206;&#x5272;&#x4EE3;&#x7801;&#x5757;, &#x4E3A;&#x4E86;&#x907F;&#x514D;&#x51B2;&#x7A81;, &#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x91CC;&#x5E26;&#x82B1;&#x62EC;&#x53F7;&#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x7528;&#x53CC;&#x5F15;&#x53F7;&#xFF08;&#x6216;&#x8005;&#x5355;&#x5F15;&#x53F7;&#xFF09;&#x5305;&#x56F4;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x8981;&#x5C06;&#x7C7B;&#x4F3C;&#x4EE5;&#x4E0B;&#x7684;url</p>
<pre><code>

/photos/123456
</code></pre><p>&#x91CD;&#x5B9A;&#x5411;&#x5230;&#xFF1A;</p>
<pre><code>
/path/to/photos/12/1234/123456.png
</code></pre><p>&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5; (&#x6CE8;&#x610F;&#x53CC;&#x5F15;&#x53F7;):</p>
<pre><code>rewrite  &quot;/photos/([0-9] {2})([0-9] {2})([0-9] {2})&quot; /path/to/photos/$1/$1$2/$1$2$3.png;
</code></pre><h3 id="set">set</h3>
<p><strong>syntax:*</strong>set variable value*</p>
<p><strong>default:*</strong>none*</p>
<p><strong>context:*</strong>server, location, if*</p>
<p>Directive establishes value for the variable indicated. As the value it is possible to use a text, variables and their combination.</p>
<h3 id="uninitializedvariablewarn">uninitialized_variable_warn</h3>
<p><strong>syntax:*</strong>uninitialized_variable_warn on|off*</p>
<p><strong>default:*</strong>uninitialized_variable_warn on*</p>
<p><strong>context:*</strong>http, server, location, if*</p>
<p>Enables or disables logging of warnings about noninitialized variables.</p>
<p>Internally, the rewrite directives are compiled at the time the configuration file is loaded into internal codes, usable during the request by the interpreter.</p>
<p>This interpreter is a simple stack virtual machine. For example, the directive:</p>
<pre><code>location /download/ {
: if ($forbidden) {
: return   403;
: }
: if ($slow) {
: limit_rate  10k;
: }
: rewrite  ^/(download/.*)/media/(.*)\..*$  /$1/mp3/$2.mp3  break;
}
</code></pre><p>will be compiled into this sequence:</p>
<pre><code>: variable $forbidden
: checking to zero
: recovery 403
: completion of entire code
: variable $slow
: checking to zero
: checkings of regular expression
: copying &quot;/&quot;
: copying $1
: copying &quot;/mp3/&quot;
: copying $2
: copying &quot;..mpe&quot;

: completion of regular expression
: completion of entire sequence
</code></pre><p>Note that there is no code for directive limit_rate, since it does not refer to module ngx_http_rewrite_module. The &quot;if&quot; block exists in the same part of the configuration as the &quot;location&quot; directive.</p>
<p>If $slow is true, then what&apos;s inside the &quot;if&quot; block is evaluated, and in this configuration limit_rate it is equal to 10k.</p>
<p>Directive:</p>
<pre><code>: rewrite  ^/(download/.*)/media/(.*)\..*$  /$1/mp3/$2.mp3  break;
</code></pre><p>It is possible to reduce the sequence, if in the regular expression we include the first slash inside the parentheses:</p>
<pre><code>: rewrite  ^(/download/.*)/media/(.*)\..*$  $1/mp3/$2.mp3  break;
</code></pre><p>then the sequence will appear like this:</p>
<pre><code>
: checking regular expression
: copying $1
: copying &quot;/mp3/&quot;
: copying $2
: copying &quot;..mpe&quot;
: completion of regular expression
: completion of entire code
</code></pre><h3 id="references">References</h3>
<p><a href="http://sysoev.ru/nginx/docs/http/ngx_http_rewrite_module.html" title="http://sysoev.ru/nginx/docs/http/ngx_http_rewrite_module.html" target="_blank">Original Documentation</a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Text/3.20_httpproxy.html" class="navigation navigation-prev " aria-label="Previous page: HttpProxy模块"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Text/3.22_httpssi.html" class="navigation navigation-next " aria-label="Next page: HttpSSI模块"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-comment/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"comment":{"highlightCommented":true},"autocover":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
